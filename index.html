<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Operationsbegleiter</title>
    <style>
/* === AURORA GLASS DESIGN SYSTEM - Futuristic Medical === */
:root{
    /* Aurora Glass - Teal/Emerald/Gold Theme */
    --bg:#070A12;
    --surface:rgba(255,255,255,0.04);
    --surface-2:rgba(255,255,255,0.07);
    --surface-3:rgba(255,255,255,0.10);
    --text:#E8F4F8;
    --text-2:#B8D4DC;
    --muted:rgba(184,212,220,0.65);
    --border:rgba(45,212,191,0.15);
    --border-glow:rgba(45,212,191,0.25);
    
    /* Neon Accent Colors - Teal/Emerald/Gold */
    --primary:#2DD4BF;--primary-2:#14B8A6;--primary-glow:rgba(45,212,191,0.4);
    --secondary:#FBBF24;--secondary-glow:rgba(251,191,36,0.35);
    --success:#34D399;--success-glow:rgba(52,211,153,0.35);
    --warning:#F59E0B;--warning-glow:rgba(245,158,11,0.35);
    --danger:#F43F5E;--danger-glow:rgba(244,63,94,0.4);
    
    /* Glassmorphism */
    --glass-bg:rgba(255,255,255,0.03);
    --glass-border:rgba(45,212,191,0.12);
    --glass-highlight:inset 0 1px 0 rgba(255,255,255,0.05);
    --glass-blur:blur(16px) saturate(150%);
    
    /* Shadows & Glows */
    --shadow-1:0 2px 8px rgba(0,0,0,0.4);
    --shadow-2:0 8px 24px rgba(0,0,0,0.45);
    --shadow-3:0 20px 50px rgba(0,0,0,0.55);
    --neon-glow:0 0 20px var(--primary-glow),0 0 40px rgba(45,212,191,0.15);
    
    /* Spacing - 8px system */
    --radius-sm:6px;--radius-md:12px;--radius-lg:18px;--radius-xl:24px;
    --space-1:4px;--space-2:8px;--space-3:12px;--space-4:16px;--space-5:24px;--space-6:32px;
    
    --focus:0 0 0 3px var(--primary-glow);
    --card:var(--surface);--input-bg:var(--surface-2);--radius:var(--radius-lg);
    --gradient:linear-gradient(135deg,#2DD4BF 0%,#14B8A6 40%,#FBBF24 100%);
    --sidebar-width:260px;--master-width:360px;
}

/* Dark Theme - Deeper & More Contrast */
html[data-theme="dark"]{
    --bg:#030508;
    --surface:rgba(255,255,255,0.025);
    --surface-2:rgba(255,255,255,0.05);
    --surface-3:rgba(255,255,255,0.08);
    --text:#F0F9FF;
    --text-2:#CBD5E1;
    --muted:rgba(203,213,225,0.6);
    --border:rgba(45,212,191,0.12);
    --primary:#5EEAD4;--primary-2:#2DD4BF;
    --glass-bg:rgba(255,255,255,0.02);
    --neon-glow:0 0 15px var(--primary-glow),0 0 30px rgba(45,212,191,0.1);
}
*{margin:0;padding:0;box-sizing:border-box}

/* Aurora Background Effect */
html,body{
    background-color:var(--bg);
    color:var(--text);
    font-family:'Plus Jakarta Sans',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    min-height:100vh;
    transition:background-color .3s,color .3s;
    line-height:1.6;
    -webkit-font-smoothing:antialiased;
}
body{
    background:
        radial-gradient(ellipse 80% 60% at 10% 20%, rgba(45,212,191,0.08) 0%, transparent 50%),
        radial-gradient(ellipse 60% 50% at 90% 80%, rgba(251,191,36,0.06) 0%, transparent 50%),
        radial-gradient(ellipse 50% 40% at 50% 50%, rgba(52,211,153,0.04) 0%, transparent 50%),
        linear-gradient(180deg, var(--bg) 0%, #0A0F1A 100%);
    background-attachment:fixed;
}
/* Subtle grid pattern overlay */
body::before{
    content:'';
    position:fixed;
    inset:0;
    background-image:
        linear-gradient(rgba(45,212,191,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(45,212,191,0.02) 1px, transparent 1px);
    background-size:60px 60px;
    pointer-events:none;
    z-index:0;
}
.hidden{display:none!important}

/* Reduced Motion */
@media(prefers-reduced-motion:reduce){
    *{animation-duration:0.01ms!important;transition-duration:0.01ms!important}
    body::before{display:none}
}

/* === SHELL LAYOUT (Split-View) === */
.shell{display:flex;min-height:100vh;width:100%;position:relative;z-index:1}

/* Sidebar - Glass Effect */
.sidebar{
    width:var(--sidebar-width);
    background:var(--glass-bg);
    backdrop-filter:var(--glass-blur);
    -webkit-backdrop-filter:var(--glass-blur);
    border-right:1px solid var(--glass-border);
    display:flex;flex-direction:column;
    position:fixed;left:0;top:0;bottom:0;z-index:100;overflow-y:auto;
    box-shadow:var(--glass-highlight),var(--shadow-2);
}
.main-area{flex:1;display:flex;margin-left:var(--sidebar-width);min-height:100vh}

/* Master Pane - Glass */
.master-pane{
    width:var(--master-width);min-width:var(--master-width);
    background:var(--glass-bg);
    backdrop-filter:var(--glass-blur);
    -webkit-backdrop-filter:var(--glass-blur);
    border-right:1px solid var(--glass-border);
    display:flex;flex-direction:column;height:100vh;overflow:hidden;
    box-shadow:var(--glass-highlight);
}

/* Detail Pane - Glass */
.detail-pane{
    flex:1;
    background:rgba(0,0,0,0.2);
    display:flex;flex-direction:column;height:100vh;overflow:hidden;
}

/* Sidebar Styles - Glass */
.sidebar-header{
    padding:var(--space-5);
    border-bottom:1px solid var(--glass-border);
    display:flex;align-items:center;gap:var(--space-3);
    background:rgba(45,212,191,0.03);
}
.sidebar-logo{width:40px;height:40px;border-radius:var(--radius-md);box-shadow:var(--neon-glow)}
.sidebar-title{font-weight:700;font-size:1.1rem;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sidebar-search{padding:var(--space-3) var(--space-4)}
.sidebar-search input{
    width:100%;padding:var(--space-3);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    background:var(--surface-2);
    color:var(--text);font-size:.9rem;
    backdrop-filter:blur(8px);
    transition:all .2s;
}
.sidebar-search input:focus{outline:none;border-color:var(--primary);box-shadow:var(--focus),var(--neon-glow)}
.sidebar-search input::placeholder{color:var(--muted)}
.sidebar-nav{flex:1;padding:var(--space-2) 0}
.nav-section{padding:var(--space-3) var(--space-4)}
.nav-section-title{
    font-size:.7rem;color:var(--primary);
    text-transform:uppercase;font-weight:700;
    letter-spacing:.1em;margin-bottom:var(--space-2);
    opacity:.8;
}
.nav-item{
    display:flex;align-items:center;gap:var(--space-3);
    padding:var(--space-3) var(--space-4);
    cursor:pointer;border-radius:var(--radius-md);
    margin:4px var(--space-2);
    transition:all .2s;color:var(--text-2);
    border:1px solid transparent;
}
.nav-item:hover{
    background:var(--surface-2);color:var(--text);
    border-color:var(--glass-border);
}
.nav-item.active{
    background:rgba(45,212,191,0.1);
    color:var(--primary);font-weight:600;
    border-color:var(--primary);
    box-shadow:0 0 20px var(--primary-glow);
}
.nav-item-icon{font-size:1.25rem;width:28px;text-align:center}
.nav-item-label{font-size:.9rem;letter-spacing:.01em}
.nav-item-badge{
    margin-left:auto;
    background:var(--danger);color:#fff;
    font-size:.7rem;padding:3px 8px;
    border-radius:var(--radius-xl);font-weight:700;
    box-shadow:0 0 12px var(--danger-glow);
}
.sidebar-footer{padding:var(--space-4);border-top:1px solid var(--glass-border);background:rgba(0,0,0,0.15)}
.sidebar-profile{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-3);cursor:pointer;border-radius:var(--radius-md);transition:all .2s}
.sidebar-profile:hover{background:var(--surface-2)}
.profile-avatar{
    width:40px;height:40px;
    background:var(--gradient);
    border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    color:#0A0F1A;font-weight:700;font-size:1rem;
    box-shadow:0 0 20px var(--primary-glow);
}
.profile-info{flex:1}
.profile-name{font-weight:600;font-size:.9rem;color:var(--text)}
.profile-status{font-size:.75rem;color:var(--primary)}

/* Master Pane - Glass */
.master-header{
    padding:var(--space-5);
    border-bottom:1px solid var(--glass-border);
    background:var(--glass-bg);
    backdrop-filter:blur(10px);
}
.master-title{font-weight:700;font-size:1.15rem;color:var(--text);display:flex;align-items:center;gap:var(--space-2);letter-spacing:-.01em}
.master-subtitle{font-size:.85rem;color:var(--muted);margin-top:var(--space-1)}
.master-tabs{
    display:flex;gap:var(--space-2);
    padding:var(--space-3) var(--space-4);
    background:rgba(0,0,0,0.2);
    border-bottom:1px solid var(--glass-border);
    overflow-x:auto;
}
.master-tab{
    padding:var(--space-2) var(--space-4);
    border-radius:var(--radius-xl);
    font-size:.85rem;font-weight:600;
    cursor:pointer;white-space:nowrap;
    background:var(--surface);
    color:var(--muted);
    border:1px solid var(--glass-border);
    transition:all .2s;
}
.master-tab:hover{border-color:var(--primary);color:var(--text)}
.master-tab.active{
    background:var(--primary);color:#0A0F1A;
    border-color:var(--primary);
    box-shadow:0 0 20px var(--primary-glow);
}
.master-content{flex:1;overflow-y:auto;padding:var(--space-4)}
.master-list{display:flex;flex-direction:column;gap:var(--space-3)}

/* Detail Pane - Glass */
.detail-header{
    padding:var(--space-4) var(--space-5);
    background:var(--glass-bg);
    backdrop-filter:blur(12px);
    border-bottom:1px solid var(--glass-border);
    display:flex;align-items:center;gap:var(--space-4);
    box-shadow:var(--glass-highlight);
}
.detail-back{
    display:none;width:44px;height:44px;
    border:1px solid var(--glass-border);
    background:var(--surface);
    border-radius:var(--radius-md);
    cursor:pointer;font-size:1.1rem;color:var(--text);
    transition:all .2s;
}
.detail-back:hover{background:var(--surface-2);border-color:var(--primary);box-shadow:var(--focus)}
.detail-title{font-weight:700;font-size:1.25rem;color:var(--text);flex:1;letter-spacing:-.02em}
.detail-actions{display:flex;gap:var(--space-2)}
.detail-content{flex:1;overflow-y:auto;padding:var(--space-5)}
.detail-empty{
    display:flex;flex-direction:column;
    align-items:center;justify-content:center;
    height:100%;color:var(--muted);
    text-align:center;padding:var(--space-6);
}
.detail-empty-icon{font-size:4rem;margin-bottom:var(--space-5);opacity:.3}

/* KPI Header - Glass */
.kpi-header{
    background:var(--glass-bg);
    backdrop-filter:blur(12px);
    border-bottom:1px solid var(--glass-border);
    padding:var(--space-4) var(--space-5);
    box-shadow:var(--glass-highlight);
}
.kpi-top{display:flex;align-items:center;justify-content:space-between;gap:var(--space-4);margin-bottom:var(--space-4)}
.kpi-info{display:flex;align-items:center;gap:var(--space-3)}
.kpi-op-badge{
    background:var(--gradient);
    color:#0A0F1A;
    padding:var(--space-2) var(--space-4);
    border-radius:var(--radius-lg);
    font-weight:700;font-size:.9rem;
    box-shadow:0 0 25px var(--primary-glow);
}
.kpi-op-date{color:var(--text-2);font-size:.9rem}
.kpi-mode{
    padding:var(--space-1) var(--space-3);
    border-radius:var(--radius-md);
    font-size:.75rem;font-weight:700;
    text-transform:uppercase;letter-spacing:.05em;
}
.kpi-mode.ambulant{background:rgba(52,211,153,0.15);color:var(--success);border:1px solid rgba(52,211,153,0.3)}
.kpi-mode.stationary{background:rgba(45,212,191,0.15);color:var(--primary);border:1px solid rgba(45,212,191,0.3)}
.kpi-chips{display:flex;gap:var(--space-3);flex-wrap:wrap}
.kpi-chip{
    display:flex;align-items:center;gap:var(--space-2);
    padding:var(--space-2) var(--space-4);
    background:var(--surface);
    backdrop-filter:blur(8px);
    border-radius:var(--radius-xl);
    font-size:.85rem;
    border:1px solid var(--glass-border);
    transition:all .2s;
}
.kpi-chip:hover{border-color:var(--primary)}
.kpi-chip-value{font-weight:700;color:var(--text)}
.kpi-chip-label{color:var(--muted)}
.kpi-chip.highlight{
    background:rgba(45,212,191,0.1);
    border-color:var(--primary);
    box-shadow:0 0 15px var(--primary-glow);
}
.kpi-chip.warning{
    background:rgba(245,158,11,0.1);
    border-color:var(--warning);
    box-shadow:0 0 15px var(--warning-glow);
}
.kpi-quick-actions{display:flex;gap:var(--space-2)}
.quick-btn{
    width:44px;height:44px;
    border:1px solid var(--glass-border);
    background:var(--surface);
    border-radius:var(--radius-md);
    cursor:pointer;font-size:1.1rem;
    transition:all .2s;color:var(--text);
}
.quick-btn:hover{
    border-color:var(--primary);
    background:rgba(45,212,191,0.08);
    box-shadow:0 0 15px var(--primary-glow);
}
.quick-btn:focus{outline:none;box-shadow:var(--focus)}
.quick-btn.danger{color:var(--danger);border-color:rgba(244,63,94,0.3)}
.quick-btn.danger:hover{background:rgba(244,63,94,0.1);border-color:var(--danger);box-shadow:0 0 15px var(--danger-glow)}

/* Widgets - Glass Cards */
.widgets-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:var(--space-5)}
.widget{
    background:var(--glass-bg);
    backdrop-filter:var(--glass-blur);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    overflow:hidden;
    box-shadow:var(--glass-highlight),var(--shadow-2);
    transition:all .3s;
}
.widget:hover{
    border-color:var(--border-glow);
    box-shadow:var(--glass-highlight),var(--shadow-3),0 0 30px rgba(45,212,191,0.08);
}
.widget-header{
    padding:var(--space-4);
    border-bottom:1px solid var(--glass-border);
    display:flex;align-items:center;justify-content:space-between;
    background:rgba(45,212,191,0.02);
}
.widget-title{
    font-weight:700;font-size:.95rem;color:var(--text);
    display:flex;align-items:center;gap:var(--space-2);
    letter-spacing:-.01em;
}
.widget-more{
    font-size:.8rem;color:var(--primary);
    cursor:pointer;font-weight:600;
    transition:all .2s;padding:var(--space-1) var(--space-2);
    border-radius:var(--radius-md);
}
.widget-more:hover{background:rgba(45,212,191,0.1);text-decoration:none}
.widget-content{padding:var(--space-4)}
.widget-list{display:flex;flex-direction:column;gap:var(--space-2)}
.widget-item{
    display:flex;align-items:center;gap:var(--space-3);
    padding:var(--space-3);
    border-radius:var(--radius-md);
    cursor:pointer;transition:all .2s;
    border:1px solid transparent;
}
.widget-item:hover{
    background:var(--surface-2);
    border-color:var(--glass-border);
}
.widget-item-icon{font-size:1.2rem;width:28px;text-align:center}
.widget-item-content{flex:1;min-width:0}
.widget-item-title{font-size:.9rem;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.widget-item-desc{font-size:.8rem;color:var(--muted)}
.widget-item-badge{font-size:.75rem;padding:3px 8px;border-radius:var(--radius-md);font-weight:600}
.widget-countdown{text-align:center;padding:var(--space-5)}
.countdown-value{
    font-size:4rem;font-weight:800;
    background:var(--gradient);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    line-height:1;
    text-shadow:0 0 60px var(--primary-glow);
}
.countdown-label{font-size:1rem;color:var(--muted);margin-top:var(--space-3);font-weight:500}
.countdown-date{font-size:.9rem;color:var(--text-2);margin-top:var(--space-2)}

/* Command Palette - Glass */
.command-overlay{
    position:fixed;inset:0;
    background:rgba(0,0,0,.65);
    z-index:2000;display:flex;
    align-items:flex-start;justify-content:center;
    padding-top:12vh;
    backdrop-filter:blur(8px);
}
.command-modal{
    background:var(--glass-bg);
    backdrop-filter:blur(20px) saturate(150%);
    border-radius:var(--radius-xl);
    width:100%;max-width:600px;
    box-shadow:var(--shadow-3),0 0 60px rgba(45,212,191,0.15),var(--glass-highlight);
    overflow:hidden;animation:fadeIn .2s;
    border:1px solid var(--glass-border);
}
.command-input-wrap{padding:var(--space-5);border-bottom:1px solid var(--glass-border);background:rgba(0,0,0,0.2)}
.command-input{
    width:100%;padding:var(--space-4);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    font-size:1.1rem;
    background:var(--surface);
    color:var(--text);
    transition:all .2s;
}
.command-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 20px var(--primary-glow)}
.command-input::placeholder{color:var(--muted)}
.command-results{max-height:320px;overflow-y:auto}
.command-group{padding:var(--space-3) var(--space-5)}
.command-group-title{font-size:.75rem;color:var(--primary);text-transform:uppercase;font-weight:700;letter-spacing:.1em;margin-bottom:var(--space-2)}
.command-item{
    display:flex;align-items:center;gap:var(--space-3);
    padding:var(--space-3) var(--space-4);
    border-radius:var(--radius-md);
    cursor:pointer;transition:all .2s;
    border:1px solid transparent;
}
.command-item:hover,.command-item.selected{
    background:var(--surface-2);
    border-color:var(--primary);
    box-shadow:0 0 15px var(--primary-glow);
}
.command-item-icon{font-size:1.3rem;width:32px;text-align:center}
.command-item-text{flex:1}
.command-item-title{font-size:.95rem;color:var(--text);font-weight:500}
.command-item-hint{font-size:.8rem;color:var(--muted)}
.command-shortcut{
    font-size:.75rem;color:var(--primary);
    background:rgba(45,212,191,0.1);
    padding:4px 10px;border-radius:var(--radius-md);
    border:1px solid var(--glass-border);
    font-weight:600;
}
.command-footer{
    padding:var(--space-3) var(--space-5);
    border-top:1px solid var(--glass-border);
    display:flex;justify-content:space-between;
    font-size:.8rem;color:var(--muted);
    background:rgba(0,0,0,0.15);
}

/* Cards & Items - Glass */
.item-card{
    background:var(--glass-bg);
    backdrop-filter:blur(12px);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    padding:var(--space-4);
    cursor:pointer;
    transition:all .25s;
    box-shadow:var(--glass-highlight);
}
.item-card:hover{
    border-color:var(--primary);
    box-shadow:var(--glass-highlight),0 0 25px var(--primary-glow);
    transform:translateY(-2px);
}
.item-card.selected{
    border-color:var(--primary);
    background:rgba(45,212,191,0.05);
    box-shadow:var(--glass-highlight),0 0 30px var(--primary-glow);
}
.item-card-header{display:flex;align-items:flex-start;gap:var(--space-3);margin-bottom:var(--space-3)}
.item-card-icon{font-size:1.4rem}
.item-card-title{font-weight:600;font-size:.95rem;color:var(--text)}
.item-card-meta{font-size:.8rem;color:var(--muted)}
.item-card-badge{
    display:inline-block;padding:4px 10px;
    border-radius:var(--radius-md);
    font-size:.75rem;font-weight:700;
    border:1px solid transparent;
}
.item-card-badge.success{background:rgba(52,211,153,0.12);color:var(--success);border-color:rgba(52,211,153,0.25)}
.item-card-badge.warning{background:rgba(245,158,11,0.12);color:var(--warning);border-color:rgba(245,158,11,0.25)}
.item-card-badge.danger{background:rgba(244,63,94,0.12);color:var(--danger);border-color:rgba(244,63,94,0.25)}
.item-card-badge.primary{background:rgba(45,212,191,0.12);color:var(--primary);border-color:rgba(45,212,191,0.25)}

/* Mobile Styles - Glass */
@media (max-width:859px){
    .sidebar{transform:translateX(-100%);transition:transform .3s}
    .sidebar.open{transform:translateX(0)}
    .sidebar-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:99;display:none;backdrop-filter:blur(4px)}
    .sidebar-overlay.open{display:block}
    .main-area{margin-left:0;flex-direction:column}
    .master-pane{width:100%;min-width:100%;border-right:none;height:auto;flex:1}
    .detail-pane{position:fixed;inset:0;z-index:50;transform:translateX(100%);transition:transform .3s}
    .detail-pane.open{transform:translateX(0)}
    .detail-back{display:flex;align-items:center;justify-content:center}
    .bottom-nav{
        position:fixed;bottom:0;left:0;right:0;
        background:var(--glass-bg);
        backdrop-filter:blur(20px) saturate(150%);
        border-top:1px solid var(--glass-border);
        display:flex;justify-content:space-around;
        padding:var(--space-2) 0;
        padding-bottom:max(var(--space-2),env(safe-area-inset-bottom));
        z-index:100;
        box-shadow:0 -10px 40px rgba(0,0,0,0.3);
    }
    .bottom-nav-item{
        display:flex;flex-direction:column;align-items:center;
        gap:4px;padding:var(--space-2) var(--space-3);
        cursor:pointer;color:var(--muted);
        transition:all .2s;min-width:64px;
        border-radius:var(--radius-md);
    }
    .bottom-nav-item.active{
        color:var(--primary);
        background:rgba(45,212,191,0.1);
        box-shadow:0 0 20px var(--primary-glow);
    }
    .bottom-nav-item-icon{font-size:1.4rem}
    .bottom-nav-item-label{font-size:.7rem;font-weight:600}
    .master-pane{padding-bottom:80px}
    .widgets-grid{grid-template-columns:1fr}
    .kpi-top{flex-wrap:wrap}
    .kpi-chips{width:100%}
}

/* Desktop only */
@media (min-width:860px){
    .bottom-nav{display:none}
    .mobile-header{display:none}
}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
@keyframes recording{0%,100%{opacity:1}50%{opacity:.4}}
@media(prefers-reduced-motion:reduce){*{animation-duration:0.01ms!important;transition-duration:0.01ms!important}}

/* === AURORA GLASS COMPONENT STYLES === */
.form-group{margin-bottom:var(--space-5)}
.form-label{display:block;font-weight:600;margin-bottom:var(--space-2);font-size:.9rem;color:var(--text-2);letter-spacing:.01em}
.form-input,.form-select,.form-textarea{
    width:100%;padding:var(--space-3) var(--space-4);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    background:var(--surface);
    backdrop-filter:blur(8px);
    color:var(--text);font-size:1rem;font-family:inherit;
    transition:all .2s;
}
.form-input.date-input{max-width:180px}
.form-input:focus,.form-select:focus,.form-textarea:focus{
    outline:none;border-color:var(--primary);
    box-shadow:var(--focus),0 0 20px var(--primary-glow);
    background:var(--surface-2);
}
.form-input::placeholder,.form-textarea::placeholder{color:var(--muted)}
.form-textarea{resize:vertical;min-height:100px}
.checkbox-group{
    display:flex;align-items:flex-start;gap:var(--space-3);
    padding:var(--space-4);
    background:var(--glass-bg);
    backdrop-filter:blur(8px);
    border-radius:var(--radius-lg);
    margin-bottom:var(--space-3);cursor:pointer;
    border:1px solid var(--glass-border);
    transition:all .2s;
}
.checkbox-group:hover{border-color:var(--primary);box-shadow:0 0 15px var(--primary-glow)}
.checkbox-group input{display:none}
.custom-checkbox{
    width:24px;height:24px;min-width:24px;
    border:2px solid var(--glass-border);
    border-radius:var(--radius-sm);
    display:flex;align-items:center;justify-content:center;
    transition:all .2s;
    background:var(--surface);
}
.checkbox-group:hover .custom-checkbox{border-color:var(--primary)}
.checkbox-group input:checked+.custom-checkbox{
    background:var(--gradient);
    border-color:var(--primary);
    box-shadow:0 0 15px var(--primary-glow);
}
.checkbox-group input:checked+.custom-checkbox::after{content:'✓';color:#0A0F1A;font-size:.85rem;font-weight:700}
.checkbox-title{font-weight:600;font-size:.95rem;color:var(--text)}
.checkbox-desc{font-size:.85rem;color:var(--muted);margin-top:4px;line-height:1.6}
/* Buttons - Glass & Neon */
.btn{
    padding:var(--space-3) var(--space-5);
    border:none;border-radius:var(--radius-xl);
    font-size:.95rem;font-weight:600;
    cursor:pointer;display:inline-flex;
    align-items:center;justify-content:center;gap:var(--space-2);
    transition:all .25s;font-family:inherit;min-height:48px;
    position:relative;overflow:hidden;
}
.btn:focus{outline:none;box-shadow:var(--focus)}
.btn-primary{
    background:var(--gradient);
    color:#0A0F1A;
    box-shadow:0 4px 20px var(--primary-glow),var(--shadow-2);
}
.btn-primary:hover{
    box-shadow:0 6px 30px var(--primary-glow),var(--shadow-3),0 0 40px var(--primary-glow);
    transform:translateY(-2px);
}
.btn-primary:active{transform:translateY(0);box-shadow:0 2px 15px var(--primary-glow)}
.btn-secondary{
    background:var(--glass-bg);
    backdrop-filter:blur(8px);
    color:var(--text);
    border:1px solid var(--glass-border);
    box-shadow:var(--glass-highlight);
}
.btn-secondary:hover{
    background:var(--surface-2);
    border-color:var(--primary);
    box-shadow:var(--glass-highlight),0 0 20px var(--primary-glow);
}
.btn-danger{
    background:var(--danger);
    color:#fff;
    box-shadow:0 4px 20px var(--danger-glow);
}
.btn-danger:hover{
    box-shadow:0 6px 25px var(--danger-glow);
    transform:translateY(-2px);
}
.btn-block{width:100%}
.btn-sm{padding:var(--space-2) var(--space-4);font-size:.9rem;min-height:40px}
/* Badges - Neon */
.badge{
    padding:var(--space-1) var(--space-3);
    background:var(--gradient);
    border-radius:var(--radius-xl);
    color:#0A0F1A;font-weight:700;font-size:.8rem;
    box-shadow:0 0 15px var(--primary-glow);
}
.badge.today{background:var(--secondary);box-shadow:0 0 15px var(--secondary-glow)}
.badge.success{background:var(--success);box-shadow:0 0 15px var(--success-glow)}
.badge.danger{background:var(--danger);color:#fff;box-shadow:0 0 15px var(--danger-glow)}

/* Cards - Glass */
.card{
    background:var(--glass-bg);
    backdrop-filter:var(--glass-blur);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    overflow:hidden;margin-bottom:var(--space-4);
    box-shadow:var(--glass-highlight),var(--shadow-1);
}
.card-item{
    padding:var(--space-4);display:flex;
    align-items:center;gap:var(--space-3);
    border-bottom:1px solid var(--glass-border);
    cursor:pointer;transition:all .2s;min-height:60px;
}
.card-item:last-child{border-bottom:none}
.card-item:hover{background:var(--surface-2)}
.card-content{flex:1}
.card-title{font-weight:600;font-size:.95rem;color:var(--text)}
.card-desc{font-size:.85rem;color:var(--muted);margin-top:4px}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-3)}
.section-title{font-size:1rem;font-weight:700;color:var(--text);letter-spacing:-0.01em}
.section-link{color:var(--primary);font-weight:600;font-size:.85rem;cursor:pointer}
.section-link:hover{text-decoration:underline}
/* Timeline - Aurora Glass */
.timeline{position:relative;padding-left:40px}
.timeline-line{
    position:absolute;left:16px;top:0;bottom:0;width:2px;
    background:linear-gradient(180deg, var(--glass-border) 0%, rgba(45,212,191,0.3) 50%, var(--glass-border) 100%);
}
.timeline-phase{margin-bottom:var(--space-6)}
.timeline-header{display:flex;align-items:center;margin-bottom:var(--space-4);position:relative}
.timeline-dot{
    position:absolute;left:-30px;
    width:20px;height:20px;
    background:var(--surface);
    border:2px solid var(--glass-border);
    border-radius:50%;
    transition:all .3s;
}
.timeline-dot.today{
    background:var(--secondary);
    border-color:var(--secondary);
    box-shadow:0 0 20px var(--secondary-glow);
}
.timeline-dot.completed{
    background:var(--success);
    border-color:var(--success);
    box-shadow:0 0 15px var(--success-glow);
}
.timeline-dot.op{
    background:var(--primary);
    border-color:var(--primary);
    width:24px;height:24px;left:-32px;
    box-shadow:0 0 25px var(--primary-glow);
}
.phase-label{font-weight:700;font-size:1rem;color:var(--text);letter-spacing:-.01em}
.phase-date{font-size:.85rem;color:var(--muted)}
/* Tasks - Glass */
.task{
    background:var(--glass-bg);
    backdrop-filter:blur(10px);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    padding:var(--space-4);margin-bottom:var(--space-3);
    transition:all .2s;
    box-shadow:var(--glass-highlight);
}
.task:hover{border-color:var(--primary);box-shadow:var(--glass-highlight),0 0 15px var(--primary-glow)}
.task.completed{opacity:.5}
.task.completed .task-title{text-decoration:line-through;color:var(--muted)}
.task-header{display:flex;align-items:flex-start;gap:var(--space-3)}
.task-check{
    width:26px;height:26px;min-width:26px;
    border:2px solid var(--glass-border);
    border-radius:50%;cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    font-size:.8rem;transition:all .2s;
    background:var(--surface);
}
.task-check:hover{border-color:var(--primary);box-shadow:0 0 15px var(--primary-glow)}
.task-check.checked{
    background:var(--success);
    border-color:var(--success);
    color:#0A0F1A;
    box-shadow:0 0 15px var(--success-glow);
}
.task-title{font-weight:600;font-size:.95rem;color:var(--text)}
.task-desc{font-size:.85rem;color:var(--muted);margin-top:4px;line-height:1.6}
.task-note{
    margin-top:var(--space-3);padding:var(--space-3);
    background:var(--surface-2);
    border-radius:var(--radius-md);
    font-size:.9rem;color:var(--text);
    border:1px solid var(--glass-border);
}
.add-note-btn{
    margin-top:var(--space-3);padding:var(--space-2) var(--space-3);
    border:none;background:transparent;
    color:var(--primary);font-weight:600;font-size:.85rem;
    cursor:pointer;transition:all .2s;
    border-radius:var(--radius-md);
}
.add-note-btn:hover{background:rgba(45,212,191,0.1)}
.fasting{background-color:rgba(217,119,6,.08);border:1px solid var(--warning);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-4)}
.fasting-title{font-weight:700;margin-bottom:var(--space-3);display:flex;align-items:center;gap:var(--space-2);color:var(--text)}
.fasting-rule{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-3);background-color:var(--surface);border-radius:var(--radius-sm);margin-bottom:var(--space-2);border:1px solid var(--border)}
.fasting-rule:last-child{margin-bottom:0}
.fasting-icon{font-size:1.2rem}
.fasting-text strong{display:block;font-size:.875rem;color:var(--text)}
.fasting-text span{font-size:.8rem;color:var(--muted)}
/* Tabs - Neon Underline */
.tabs{display:flex;gap:var(--space-2);overflow-x:auto;padding-bottom:var(--space-3);margin-bottom:var(--space-5)}
.tab{
    padding:var(--space-3) var(--space-5);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-xl);
    background:var(--glass-bg);
    color:var(--muted);font-weight:600;font-size:.9rem;
    white-space:nowrap;cursor:pointer;
    transition:all .2s;min-height:44px;
    backdrop-filter:blur(8px);
}
.tab:hover{border-color:var(--primary);color:var(--text)}
.tab.active{
    background:var(--primary);
    color:#0A0F1A;
    border-color:var(--primary);
    box-shadow:0 0 25px var(--primary-glow);
}
.info-content{background-color:var(--surface);border-radius:var(--radius-md);padding:var(--space-5);border:1px solid var(--border)}
.info-list{list-style:none}
.info-list li{padding:var(--space-2) 0;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;gap:var(--space-3);font-size:.9rem;line-height:1.6;color:var(--text)}
.info-list li:last-child{border-bottom:none}
.info-list li::before{content:'•';color:var(--primary);font-weight:bold}
.disclaimer{background-color:var(--surface-2);border-radius:var(--radius-md);padding:var(--space-4);font-size:.85rem;color:var(--muted);display:flex;gap:var(--space-3);margin-top:var(--space-4);line-height:1.5}
.emergency{background-color:var(--danger);border-radius:var(--radius-md);padding:var(--space-5);margin-bottom:var(--space-4);color:#fff;text-align:center}
.emergency-title{font-size:1.1rem;font-weight:700;margin-bottom:var(--space-3)}
.emergency-btn{display:inline-flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-5);background:#fff;color:var(--danger);border-radius:var(--radius-xl);font-weight:700;text-decoration:none;margin-top:var(--space-3);min-height:44px}
.warning-card{background-color:var(--surface);border:1px solid var(--danger);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-3);display:flex;align-items:flex-start;gap:var(--space-3)}
.warning-card:hover{background-color:rgba(220,38,38,.03)}
.warning-card h4{font-weight:600;font-size:.9rem;color:var(--text)}
.warning-card p{font-size:.8rem;color:var(--muted);line-height:1.5}
.warning-icon{font-size:1.3rem;color:var(--danger);min-width:28px}
.upload-area{border:1px dashed var(--border);border-radius:var(--radius-md);padding:var(--space-5);text-align:center;cursor:pointer;margin-bottom:var(--space-3);transition:all .15s;background-color:var(--surface)}
.upload-area:hover{border-color:var(--primary);background-color:rgba(14,165,233,.03)}
.upload-icon{font-size:1.8rem;margin-bottom:var(--space-2);opacity:.6}
.upload-text{color:var(--muted);font-size:.85rem}
.file-input{display:none}
.photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--space-2);margin-top:var(--space-3)}
.photo-item{aspect-ratio:1;border-radius:var(--radius-sm);overflow:hidden;position:relative;cursor:pointer;border:1px solid var(--border)}
.photo-item img{width:100%;height:100%;object-fit:cover}
.photo-date{position:absolute;bottom:0;left:0;right:0;padding:var(--space-1);background:linear-gradient(transparent,rgba(0,0,0,.6));color:#fff;font-size:.6rem;text-align:center}
.photo-delete{position:absolute;top:var(--space-1);right:var(--space-1);width:24px;height:24px;background:rgba(220,38,38,.9);border:none;border-radius:50%;color:#fff;font-size:.7rem;cursor:pointer;opacity:0;transition:opacity .15s;display:flex;align-items:center;justify-content:center}
.photo-item:hover .photo-delete{opacity:1}
.doc-file{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-3);display:flex;align-items:center;gap:var(--space-3);margin-bottom:var(--space-2);cursor:pointer;transition:border-color .15s}
.doc-file:hover{border-color:var(--primary)}
.doc-file-icon{font-size:1.4rem;opacity:.7}
.doc-file-info{flex:1}
.doc-file-name{font-weight:600;font-size:.85rem;color:var(--text)}
.doc-file-meta{font-size:.75rem;color:var(--muted)}
.doc-file-del{border:none;background:transparent;color:var(--danger);cursor:pointer;padding:var(--space-2);border-radius:var(--radius-sm);min-width:36px;min-height:36px}
.doc-file-del:hover{background-color:rgba(220,38,38,.1)}
.recording-controls{display:flex;flex-direction:column;align-items:center;gap:var(--space-4);padding:var(--space-5);background-color:var(--surface);border-radius:var(--radius-md);border:1px solid var(--border)}
.record-btn{width:72px;height:72px;border-radius:50%;border:none;background-color:var(--primary);color:#fff;font-size:1.6rem;cursor:pointer;box-shadow:var(--shadow-2);display:flex;align-items:center;justify-content:center}
.record-btn:hover{background-color:var(--primary-2)}
.record-btn.recording{background-color:var(--danger);animation:recording 1s infinite}
.recording-status{font-weight:600;color:var(--muted)}
.recording-status.active{color:var(--danger)}
.recording-timer{font-size:1.6rem;font-weight:700;color:var(--text);font-variant-numeric:tabular-nums}
.speech-btn{width:100%;padding:var(--space-4);border:1px solid var(--primary);border-radius:var(--radius-md);background-color:var(--surface);color:var(--primary);font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:var(--space-3);font-family:inherit;transition:all .15s;min-height:56px}
.speech-btn:hover{background-color:rgba(14,165,233,.05)}
.speech-btn.listening{background-color:rgba(220,38,38,.05);border-color:var(--danger);color:var(--danger);animation:recording 1s infinite}
.memo-item{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-3);display:flex;align-items:center;gap:var(--space-3);margin-top:var(--space-3)}
.play-btn{width:40px;height:40px;min-width:40px;border-radius:50%;border:none;background-color:var(--primary);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center}
.play-btn:hover{background-color:var(--primary-2)}
.memo-info{flex:1}
.memo-title{font-weight:600;font-size:.85rem;color:var(--text)}
.memo-meta{font-size:.75rem;color:var(--muted)}
.memo-delete{border:none;background:transparent;color:var(--danger);cursor:pointer;padding:var(--space-2);min-width:36px;min-height:36px;border-radius:var(--radius-sm)}
.memo-delete:hover{background-color:rgba(220,38,38,.1)}
.transcript-item{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-4);margin-top:var(--space-3)}
.transcript-header{display:flex;justify-content:space-between;margin-bottom:var(--space-2)}
.transcript-date{font-size:.8rem;color:var(--muted)}
.transcript-delete{border:none;background:transparent;color:var(--danger);cursor:pointer;min-width:36px;min-height:36px;border-radius:var(--radius-sm)}
.transcript-delete:hover{background-color:rgba(220,38,38,.1)}
.transcript-text{color:var(--text);line-height:1.6}
.transcript-name{font-weight:600;font-size:.9rem;color:var(--primary);margin-bottom:var(--space-1)}
/* VAS Slider - Neon */
.vas-container{
    background:var(--glass-bg);
    backdrop-filter:blur(10px);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    padding:var(--space-5);margin-bottom:var(--space-5);
    box-shadow:var(--glass-highlight);
}
.vas-title{font-weight:700;color:var(--text);margin-bottom:var(--space-3)}
.vas-scale{display:flex;align-items:center;gap:var(--space-4);margin:var(--space-5) 0}
.vas-label{font-size:.8rem;color:var(--muted);min-width:55px}
.vas-slider{
    flex:1;-webkit-appearance:none;height:10px;
    border-radius:5px;
    background:linear-gradient(90deg,var(--success) 0%,var(--warning) 50%,var(--danger) 100%);
    box-shadow:0 0 15px rgba(52,211,153,0.2);
}
.vas-slider::-webkit-slider-thumb{
    -webkit-appearance:none;width:28px;height:28px;
    border-radius:50%;background:#fff;
    border:3px solid var(--primary);
    cursor:pointer;
    box-shadow:var(--shadow-2),0 0 20px var(--primary-glow);
}
.vas-value{
    min-width:40px;text-align:center;
    font-size:1.4rem;font-weight:700;
    background:var(--gradient);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    font-variant-numeric:tabular-nums;
}
.vas-emojis{display:flex;justify-content:space-between;font-size:1.2rem}
.chart-container{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-4)}
.chart-title{font-weight:700;margin-bottom:var(--space-3);color:var(--text)}
.chart-canvas{width:100%;height:150px}
.chart-svg{width:100%;height:100%}
.chart-no-data{display:flex;flex-direction:column;align-items:center;justify-content:center;height:120px;color:var(--muted)}
.chart-no-data-icon{font-size:1.6rem;margin-bottom:var(--space-2);opacity:.5}
.vitals-row{display:flex;gap:var(--space-3);margin-bottom:var(--space-3)}
.vitals-group{flex:1}
.vitals-group label{display:block;font-size:.8rem;color:var(--muted);margin-bottom:var(--space-1)}
.vitals-group input{width:100%;padding:var(--space-3);border:1px solid var(--border);border-radius:var(--radius-sm);background-color:var(--input-bg);color:var(--text);font-size:1rem;text-align:center}
.vitals-group input:focus{outline:none;border-color:var(--primary);box-shadow:var(--focus)}
.appt-card{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-3);display:flex;gap:var(--space-3)}
.appt-date{min-width:50px;text-align:center;padding:var(--space-2);background-color:var(--primary);border-radius:var(--radius-sm);color:#fff}
.appt-day{font-size:1.2rem;font-weight:700;line-height:1}
.appt-month{font-size:.7rem}
.appt-info{flex:1}
.appt-title{font-weight:600;font-size:.9rem;color:var(--text)}
.appt-details{font-size:.8rem;color:var(--muted)}
.appt-delete{border:none;background:transparent;color:var(--danger);cursor:pointer;padding:var(--space-2);min-width:36px;min-height:36px;border-radius:var(--radius-sm)}
.appt-delete:hover{background-color:rgba(220,38,38,.1)}
.med-card{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-3)}
.med-header{display:flex;justify-content:space-between;margin-bottom:var(--space-3)}
.med-name{font-weight:600;color:var(--text)}
.med-dose{font-size:.85rem;color:var(--muted)}
.med-times{display:flex;flex-wrap:wrap;gap:var(--space-2)}
.med-time{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-2) var(--space-3);background-color:var(--surface-2);border-radius:var(--radius-xl);font-size:.8rem;cursor:pointer;color:var(--text);border:1px solid var(--border)}
.med-time:hover{border-color:var(--primary)}
.alarm-dot{width:6px;height:6px;background-color:var(--success);border-radius:50%}
.alarm-dot.off{background-color:var(--muted)}
.doc-item{padding:var(--space-4);display:flex;align-items:center;gap:var(--space-3);border-bottom:1px solid var(--border);cursor:pointer;transition:background-color .15s;min-height:56px}
.doc-item:last-child{border-bottom:none}
.doc-item:hover{background-color:var(--surface-2)}
.doc-check{width:22px;height:22px;min-width:22px;border:2px solid var(--border);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;transition:all .15s}
.doc-item.checked .doc-check{background-color:var(--success);border-color:var(--success);color:#fff}
.doc-icon{font-size:1rem}
.doc-label{flex:1;font-weight:500;font-size:.9rem;color:var(--text)}
.doc-delete{border:none;background:transparent;color:var(--danger);cursor:pointer;opacity:0;padding:var(--space-2);transition:opacity .15s;min-width:36px;min-height:36px;border-radius:var(--radius-sm)}
.doc-item:hover .doc-delete{opacity:1}
/* Settings Card - Glass */
.settings-card{
    background:var(--glass-bg);
    backdrop-filter:var(--glass-blur);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-lg);
    overflow:hidden;margin-bottom:var(--space-5);
    box-shadow:var(--glass-highlight);
}
.settings-item{
    padding:var(--space-4);display:flex;
    align-items:center;justify-content:space-between;
    border-bottom:1px solid var(--glass-border);
    min-height:64px;transition:background .2s;
}
.settings-item:last-child{border-bottom:none}
.settings-item:hover{background:var(--surface)}
.settings-label{display:flex;align-items:center;gap:var(--space-3)}
.settings-icon{font-size:1.2rem;opacity:.8}
.settings-text h4{font-weight:600;font-size:.95rem;color:var(--text)}
.settings-text p{font-size:.85rem;color:var(--muted);line-height:1.5}
/* Toggle - Neon Glow */
.toggle{position:relative;width:54px;height:30px}
.toggle input{opacity:0;width:0;height:0}
.toggle-slider{
    position:absolute;cursor:pointer;inset:0;
    background:var(--surface-2);
    border-radius:15px;transition:.3s;
    border:1px solid var(--glass-border);
}
.toggle-slider::before{
    position:absolute;content:"";
    height:24px;width:24px;left:3px;bottom:2px;
    background:#fff;border-radius:50%;
    transition:.3s;
    box-shadow:var(--shadow-1);
}
.toggle input:checked+.toggle-slider{
    background:var(--primary);
    border-color:var(--primary);
    box-shadow:0 0 20px var(--primary-glow);
}
.toggle input:checked+.toggle-slider::before{transform:translateX(24px)}
.storage-info{background-color:var(--surface-2);border-radius:var(--radius-md);padding:var(--space-4);font-size:.85rem;color:var(--muted);display:flex;gap:var(--space-3);line-height:1.5}
.question-card{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);margin-bottom:var(--space-4);overflow:hidden}
.question-header{padding:var(--space-4);display:flex;align-items:center;gap:var(--space-3)}
.question-header.anaesthesist{background-color:rgba(14,165,233,.08);border-bottom:1px solid var(--primary)}
.question-header.operateur{background-color:rgba(5,150,105,.08);border-bottom:1px solid var(--success)}
.question-icon{font-size:2rem}
.question-header-info h3{font-weight:700;font-size:1rem;color:var(--text)}
.question-header-info p{font-size:.8rem;color:var(--muted);margin-top:2px}
.question-timing{margin:var(--space-3) var(--space-4);padding:var(--space-2) var(--space-4);border-radius:var(--radius-xl);font-size:.8rem;font-weight:600;display:inline-flex;align-items:center;gap:var(--space-2)}
.question-timing.vor-op{background-color:rgba(217,119,6,.1);color:var(--warning)}
.question-timing.op-tag{background-color:rgba(220,38,38,.1);color:var(--danger)}
.question-timing.nach-op{background-color:rgba(5,150,105,.1);color:var(--success)}
.question-body{padding:0 var(--space-4) var(--space-4)}
.question-item{display:flex;align-items:flex-start;gap:var(--space-3);padding:var(--space-3);background-color:var(--surface-2);border-radius:var(--radius-sm);margin-bottom:var(--space-2)}
.question-bullet{color:var(--primary);font-weight:bold}
.question-text{flex:1;color:var(--text);font-size:.875rem;line-height:1.5}
.question-del{border:none;background:transparent;color:var(--danger);cursor:pointer;padding:var(--space-1);min-width:32px;min-height:32px;border-radius:var(--radius-sm)}
.question-del:hover{background-color:rgba(220,38,38,.1)}
.question-empty{padding:var(--space-4);text-align:center;color:var(--muted);font-size:.85rem}
.chat-container{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);overflow:hidden}
.chat-header{padding:var(--space-4);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:var(--space-3);background-color:var(--surface-2)}
.chat-header-icon{font-size:1.4rem}
.chat-header-text h3{font-weight:700;font-size:.95rem;color:var(--text)}
.chat-header-text p{font-size:.75rem;color:var(--muted)}
.chat-messages{height:280px;overflow-y:auto;padding:var(--space-4);background-color:var(--bg)}
.chat-message{margin-bottom:var(--space-3);max-width:85%}
.chat-message.user{margin-left:auto}
.chat-message.assistant{margin-right:auto}
.chat-bubble{padding:var(--space-3) var(--space-4);border-radius:var(--radius-md);font-size:.9rem;line-height:1.6}
.chat-message.user .chat-bubble{background-color:var(--primary);color:#fff;border-bottom-right-radius:var(--radius-sm)}
.chat-message.assistant .chat-bubble{background-color:var(--surface);color:var(--text);border-bottom-left-radius:var(--radius-sm);border:1px solid var(--border)}
.chat-input-area{display:flex;gap:var(--space-2);padding:var(--space-3);border-top:1px solid var(--border);background-color:var(--surface)}
.chat-input{flex:1;padding:var(--space-3);border:1px solid var(--border);border-radius:var(--radius-xl);background-color:var(--input-bg);color:var(--text);font-family:inherit;font-size:.9rem}
.chat-input:focus{outline:none;border-color:var(--primary);box-shadow:var(--focus)}
.chat-send{width:44px;height:44px;min-width:44px;border:none;background-color:var(--primary);color:#fff;border-radius:50%;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center}
.chat-send:hover{background-color:var(--primary-2)}
.chat-disclaimer{padding:var(--space-3);background-color:rgba(217,119,6,.1);font-size:.7rem;color:var(--muted);text-align:center;line-height:1.4}
/* Modal - Glass */
.modal-overlay{
    position:fixed;inset:0;
    background:rgba(0,0,0,.6);
    display:flex;align-items:flex-end;justify-content:center;
    z-index:2000;backdrop-filter:blur(6px);
}
.modal{
    background:var(--glass-bg);
    backdrop-filter:blur(20px) saturate(150%);
    border-radius:var(--radius-xl) var(--radius-xl) 0 0;
    padding:var(--space-5);width:100%;max-width:520px;
    max-height:85vh;overflow-y:auto;
    animation:slideUp .25s ease-out;
    box-shadow:var(--shadow-3),0 0 60px rgba(45,212,191,0.1),var(--glass-highlight);
    border:1px solid var(--glass-border);
    border-bottom:none;
}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-5)}
.modal-title{font-size:1.2rem;font-weight:700;color:var(--text);letter-spacing:-.02em}
.modal-close{
    width:40px;height:40px;
    border:1px solid var(--glass-border);
    background:var(--surface);
    border-radius:50%;font-size:1.1rem;
    cursor:pointer;color:var(--text);
    display:flex;align-items:center;justify-content:center;
    transition:all .2s;
}
.modal-close:hover{background:var(--surface-2);border-color:var(--primary);box-shadow:0 0 15px var(--primary-glow)}

/* Toast - Neon Pill */
.toast{
    position:fixed;bottom:100px;left:50%;
    transform:translateX(-50%);
    background:var(--glass-bg);
    backdrop-filter:blur(16px);
    color:var(--text);
    padding:var(--space-3) var(--space-5);
    border-radius:var(--radius-xl);
    font-weight:600;font-size:.9rem;
    z-index:3000;
    border:1px solid var(--primary);
    box-shadow:var(--shadow-3),0 0 30px var(--primary-glow);
    animation:fadeIn .25s,fadeOut .25s 2.8s forwards;
}
@keyframes fadeOut{to{opacity:0;transform:translate(-50%,10px)}}
.photo-viewer{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:3000;display:flex;flex-direction:column}
.photo-viewer-header{padding:var(--space-4);display:flex;justify-content:space-between;align-items:center;color:#fff}
.photo-viewer-close{width:44px;height:44px;border:none;background:rgba(255,255,255,.1);color:#fff;border-radius:50%;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.photo-viewer-close:hover{background:rgba(255,255,255,.2)}
.photo-viewer-content{flex:1;display:flex;align-items:center;justify-content:center;padding:var(--space-4)}
.photo-viewer-content img{max-width:100%;max-height:100%;object-fit:contain}
.onboarding{min-height:100vh;display:flex;flex-direction:column;background-color:var(--bg)}
.onboarding-progress{padding:var(--space-4);display:flex;gap:var(--space-2)}
.progress-dot{flex:1;height:4px;border-radius:2px;background-color:var(--border)}
.progress-dot.active{background-color:var(--primary)}
.progress-dot.completed{background-color:var(--success)}
.onboarding-content{flex:1;padding:var(--space-4) var(--space-5);display:flex;flex-direction:column;max-width:480px;margin:0 auto;width:100%}
.onboarding-hero{text-align:center;margin-bottom:var(--space-6)}
.onboarding-logo{width:72px;height:72px;margin:0 auto var(--space-4);border-radius:var(--radius-lg)}
.onboarding-title{font-size:1.5rem;font-weight:700;margin-bottom:var(--space-3);color:var(--primary)}
.onboarding-subtitle{font-size:.95rem;color:var(--muted);line-height:1.6}
.onboarding-nav{padding:var(--space-4) var(--space-5);display:flex;gap:var(--space-3);max-width:480px;margin:0 auto;width:100%}
.progress-container{margin-bottom:var(--space-4)}
.progress-label{display:flex;justify-content:space-between;margin-bottom:var(--space-2);font-size:.85rem;color:var(--text)}
.progress-bar{height:8px;background-color:var(--border);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background-color:var(--primary);border-radius:4px;transition:width .3s}
/* Filter Tabs - Glass Neon */
.filter-tabs{display:flex;gap:var(--space-2);flex-wrap:wrap}
.filter-tab{
    padding:var(--space-2) var(--space-4);
    border:1px solid var(--glass-border);
    border-radius:var(--radius-xl);
    background:var(--glass-bg);
    color:var(--muted);font-weight:600;font-size:.9rem;
    cursor:pointer;transition:all .2s;min-height:40px;
    backdrop-filter:blur(8px);
}
.filter-tab:hover{border-color:var(--primary);color:var(--text)}
.filter-tab.active{
    background:var(--primary);
    color:#0A0F1A;
    border-color:var(--primary);
    box-shadow:0 0 20px var(--primary-glow);
}
@media print{.shell,.sidebar,.bottom-nav,.modal-overlay{display:none!important}.detail-pane{position:static!important;transform:none!important}}
.wound-timeline{display:flex;flex-direction:column;gap:var(--space-4)}
.wound-day{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);overflow:hidden}
.wound-day-header{padding:var(--space-4);background-color:var(--surface-2);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:var(--space-3)}
.wound-day-badge{background-color:var(--primary);color:#fff;padding:var(--space-2) var(--space-3);border-radius:var(--radius-xl);font-weight:700;font-size:.85rem}
.wound-day-date{color:var(--muted);font-size:.85rem}
.wound-day-content{padding:var(--space-4)}
.wound-day-photos{display:flex;gap:var(--space-2);flex-wrap:wrap;margin-bottom:var(--space-3)}
.wound-day-photo{width:80px;height:80px;border-radius:var(--radius-sm);overflow:hidden;cursor:pointer;border:1px solid var(--border)}
.wound-day-photo img{width:100%;height:100%;object-fit:cover}
.wound-day-note{padding:var(--space-3);background-color:var(--surface-2);border-radius:var(--radius-sm);font-size:.85rem;color:var(--text);line-height:1.5}
.doctor-mode-card{background-color:var(--surface);border:1px solid var(--primary);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-3)}
.doctor-mode-section{margin-bottom:var(--space-4)}
.doctor-mode-title{font-weight:700;font-size:.875rem;color:var(--primary);margin-bottom:var(--space-2);display:flex;align-items:center;gap:var(--space-2)}
.doctor-mode-value{font-size:.9rem;color:var(--text);line-height:1.5}
.doctor-mode-list{list-style:none;padding-left:0}
.doctor-mode-list li{padding:var(--space-2) 0;border-bottom:1px solid var(--border);font-size:.875rem}
.doctor-mode-list li:last-child{border-bottom:none}
.export-card{background-color:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-3);cursor:pointer;transition:all .15s}
.export-card:hover{border-color:var(--primary)}
.export-icon{font-size:1.6rem;margin-bottom:var(--space-2);opacity:.7}
.export-title{font-weight:600;color:var(--text)}
.export-desc{font-size:.8rem;color:var(--muted);line-height:1.4}
.clinic-call-btn{display:flex;align-items:center;justify-content:center;gap:var(--space-3);width:100%;padding:var(--space-4);background-color:var(--success);border:none;border-radius:var(--radius-md);color:#fff;font-weight:700;font-size:1rem;text-decoration:none;margin-bottom:var(--space-4);cursor:pointer;min-height:52px;box-shadow:var(--shadow-2)}
.clinic-call-btn:hover{background-color:#047857}
.op-mode-toggle{display:flex;gap:var(--space-3)}
.op-mode-btn{flex:1;padding:var(--space-4);border:1px solid var(--border);border-radius:var(--radius-md);background-color:var(--surface);color:var(--text);font-weight:600;cursor:pointer;transition:all .15s;min-height:48px}
.op-mode-btn:hover{border-color:var(--primary)}
.op-mode-btn.active{border-color:var(--primary);background-color:rgba(14,165,233,.05);color:var(--primary)}
input[type="text"],input[type="date"],input[type="datetime-local"],input[type="tel"],input[type="number"],textarea,select{font-size:16px!important}
/* Mobile adjustments */
@media(max-width:859px){
    .toast{bottom:80px}
    .modal{border-radius:var(--radius-lg) var(--radius-lg) 0 0}
}
    </style>
</head>
<body>
<div id="app"></div>
<script>
const LOGO_BASE64="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAQABAADASIAAhEBAxEB/8QAHQABAQEAAgMBAQAAAAAAAAAAAAECAwUEBwgGCf/EAFoQAQABAgMEAwcMDQgJBQADAAABAgMEBREGITFBBxJREyIyUmFxkQgVQlZygZKUobHB0RQYIzM0NlNUYnWVs9IWFyQ1ZXSywiYnN0NGVcPh8CVEZIKic4Oj/8QAGwEBAQACAwEAAAAAAAAAAAAAAAECBQMEBgf/xAA8EQEAAQMCAgUKBQQCAgMBAAAAAQIDEQQFITESE0FRcQYUIjJhkaGxwdEWUlOB4SM1cvA0QiXxFSQzQ//aAAwDAQACEQMRAD8A+ygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf/Z";
// === WORKSPACE ADDITIONS ===
// Extended state properties for workspace model
const WORKSPACE_DEFAULTS = {
    workspace: 'overview',  // overview | plan | docs | health | comms | admin
    selected: { type: null, id: null },
    commandOpen: false,
    commandQuery: '',
    masterTab: 'all',
    detailOpen: false,
    sidebarOpen: false
};

// Workspace definitions
const WORKSPACES = {
    overview: { icon: '🏠', label: 'Überblick', modules: ['countdown', 'today', 'quick-capture', 'appointments', 'warnings'] },
    plan: { icon: '📋', label: 'Plan', modules: ['timeline', 'packlist', 'appointments'] },
    docs: { icon: '📁', label: 'Dokumentation', modules: ['photos', 'wounddiary', 'documents', 'voice'] },
    health: { icon: '❤️', label: 'Gesundheit', modules: ['pain', 'vitals', 'medrecords', 'medications'] },
    comms: { icon: '💬', label: 'Kommunikation', modules: ['questions', 'assistant'] },
    admin: { icon: '⚙️', label: 'Verwaltung', modules: ['export', 'doctormode', 'settings', 'impressum'] }
};

// Command palette actions
const COMMAND_ACTIONS = [
    { id: 'photo', icon: '📷', label: 'Foto aufnehmen', hint: 'Wunddokumentation', action: () => nav('photos') },
    { id: 'pain', icon: '📊', label: 'Schmerz eintragen', hint: 'VAS-Skala', action: () => nav('pain') },
    { id: 'appointment', icon: '📅', label: 'Neuen Termin', hint: 'Termine verwalten', action: () => nav('appointments') },
    { id: 'memo', icon: '🎤', label: 'Sprachmemo', hint: 'Aufnahme starten', action: () => nav('voice') },
    { id: 'question', icon: '❓', label: 'Frage notieren', hint: 'Für Arzt', action: () => nav('questions') },
    { id: 'export', icon: '📤', label: 'Export PDF', hint: 'Bericht erstellen', action: () => nav('export') },
    { id: 'doctor', icon: '👨‍⚕️', label: 'Arztmodus', hint: 'Kompakte Übersicht', action: () => nav('doctormode') },
    { id: 'warning', icon: '⚠️', label: 'Warnzeichen', hint: 'Symptome prüfen', action: () => nav('warning') }
];

function initWorkspace() {
    // Extend state with workspace defaults if missing (direct mutation OK here - called during render, not user action)
    // This ensures backward compatibility when loading existing state from localStorage
    if (!state.workspace) state.workspace = WORKSPACE_DEFAULTS.workspace;
    if (!state.selected) state.selected = WORKSPACE_DEFAULTS.selected;
    if (state.commandOpen === undefined) state.commandOpen = false;
    if (!state.commandQuery) state.commandQuery = '';
    if (state.detailOpen === undefined) state.detailOpen = false;
    if (state.sidebarOpen === undefined) state.sidebarOpen = false;
}

function setWorkspace(ws) {
    setState({ workspace: ws, selected: { type: null, id: null }, detailOpen: false, sidebarOpen: false });
}

function selectItem(type, id) {
    setState({ selected: { type, id }, detailOpen: true });
}

function closeDetail() {
    setState({ selected: { type: null, id: null }, detailOpen: false });
}

function toggleSidebar() {
    setState({ sidebarOpen: !state.sidebarOpen });
}

function toggleCommand() {
    setState({ commandOpen: !state.commandOpen, commandQuery: '' });
}

function setCommandQuery(q) { // Only update query for live filtering, no full re-render needed
    state.commandQuery = q;
    renderCommandResults();
}

function execCommand(actionId) {
    const action = COMMAND_ACTIONS.find(a => a.id === actionId);
    if (action) {
        toggleCommand();
        action.action();
    }
}

// Keyboard shortcut for command palette
document.addEventListener('keydown', e => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        toggleCommand();
    }
    if (e.key === 'Escape' && state.commandOpen) {
        toggleCommand();
    }
});

function renderCommandResults() {
    const container = document.getElementById('commandResults');
    if (!container) return;
    const q = (state.commandQuery || '').toLowerCase();
    const filtered = COMMAND_ACTIONS.filter(a => 
        a.label.toLowerCase().includes(q) || 
        a.hint.toLowerCase().includes(q)
    );
    container.innerHTML = filtered.map(a => `
        <div class="command-item" onclick="execCommand('${a.id}')">
            <div class="command-item-icon">${a.icon}</div>
            <div class="command-item-text">
                <div class="command-item-title">${a.label}</div>
                <div class="command-item-hint">${a.hint}</div>
            </div>
        </div>
    `).join('') || '<div style="padding:16px;text-align:center;color:var(--muted)">Keine Ergebnisse</div>';
}
// === SHELL RENDERING ===
function renderShell() {
    initWorkspace();
    return `
        <div class="shell">
            ${renderSidebar()}
            <div class="sidebar-overlay ${state.sidebarOpen ? 'open' : ''}" onclick="toggleSidebar()"></div>
            <div class="main-area">
                ${renderMaster()}
                ${renderDetailPane()}
            </div>
            ${renderBottomNav()}
        </div>
        ${state.commandOpen ? renderCommandPalette() : ''}
    `;
}

function renderSidebar() {
    const ws = WORKSPACES;
    return `
        <aside class="sidebar ${state.sidebarOpen ? 'open' : ''}">
            <div class="sidebar-header">
                <img src="${LOGO_BASE64}" class="sidebar-logo" alt="Logo">
                <span class="sidebar-title">Operationsbegleiter</span>
            </div>
            <div class="sidebar-search">
                <input type="text" placeholder="Suchen... (⌘K)" onclick="toggleCommand()" readonly>
            </div>
            <nav class="sidebar-nav">
                ${Object.entries(ws).map(([key, w]) => `
                    <div class="nav-item ${state.workspace === key ? 'active' : ''}" onclick="setWorkspace('${key}')">
                        <span class="nav-item-icon">${w.icon}</span>
                        <span class="nav-item-label">${w.label}</span>
                        ${key === 'plan' && getOpenTaskCount() > 0 ? `<span class="nav-item-badge">${getOpenTaskCount()}</span>` : ''}
                    </div>
                `).join('')}
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-profile" onclick="nav('settings')">
                    <div class="profile-avatar">${(state.profile.opType || 'OP').charAt(0)}</div>
                    <div class="profile-info">
                        <div class="profile-name">${state.profile.opType || 'Meine OP'}</div>
                        <div class="profile-status">${formatDate(state.profile.opDate)}</div>
                    </div>
                </div>
                <button class="quick-btn" style="width:100%;margin-top:8px;" onclick="toggleTheme()">
                    ${state.theme === 'light' ? '🌙 Dark Mode' : '☀️ Light Mode'}
                </button>
            </div>
        </aside>
    `;
}

function renderBottomNav() {
    const items = [
        { ws: 'overview', icon: '🏠', label: 'Home' },
        { ws: 'plan', icon: '📋', label: 'Plan' },
        { ws: 'docs', icon: '📁', label: 'Doku' },
        { ws: 'health', icon: '❤️', label: 'Gesundheit' },
        { ws: 'admin', icon: '⚙️', label: 'Mehr' }
    ];
    return `
        <nav class="bottom-nav">
            ${items.map(i => `
                <div class="bottom-nav-item ${state.workspace === i.ws ? 'active' : ''}" onclick="setWorkspace('${i.ws}')">
                    <span class="bottom-nav-item-icon">${i.icon}</span>
                    <span class="bottom-nav-item-label">${i.label}</span>
                </div>
            `).join('')}
        </nav>
    `;
}

function renderKpiHeader() {
    const d = getDaysUntil();
    const openTasks = getOpenTaskCount();
    const nextAppt = state.appointments.filter(a => new Date(a.datetime) > new Date())[0];
    
    let countdownText = '', countdownClass = '';
    if (d !== null) {
        if (d < 0) {
            countdownText = `D+${Math.abs(d)}`;
            countdownClass = 'success';
        } else if (d === 0) {
            countdownText = 'HEUTE';
            countdownClass = 'warning';
        } else {
            countdownText = `D-${d}`;
            countdownClass = d <= 3 ? 'warning' : '';
        }
    }
    
    const opModeClass = state.profile.opMode === 'ambulant' ? 'ambulant' : 'stationary';
    const opModeLabel = state.profile.opMode === 'ambulant' ? 'Ambulant' : 'Stationär';
    
    return `
        <div class="kpi-header">
            <div class="kpi-top">
                <div class="kpi-info">
                    <span class="kpi-op-badge">${state.profile.opType || 'OP'}</span>
                    <span class="kpi-op-date">📅 ${formatDate(state.profile.opDate)}</span>
                    <span class="kpi-mode ${opModeClass}">${opModeLabel}</span>
                </div>
                <div class="kpi-quick-actions">
                    <button class="quick-btn" onclick="nav('photos')" title="Foto">📷</button>
                    <button class="quick-btn" onclick="nav('voice')" title="Memo">🎤</button>
                    <button class="quick-btn" onclick="nav('documents')" title="Dokument">📄</button>
                    <button class="quick-btn danger" onclick="nav('warning')" title="Warnzeichen">⚠️</button>
                    <button class="quick-btn" onclick="toggleCommand()" title="Suche (⌘K)">🔍</button>
                </div>
            </div>
            <div class="kpi-chips">
                ${countdownText ? `
                    <div class="kpi-chip ${countdownClass ? 'highlight' : ''}">
                        <span class="kpi-chip-value">${countdownText}</span>
                        <span class="kpi-chip-label">${d >= 0 ? 'bis OP' : 'nach OP'}</span>
                    </div>
                ` : ''}
                <div class="kpi-chip ${openTasks > 0 ? 'warning' : ''}">
                    <span class="kpi-chip-value">${openTasks}</span>
                    <span class="kpi-chip-label">offene Tasks</span>
                </div>
                ${nextAppt ? `
                    <div class="kpi-chip">
                        <span class="kpi-chip-value">${formatShort(nextAppt.datetime)}</span>
                        <span class="kpi-chip-label">${nextAppt.title}</span>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

function getOpenTaskCount() {
    return state.tasks.filter(t => !t.completed).length;
}

function renderMaster() {
    const ws = state.workspace;
    let content = '';
    let title = WORKSPACES[ws]?.label || 'Überblick';
    let subtitle = '';
    
    switch(ws) {
        case 'overview':
            content = renderOverviewMaster();
            subtitle = 'Dashboard & Schnellzugriff';
            break;
        case 'plan':
            content = renderPlanMaster();
            subtitle = 'Timeline, Termine & Packliste';
            break;
        case 'docs':
            content = renderDocsMaster();
            subtitle = 'Fotos, Dokumente & Memos';
            break;
        case 'health':
            content = renderHealthMaster();
            subtitle = 'Schmerz, Vitalwerte & Medikamente';
            break;
        case 'comms':
            content = renderCommsMaster();
            subtitle = 'Fragen & KI-Assistent';
            break;
        case 'admin':
            content = renderAdminMaster();
            subtitle = 'Export, Einstellungen & Arztmodus';
            break;
        default:
            content = renderOverviewMaster();
    }
    
    return `
        <div class="master-pane">
            <div class="mobile-header" style="display:none;padding:12px 16px;background:var(--surface);border-bottom:1px solid var(--border);">
                <button class="quick-btn" onclick="toggleSidebar()" style="margin-right:12px;">☰</button>
                <span style="font-weight:700;font-size:1rem;">${WORKSPACES[ws]?.icon} ${title}</span>
            </div>
            ${renderKpiHeader()}
            <div class="master-header">
                <div>
                    <div class="master-title">${WORKSPACES[ws]?.icon} ${title}</div>
                    <div class="master-subtitle">${subtitle}</div>
                </div>
            </div>
            <div class="master-content">
                ${content}
            </div>
        </div>
    `;
}

function renderOverviewMaster() {
    const d = getDaysUntil();
    const nextTasks = state.tasks.filter(t => !t.completed).sort((a,b) => a.day - b.day).slice(0, 3);
    const nextAppts = state.appointments.filter(a => new Date(a.datetime) > new Date()).slice(0, 2);
    
    let cv = '?', cu = 'Datum wählen';
    if (d !== null) {
        if (d < 0) { cv = `+${Math.abs(d)}`; cu = 'Tage nach OP'; }
        else if (d === 0) { cv = '🎯'; cu = 'OP-Tag!'; }
        else { cv = d; cu = d === 1 ? 'Tag bis OP' : 'Tage bis OP'; }
    }
    
    return `
        <div class="widgets-grid">
            <!-- Countdown Widget -->
            <div class="widget">
                <div class="widget-header">
                    <span class="widget-title">🎯 Countdown</span>
                </div>
                <div class="widget-content">
                    <div class="widget-countdown">
                        <div class="countdown-value">${cv}</div>
                        <div class="countdown-label">${cu}</div>
                        <div class="countdown-date">📅 ${formatDate(state.profile.opDate)}</div>
                    </div>
                </div>
            </div>
            
            <!-- Today Tasks Widget -->
            <div class="widget">
                <div class="widget-header">
                    <span class="widget-title">📌 Nächste Aufgaben</span>
                    <span class="widget-more" onclick="setWorkspace('plan')">Alle →</span>
                </div>
                <div class="widget-content">
                    <div class="widget-list">
                        ${nextTasks.length ? nextTasks.map(t => `
                            <div class="widget-item" onclick="selectItem('task', '${t.id}')">
                                <span class="widget-item-icon">${t.completed ? '✅' : '⬜'}</span>
                                <div class="widget-item-content">
                                    <div class="widget-item-title">${t.title}</div>
                                    <div class="widget-item-desc">${t.day === 0 ? 'OP-Tag' : t.day > 0 ? 'D+' + t.day : 'D' + t.day}</div>
                                </div>
                            </div>
                        `).join('') : '<div style="text-align:center;padding:16px;color:var(--muted)">🎉 Alle erledigt!</div>'}
                    </div>
                </div>
            </div>
            
            <!-- Quick Capture Widget -->
            <div class="widget">
                <div class="widget-header">
                    <span class="widget-title">⚡ Schnell-Erfassung</span>
                </div>
                <div class="widget-content">
                    <div style="display:flex;gap:8px;flex-wrap:wrap;">
                        <button class="btn btn-secondary btn-sm" onclick="nav('photos')">📷 Foto</button>
                        <button class="btn btn-secondary btn-sm" onclick="nav('documents')">📄 Dokument</button>
                        <button class="btn btn-secondary btn-sm" onclick="nav('voice')">🎤 Memo</button>
                        <button class="btn btn-secondary btn-sm" onclick="nav('pain')">📊 Schmerz</button>
                    </div>
                </div>
            </div>
            
            <!-- Appointments Widget -->
            ${nextAppts.length ? `
            <div class="widget">
                <div class="widget-header">
                    <span class="widget-title">📅 Nächste Termine</span>
                    <span class="widget-more" onclick="nav('appointments')">Alle →</span>
                </div>
                <div class="widget-content">
                    <div class="widget-list">
                        ${nextAppts.map(a => {
                            const dt = new Date(a.datetime);
                            return `
                            <div class="widget-item" onclick="selectItem('appointment', '${a.id}')">
                                <span class="widget-item-icon">📅</span>
                                <div class="widget-item-content">
                                    <div class="widget-item-title">${a.title}</div>
                                    <div class="widget-item-desc">${dt.toLocaleDateString('de-DE', {day:'numeric',month:'short'})} • ${dt.toLocaleTimeString('de-DE', {hour:'2-digit',minute:'2-digit'})} Uhr</div>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                </div>
            </div>
            ` : ''}
            
            <!-- Warning Widget -->
            <div class="widget" style="border-color:var(--danger)">
                <div class="widget-header" style="background:rgba(220,38,38,.05)">
                    <span class="widget-title" style="color:var(--danger)">⚠️ Warnzeichen</span>
                    <span class="widget-more" onclick="nav('warning')">Info →</span>
                </div>
                <div class="widget-content">
                    <p style="font-size:.85rem;color:var(--muted);margin-bottom:8px;">Bei folgenden Symptomen sofort Klinik kontaktieren:</p>
                    <div style="display:flex;flex-wrap:wrap;gap:6px;">
                        <span class="badge danger" style="font-size:.7rem;">Starke Blutung</span>
                        <span class="badge danger" style="font-size:.7rem;">Fieber >38.5°</span>
                        <span class="badge danger" style="font-size:.7rem;">Atemnot</span>
                    </div>
                    ${state.profile.hospitalPhone ? `
                        <a href="tel:${state.profile.hospitalPhone}" class="clinic-call-btn" style="margin-top:12px;margin-bottom:0;">
                            📞 Klinik anrufen
                        </a>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
}

function renderPlanMaster() {
    return `
        <div class="master-tabs">
            <button class="master-tab active" onclick="nav('timeline')">📋 Timeline</button>
            <button class="master-tab" onclick="nav('appointments')">📅 Termine</button>
            <button class="master-tab" onclick="nav('packlist')">📦 Packliste</button>
        </div>
        <div class="master-list">
            ${renderTimelineCompact()}
        </div>
    `;
}

function renderTimelineCompact() {
    const d = getDaysUntil();
    const grouped = {};
    state.tasks.forEach(t => { if(!grouped[t.day]) grouped[t.day]=[]; grouped[t.day].push(t); });
    const days = Object.keys(grouped).map(Number).sort((a,b) => a - b);
    
    return days.map(day => {
        const tasks = grouped[day];
        const today = day === -d;
        const allDone = tasks.every(t => t.completed);
        return `
            <div class="item-card ${today ? 'selected' : ''}" onclick="selectItem('day', '${day}')">
                <div class="item-card-header">
                    <span class="item-card-icon">${day === 0 ? '🎯' : day > 0 ? '🏥' : '📋'}</span>
                    <div>
                        <div class="item-card-title">${day === 0 ? 'OP-Tag' : day > 0 ? 'D+' + day : 'D' + day}${today ? ' (Heute)' : ''}</div>
                        <div class="item-card-meta">${tasks.length} Aufgaben • ${tasks.filter(t=>t.completed).length} erledigt</div>
                    </div>
                </div>
                <span class="item-card-badge ${allDone ? 'success' : 'warning'}">${allDone ? '✓ Erledigt' : 'Offen'}</span>
            </div>
        `;
    }).join('');
}

function renderDocsMaster() {
    return `
        <div class="master-tabs">
            <button class="master-tab active" onclick="nav('photos')">📷 Fotos</button>
            <button class="master-tab" onclick="nav('wounddiary')">📔 Wundtagebuch</button>
            <button class="master-tab" onclick="nav('documents')">📁 Dokumente</button>
            <button class="master-tab" onclick="nav('voice')">🎤 Sprache</button>
        </div>
        <div class="master-list">
            <div class="item-card" onclick="nav('photos')">
                <div class="item-card-header">
                    <span class="item-card-icon">📷</span>
                    <div>
                        <div class="item-card-title">Fotos</div>
                        <div class="item-card-meta">${state.photos.length} Fotos gespeichert</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('wounddiary')">
                <div class="item-card-header">
                    <span class="item-card-icon">📔</span>
                    <div>
                        <div class="item-card-title">Wundtagebuch</div>
                        <div class="item-card-meta">Chronologische Übersicht</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('documents')">
                <div class="item-card-header">
                    <span class="item-card-icon">📁</span>
                    <div>
                        <div class="item-card-title">Dokumente</div>
                        <div class="item-card-meta">${state.uploadedDocs.length} hochgeladen</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('voice')">
                <div class="item-card-header">
                    <span class="item-card-icon">🎤</span>
                    <div>
                        <div class="item-card-title">Sprache & Transkripte</div>
                        <div class="item-card-meta">${state.voiceMemos.length} Memos, ${state.transcripts.length} Transkripte</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function renderHealthMaster() {
    return `
        <div class="master-tabs">
            <button class="master-tab active" onclick="nav('pain')">📊 Schmerz</button>
            <button class="master-tab" onclick="nav('vitals')">❤️ Vitalwerte</button>
            <button class="master-tab" onclick="nav('medrecords')">💊 Med-Doku</button>
            <button class="master-tab" onclick="nav('medications')">⏰ Med-Plan</button>
        </div>
        <div class="master-list">
            <div class="item-card" onclick="nav('pain')">
                <div class="item-card-header">
                    <span class="item-card-icon">📊</span>
                    <div>
                        <div class="item-card-title">Schmerz-Tracking</div>
                        <div class="item-card-meta">${state.painRecords.length} Einträge</div>
                    </div>
                </div>
                ${state.painRecords.length ? `<span class="item-card-badge primary">${state.painRecords[state.painRecords.length-1].value}/10</span>` : ''}
            </div>
            <div class="item-card" onclick="nav('vitals')">
                <div class="item-card-header">
                    <span class="item-card-icon">❤️</span>
                    <div>
                        <div class="item-card-title">Vitalwerte</div>
                        <div class="item-card-meta">${state.vitalsRecords.length} Messungen</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('medrecords')">
                <div class="item-card-header">
                    <span class="item-card-icon">💊</span>
                    <div>
                        <div class="item-card-title">Medikamenten-Doku</div>
                        <div class="item-card-meta">${state.medicationRecords.length} protokolliert</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('medications')">
                <div class="item-card-header">
                    <span class="item-card-icon">⏰</span>
                    <div>
                        <div class="item-card-title">Medikamentenplan</div>
                        <div class="item-card-meta">${state.medications.length} Medikamente</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function renderCommsMaster() {
    const totalQuestions = (state.questions.anaesthesist?.length || 0) + (state.questions.operateur?.length || 0);
    return `
        <div class="master-tabs">
            <button class="master-tab active" onclick="nav('questions')">❓ Fragen</button>
            <button class="master-tab" onclick="nav('assistant')">🤖 KI-Assistent</button>
        </div>
        <div class="master-list">
            <div class="item-card" onclick="nav('questions')">
                <div class="item-card-header">
                    <span class="item-card-icon">❓</span>
                    <div>
                        <div class="item-card-title">Fragen an Ärzte</div>
                        <div class="item-card-meta">${totalQuestions} Fragen notiert</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('assistant')">
                <div class="item-card-header">
                    <span class="item-card-icon">🤖</span>
                    <div>
                        <div class="item-card-title">KI-Assistent</div>
                        <div class="item-card-meta">Medizinische Fragen</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function renderAdminMaster() {
    return `
        <div class="master-list">
            <div class="item-card" onclick="nav('doctormode')">
                <div class="item-card-header">
                    <span class="item-card-icon">👨‍⚕️</span>
                    <div>
                        <div class="item-card-title">Arztmodus</div>
                        <div class="item-card-meta">Kompakte Patientenübersicht</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('export')">
                <div class="item-card-header">
                    <span class="item-card-icon">📤</span>
                    <div>
                        <div class="item-card-title">Export</div>
                        <div class="item-card-meta">PDF & Berichte erstellen</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('info')">
                <div class="item-card-header">
                    <span class="item-card-icon">ℹ️</span>
                    <div>
                        <div class="item-card-title">OP-Infos</div>
                        <div class="item-card-meta">Ablauf, FAQ</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('settings')">
                <div class="item-card-header">
                    <span class="item-card-icon">⚙️</span>
                    <div>
                        <div class="item-card-title">Einstellungen</div>
                        <div class="item-card-meta">OP-Daten, Design, Backup</div>
                    </div>
                </div>
            </div>
            <div class="item-card" onclick="nav('impressum')">
                <div class="item-card-header">
                    <span class="item-card-icon">📜</span>
                    <div>
                        <div class="item-card-title">Impressum</div>
                        <div class="item-card-meta">Rechtliche Informationen</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function renderDetailPane() {
    const screen = state.currentScreen;
    const hasDetail = screen !== 'dashboard' && screen !== 'onboarding';
    
    // Map old screens to new detail content
    let content = '';
    let title = '';
    
    if (!hasDetail && !state.selected.id) {
        content = `
            <div class="detail-empty">
                <div class="detail-empty-icon">📋</div>
                <div style="font-size:1.1rem;font-weight:600;margin-bottom:8px;">Wählen Sie ein Element</div>
                <div>Klicken Sie auf einen Eintrag in der Liste, um Details anzuzeigen.</div>
            </div>
        `;
        title = 'Details';
    } else {
        // Render the actual screen content
        content = `<div style="padding:0;">${renderScreenContent()}</div>`;
        title = getScreenTitle(screen);
    }
    
    return `
        <div class="detail-pane ${state.detailOpen ? 'open' : ''}">
            <div class="detail-header">
                <button class="detail-back" onclick="closeDetail()">←</button>
                <div class="detail-title">${title}</div>
                <div class="detail-actions">
                    <button class="quick-btn" onclick="toggleTheme()">${state.theme === 'light' ? '🌙' : '☀️'}</button>
                </div>
            </div>
            <div class="detail-content">
                ${content}
            </div>
        </div>
    `;
}

function getScreenTitle(screen) {
    const titles = {
        dashboard: 'Dashboard',
        timeline: 'Timeline',
        info: 'OP-Infos',
        warning: 'Warnzeichen',
        photos: 'Fotos',
        documents: 'Dokumente',
        voice: 'Sprache & Memos',
        pain: 'Schmerz-Tracking',
        vitals: 'Vitalwerte',
        medrecords: 'Medikamenten-Doku',
        appointments: 'Termine',
        medications: 'Medikamentenplan',
        questions: 'Fragen',
        packlist: 'Packliste',
        assistant: 'KI-Assistent',
        settings: 'Einstellungen',
        wounddiary: 'Wundtagebuch',
        doctormode: 'Arztmodus',
        export: 'Export',
        impressum: 'Impressum'
    };
    return titles[screen] || 'Details';
}

function renderScreenContent() {
    switch(state.currentScreen) {
        case 'dashboard': return '';
        case 'timeline': return renderTimeline();
        case 'info': return renderInfo();
        case 'warning': return renderWarning();
        case 'photos': return renderPhotos();
        case 'documents': return renderDocuments();
        case 'voice': return renderVoice();
        case 'pain': return renderPain();
        case 'vitals': return renderVitals();
        case 'medrecords': return renderMedRecords();
        case 'appointments': return renderAppts();
        case 'medications': return renderMeds();
        case 'questions': return renderQuestions();
        case 'packlist': return renderPacklist();
        case 'assistant': return renderAssistant();
        case 'settings': return renderSettings();
        case 'wounddiary': return renderWoundDiary();
        case 'doctormode': return renderDoctorMode();
        case 'export': return renderExport();
        case 'impressum': return renderImpressum();
        default: return '';
    }
}

function renderCommandPalette() {
    return `
        <div class="command-overlay" onclick="toggleCommand()">
            <div class="command-modal" onclick="event.stopPropagation()">
                <div class="command-input-wrap">
                    <input type="text" class="command-input" placeholder="Suchen oder Aktion ausführen..." 
                           value="${state.commandQuery || ''}" 
                           oninput="setCommandQuery(this.value)" 
                           autofocus>
                </div>
                <div class="command-results" id="commandResults">
                    ${COMMAND_ACTIONS.map(a => `
                        <div class="command-item" onclick="execCommand('${a.id}')">
                            <div class="command-item-icon">${a.icon}</div>
                            <div class="command-item-text">
                                <div class="command-item-title">${a.label}</div>
                                <div class="command-item-hint">${a.hint}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="command-footer">
                    <span>↑↓ Navigieren</span>
                    <span>↵ Ausführen</span>
                    <span>Esc Schließen</span>
                </div>
            </div>
        </div>
    `;
}
const APP_KEY='operationsbegleiter_v3';
const DB_NAME='operationsbegleiter-db';
const DB_VERSION=1;
const MEDIA_STORE='media';
let db=null;
const mediaUrlCache=new Map();
const MAX_CACHE_SIZE=50;

function openDB(){return new Promise((resolve,reject)=>{if(db){resolve(db);return;}const request=indexedDB.open(DB_NAME,DB_VERSION);request.onerror=()=>reject(request.error);request.onsuccess=()=>{db=request.result;resolve(db);};request.onupgradeneeded=(e)=>{const database=e.target.result;if(!database.objectStoreNames.contains(MEDIA_STORE)){database.createObjectStore(MEDIA_STORE,{keyPath:'id'});}};});}

function putMedia({blob,mime,meta={}}){return new Promise(async(resolve,reject)=>{try{const database=await openDB();const mediaId='media_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);const tx=database.transaction(MEDIA_STORE,'readwrite');const store=tx.objectStore(MEDIA_STORE);const record={id:mediaId,blob:blob,mime:mime||blob.type,createdAt:new Date().toISOString(),meta:meta};store.put(record);tx.oncomplete=()=>resolve(mediaId);tx.onerror=()=>reject(tx.error);}catch(e){reject(e);}});}

function getMedia(mediaId){return new Promise(async(resolve,reject)=>{try{if(!mediaId){resolve(null);return;}const database=await openDB();const tx=database.transaction(MEDIA_STORE,'readonly');const store=tx.objectStore(MEDIA_STORE);const request=store.get(mediaId);request.onsuccess=()=>{const result=request.result;if(result){resolve({blob:result.blob,mime:result.mime,meta:result.meta});}else{resolve(null);}};request.onerror=()=>reject(request.error);}catch(e){reject(e);}});}

function deleteMedia(mediaId){return new Promise(async(resolve,reject)=>{try{if(!mediaId){resolve();return;}const database=await openDB();const tx=database.transaction(MEDIA_STORE,'readwrite');const store=tx.objectStore(MEDIA_STORE);store.delete(mediaId);tx.oncomplete=()=>{revokeFromCache(mediaId);resolve();};tx.onerror=()=>reject(tx.error);}catch(e){reject(e);}});}

function clearAllMedia(){return new Promise(async(resolve,reject)=>{try{const database=await openDB();const tx=database.transaction(MEDIA_STORE,'readwrite');const store=tx.objectStore(MEDIA_STORE);store.clear();tx.oncomplete=()=>{mediaUrlCache.forEach((url)=>URL.revokeObjectURL(url));mediaUrlCache.clear();resolve();};tx.onerror=()=>reject(tx.error);}catch(e){reject(e);}});}

function dataURLToBlob(dataURL){try{const parts=dataURL.split(',');const mime=parts[0].match(/:(.*?);/)[1];const bstr=atob(parts[1]);let n=bstr.length;const u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n);}return new Blob([u8arr],{type:mime});}catch(e){console.error('dataURLToBlob error:',e);return null;}}

function getCachedUrl(mediaId,blob){if(mediaUrlCache.has(mediaId)){return mediaUrlCache.get(mediaId);}if(mediaUrlCache.size>=MAX_CACHE_SIZE){const oldest=mediaUrlCache.keys().next().value;URL.revokeObjectURL(mediaUrlCache.get(oldest));mediaUrlCache.delete(oldest);}const url=URL.createObjectURL(blob);mediaUrlCache.set(mediaId,url);return url;}

function revokeFromCache(mediaId){if(mediaUrlCache.has(mediaId)){URL.revokeObjectURL(mediaUrlCache.get(mediaId));mediaUrlCache.delete(mediaId);}}

async function migrateMediaToIndexedDB(){if(state.migrations&&state.migrations.mediaToIndexedDB)return;let migrated=0;try{await openDB();const newPhotos=[];for(const p of state.photos){if(p.data&&!p.mediaId){try{const blob=dataURLToBlob(p.data);if(blob){const mediaId=await putMedia({blob,mime:'image/jpeg',meta:{category:p.category}});newPhotos.push({id:p.id,mediaId:mediaId,category:p.category,date:p.date,note:p.note||'',mime:'image/jpeg',size:blob.size});migrated++;}else{newPhotos.push(p);}}catch(e){console.error('Photo migration error:',e);newPhotos.push(p);}}else{newPhotos.push(p);}}state.photos=newPhotos;const newDocs=[];for(const d of state.uploadedDocs){if(d.data&&!d.mediaId){try{const blob=dataURLToBlob(d.data);if(blob){const mediaId=await putMedia({blob,mime:d.type,meta:{name:d.name}});newDocs.push({id:d.id,mediaId:mediaId,name:d.name,size:blob.size,type:d.type,date:d.date});migrated++;}else{newDocs.push(d);}}catch(e){console.error('Doc migration error:',e);newDocs.push(d);}}else{newDocs.push(d);}}state.uploadedDocs=newDocs;const newMemos=[];for(const m of state.voiceMemos){if(m.data&&!m.mediaId){try{const blob=dataURLToBlob(m.data);if(blob){const mediaId=await putMedia({blob,mime:blob.type||'audio/webm',meta:{title:m.title}});newMemos.push({id:m.id,mediaId:mediaId,date:m.date,duration:m.duration,title:m.title,mime:blob.type||'audio/webm',size:blob.size});migrated++;}else{newMemos.push(m);}}catch(e){console.error('Memo migration error:',e);newMemos.push(m);}}else{newMemos.push(m);}}state.voiceMemos=newMemos;state.migrations={...(state.migrations||{}),mediaToIndexedDB:true};saveState();if(migrated>0)showToast(`${migrated} Medien zu IndexedDB migriert ✓`);}catch(e){console.error('Migration error:',e);showToast('Medienmigration fehlgeschlagen');}}

const LANGUAGES={de:{name:'Deutsch',flag:'🇩🇪'}};
const T={de:{welcome:'Willkommen!',subtitle:'Ihr persönlicher Begleiter für die OP-Vorbereitung.',medicalNote:'Medizinischer Hinweis',medicalNoteDesc:'Diese App ersetzt keine ärztliche Beratung.',privacy:'Datenschutz',privacyDesc:'Alle Daten bleiben lokal auf Ihrem Gerät.',next:'Weiter →',back:'← Zurück',letsGo:'Los geht\'s! 🎉',yourOp:'Ihre Operation',whenWhat:'Wann und was wird operiert?',opDate:'OP-Datum',opType:'Art der OP',opTypePlaceholder:'z.B. Kniearthroskopie, Gallenblasen-OP',contacts:'Kontakte (optional)',contactsSubtitle:'Für Ihre Unterlagen.',forEmergency:'Für den Notfall.',clinic:'Klinik',clinicPlaceholder:'Name der Klinik',phone:'Telefon',emergencyContact:'Notfallkontakt',allReady:'Alles bereit!',timelineCreated:'Ihre Timeline wurde erstellt.',daysToOp:'Tage bis OP',quickAccess:'Schnellzugriff',nextTasks:'Nächste Aufgaben',all:'Alle →',timeline:'Timeline',questions:'Fragen',photos:'Fotos',woundDiary:'Wundtagebuch',doctorMode:'Arztmodus',voice:'Sprache',menu:'Menü',settings:'Einstellungen',language:'Sprache',selectLanguage:'Sprache wählen',ambulant:'Ambulant',stationary:'Stationär',opMode:'OP-Art',opModeDesc:'Wird die OP ambulant oder stationär durchgeführt?',packingList:'Packliste',medications:'Medikamente',appointments:'Termine',documents:'Dokumente',pain:'Schmerzen',vitals:'Vitalwerte',assistant:'KI-Assistent',warning:'Warnzeichen',export:'Export',darkMode:'Dunkler Modus',largeFont:'Große Schrift',notifications:'Erinnerungen',data:'Daten',legal:'Rechtliches',impressum:'Impressum & Datenschutz',adFree:'Werbefreie Version',adFreeDesc:'Zur werbefreien Version wechseln',transport:'Transport',transportSubtitle:'Planen Sie Ihre Anfahrt.',departureTime:'Abfahrtszeit',travelDuration:'Fahrtdauer (Minuten)',transportAlt:'Transportalternative',transportAltPlaceholder:'z.B. Taxi, ÖPNV',fastingAlarm:'Nüchtern-Wecker',noEating:'Ab jetzt nichts mehr essen',clearFluidsOnly:'Nur noch klare Flüssigkeiten',woundAlarm:'Wunddoku-Wecker',setAlarm:'Wecker stellen',alarmTime:'Wecker-Zeit',alarmDays:'Wecker-Tage',documentChecklist:'Dokumente-Checkliste',referral:'Einweisung',transfer:'Überweisung',medicationList:'Medikamentenliste',allergyPass:'Allergiepass (falls vorhanden)',anesthesiaPass:'Anästhesiepass (falls vorhanden)',jewelryNote:'💍 Schmuck zuhause lassen',punctual:'Pünktlich erscheinen',woundHygiene:'Wundhygiene-Empfehlungen',hygieneStep1:'1. Hände gründlich waschen',hygieneStep2:'2. Trockener Pflasterwechsel',hygieneStep3:'3. Wunddoku: Trocken? Nicht rot? Keine frische Blutung?',hygieneStep4:'4. Keine Berührung der Wunde, keine Manipulation, keine Cremes/Salben',hygieneStep5:'5. Pflaster ohne Berührung der Auflage erneuern',hygieneStep6:'6. Erneut Hände waschen',rednessWarning:'Bei Rötung bitte Praxis kontaktieren',showerHints:'Dusch-Hinweise',showerHint1:'Kurz duschen',showerHint2:'Duschpflaster verwenden',showerHint3:'Im Anschluss Pflaster wechseln (keine feuchte Kammer)',notNeededAmbulant:'(Bei ambulanter OP nicht nötig)',task1Title:'📋 Unterlagen sammeln',task1Desc:'Einweisung, Vorbefunde zusammenstellen',task2Title:'💊 Medikamentenliste',task2Desc:'Alle Medikamente und Allergien notieren',task3Title:'🚗 Transport organisieren',task3Desc:'Abholung und Heimweg planen',task4Title:'❓ Fragen notieren',task4Desc:'Fragen für Anästhesist und Operateur',task5Title:'🏠 Haushalt vorbereiten',task5Desc:'Einkaufen, Mahlzeiten vorbereiten',task6Title:'👕 Kleidung bereitlegen',task6Desc:'Bequeme Kleidung für OP-Tag',task7Title:'✅ Letzte Absprachen',task7Desc:'Uhrzeit, Ort, Nüchternheit bestätigen',task8Title:'🛁 Körperhygiene',task8Desc:'Duschen, kein Nagellack/Make-up',task9Title:'⏰ Pünktlich ankommen',task9Desc:'30 Min. vorher da sein (nach Anweisung des OP-Teams)',task10Title:'💍 Schmuck ablegen',task10Desc:'Schmuck, Piercings zu Hause lassen',task11Title:'🛋️ Schonung',task11Desc:'Ruhen und Warnzeichen beachten',task12Title:'💧 Flüssigkeit',task12Desc:'Ausreichend trinken',task13Title:'🏥 Kontrolltermin',task13Desc:'Nachsorge/Verbandswechsel prüfen',task14Title:'✂️ Fadenzug',task14Desc:'Fäden/Klammern entfernen (falls nicht resorbierbar)',sutureGuideTitle:'Anleitung Fadenzug',sutureGuideIntro:'Der Fadenzug erfolgt je nach Nahtart unterschiedlich. Hier eine Übersicht:',sutureEinzelknopf:'Einzelknopfnaht',sutureEinzelknopfDesc:'<strong>So wird\'s gemacht:</strong><br>1. Knoten mit Pinzette anheben<br>2. Faden unter dem Knoten durchschneiden<br>3. Faden vorsichtig herausziehen<br><br><em>Häufigste Nahtart, jede Schlinge einzeln entfernen.</em>',sutureDonati:'Donati-Rückstichnaht',sutureDonatiDesc:'<strong>So wird\'s gemacht:</strong><br>1. Knoten anheben<br>2. Faden dicht am Gewebe durchschneiden<br>3. Am anderen Ende herausziehen<br><br><em>U-förmige Naht, besonders wundrandnah.</em>',sutureIntrakutan:'Intrakutannaht (fortlaufend)',sutureIntrakutanDesc:'<strong>So wird\'s gemacht:</strong><br>1. Knoten/Ende anheben<br>2. Faden am Knotenende kappen<br>3. Langsam herausziehen (wie Reißverschluss)<br><br><em>Kosmetisch beste Naht, ein langer Faden unter der Haut.</em>',sutureKlammer:'Klammernaht',sutureKlammerDesc:'<strong>So wird\'s gemacht:</strong><br>1. Klammerentferner unter Klammer setzen<br>2. Zusammendrücken – Klammer öffnet sich<br>3. Klammer nach oben abheben<br><br><em>Metallklammern, schnell gesetzt, schnell entfernt.</em>',sutureResorbierbar:'Warum Fadenzug auch bei resorbierbarem Material?',sutureResorbierbDesc:'Auch wenn der Faden sich auflöst, kann ein Fadenzug sinnvoll sein:<ul style="margin-top:8px;padding-left:16px;"><li>Beschleunigt die Heilung bei bereits geschlossener Wunde</li><li>Verhindert Fremdkörperreaktionen (Rötung, Juckreiz)</li><li>Reduziert Narbenbildung</li><li>Kürzt die Entzündungsphase ab</li></ul><p style="margin-top:8px;"><em>Ihr Arzt entscheidet individuell!</em></p>',acceptBothNotices:'Beide Hinweise akzeptieren',selectOpDate:'OP-Datum wählen',defaultOpType:'Allgemeine OP',noDate:'Kein Datum',todayOpDay:'Heute ist OP-Tag!',dayToOp:'Tag bis OP',yourOpDefault:'Ihre OP',allDone:'Alle erledigt!',progress:'Fortschritt',filterAll:'Alle',filterOpen:'Offen',filterDone:'Erledigt',fasting:'Nüchternheit',beforeOp8h:'8h vor OP',beforeOp2h:'2h vor OP',today:'HEUTE',opDayLabel:'OP-Tag',afterOpLabel:'Nach OP',daysBefore:'vorher',editNote:'Bearbeiten',addNoteBtn:'Notiz',opInfosTitle:'OP-Infos',tabProcedure:'Ablauf',tabPreparation:'Vorbereitung',tabAftercare:'Nach OP',tabFaq:'Fragen',procedureTitle:'Ablauf',preparationTitle:'Vorbereitung',aftercareTitle:'Nachsorge',faqTitle:'Häufige Fragen',important:'Wichtig',followInstructions:'Folgen Sie den Anweisungen Ihres Behandlungsteams.',warningSignsTitle:'Warnzeichen',emergencyTitle:'Notfall?',lifeThreatening:'Bei lebensbedrohlichen Symptomen!',call112:'112 anrufen',contactClinicFor:'Bei diesen Zeichen Klinik kontaktieren:',callClinicBtn:'anrufen',saveClinicPhoneTip:'Kliniktelefon in Einstellungen speichern.',questionsTitle:'Fragen',noteQuestionsText:'Notieren Sie Ihre Fragen für die Arztgespräche.',anesthesiologist:'Anästhesist',anesthesiaQs:'Fragen zur Narkose, Betäubung & Risiken',conversationOpDay:'Gespräch: Am OP-Tag oder 1 Tag vorher',noQuestionsYet:'Noch keine Fragen notiert.',addQuestionBtn:'Frage hinzufügen',surgeonTitle:'Operateur / Chirurg',surgeryQs:'Fragen zur OP, Ablauf & Nachsorge',consultationBefore:'Aufklärungsgespräch: Tage/Wochen vor OP',followUpAfter:'Nachgespräch: Nach der OP',questionTip:'Tipp: Notieren Sie Ihre Fragen im Voraus, damit Sie im Gespräch nichts vergessen!',woundHealingTitle:'Wundheilung',takePhoto:'Foto aufnehmen',opConsents:'OP-Aufklärungen',photographDoc:'Dokument fotografieren',otherPhotos:'Sonstiges',morePhotos:'Weitere Fotos',documentsTitle:'Dokumente',uploadDocsText:'Laden Sie wichtige Dokumente hoch (PDFs, Arztbriefe, etc.)',uploadDoc:'Dokument hochladen',pdfWordImages:'PDF, Word, Bilder',noDocsYet:'Noch keine Dokumente hochgeladen.',voiceTitle:'Sprache',httpsRequired:'HTTPS erforderlich',httpsExplain:'Die Sprache-zu-Text-Funktion benötigt eine sichere Verbindung (HTTPS).',speechToText:'Sprache zu Text',speechExplain:'Arzt-Gespräche direkt in Text umwandeln.',stopAndSave:'Aufnahme stoppen & speichern',startRecording:'Aufnahme starten',recordingActive:'Aufnahme läuft',speakNow:'Sprechen Sie jetzt',speakSlowly:'Tipp: Sprechen Sie langsam und deutlich.',savedTexts:'Gespeicherte Texte',voiceMemosTitle:'Sprachmemos',memoExplain:'Audiomemos aufnehmen und abspielen.',tapToRecord:'Tippen zum Aufnehmen',recordingInProgress:'Aufnahme läuft...',savedMemos:'Gespeicherte Memos',painTitle:'Schmerz',currentPain:'Aktuelle Schmerzen',painScale:'0 = keine, 10 = unerträglich',noPain:'Kein',saveBtn:'Speichern',courseTitle:'Verlauf',lastEntries:'Letzte Einträge',vitalsTitle:'Vitalwerte',newMeasurement:'Neue Messung',systolicLabel:'Systolisch',diastolicLabel:'Diastolisch',pulseBpmLabel:'Puls (bpm)',measurementsTitle:'Messungen',medRecordsTitle:'Medikamenten-Doku',documentIntake:'Einnahme dokumentieren',medicationLabel:'Medikament',doseOptional:'Dosis (optional)',documentBtn:'Dokumentieren',intakesPerDay:'Einnahmen/Tag',lastTitle:'Letzte',appointmentsTitle:'Termine',addAppointmentBtn:'Termin hinzufügen',upcomingTitle:'Kommende',noAppointmentsText:'Keine Termine. Nachkontrollen hinzufügen!',pastTitle:'Vergangene',medPlanTitle:'Medikamentenplan',addMedicationBtn:'Medikament hinzufügen',noMedicationsText:'Keine Medikamente. Plan erstellen!',tapTimeToggle:'Tippen Sie auf eine Uhrzeit um die Erinnerung ein/auszuschalten.',whatToBring:'Was Sie für die OP mitnehmen sollten:',ambulantOpNote:'Ambulante OP',addOwnEntry:'Eigenen Eintrag hinzufügen',printList:'Liste drucken',aiAssistantTitle:'KI-Assistent',medAssistant:'Medizin-Assistent',opPrepQuestions:'Fragen zur OP-Vorbereitung',yourQuestion:'Ihre Frage...',aiDisclaimer:'Dieser Assistent gibt nur allgemeine Informationen. Bei medizinischen Fragen wenden Sie sich an Ihr Behandlungsteam.',woundDiaryDesc:'Chronologische Übersicht Ihrer Wundheilung mit Fotos und Notizen.',addPhotoBtn:'Foto hinzufügen',noWoundPhotos:'Noch keine Wundfotos',documentWoundHealing:'Dokumentieren Sie Ihre Wundheilung mit Fotos.',takePhotosBtn:'Fotos aufnehmen',doctorModeTitle:'Arztmodus',compactOverview:'Kompakte Übersicht für das Arztgespräch.',opInfoLabel:'OP-Information',typeLabel:'Art',dateLabel:'Datum',daysPostOpLabel:'Tage post-OP',noticesLabel:'Hinweise',painCourseLabel:'Schmerzverlauf',average7Days:'Durchschnitt (7 Tage)',trendLabel:'Tendenz',lastVitalsLabel:'Letzte Vitalwerte',bloodPressure:'Blutdruck',pulseLabel:'Puls',noMeasurementsText:'Keine Messungen',currentMedicationLabel:'Aktuelle Medikation',noMedicationsLabel:'Keine Medikamente',woundDocLabel:'Wunddokumentation',photosDocumented:'Fotos dokumentiert',openWoundDiaryBtn:'Wundtagebuch öffnen',exportReportBtn:'Bericht exportieren',exportTitle:'Export',exportExplain:'Exportieren Sie Ihre Daten für Arzt, Physiotherapeut oder eigene Unterlagen.',pdfPrint:'PDF / Drucken',pdfPrintDesc:'Übersicht aller Daten als druckbare Version',saveHtml:'HTML-Datei speichern',saveHtmlDesc:'Vollständiger Bericht zum Speichern',exportContent:'Inhalt des Exports:',opInfoDate:'OP-Information & Datum',painCourseChart:'Schmerzverlauf',vitalsValues:'Vitalwerte',medicationList2:'Medikamentenliste',appointmentsList:'Termine',woundPhotoNote:'Hinweise auf Wundfotos',opDataSection:'OP-Daten',clinicContactsSection:'Klinik & Kontakte',clinicNameLabel:'Klinikname',clinicPhoneLabel:'Klinik-Telefon',surgeonNameLabel:'Operateur',lessEyeStrain:'Weniger Augenbelastung',betterReadability:'Bessere Lesbarkeit',forTasksMeds:'Für Aufgaben & Medikamente',exportDataBtn:'Daten exportieren',deleteAllDataBtn:'Alle Daten löschen',legalInfoText:'Rechtliche Informationen',dataStoredLocally:'Alle Daten bleiben lokal auf diesem Gerät gespeichert.',notSet:'Nicht gesetzt',unknownText:'Unbekannt',changeBtn:'Ändern',savedToast:'Gespeichert',featureNotAvailable:'Diese Funktion ist noch nicht verfügbar.',impressumTitle:'Impressum & Datenschutz',aboutAppTitle:'Über diese App',aboutAppDesc:'Der Operationsbegleiter ist eine kostenlose App zur persönlichen Dokumentation rund um Ihre Operation.',medicalNoteTitle:'Medizinischer Hinweis',medicalNoteContent:'Diese App bietet keine medizinische Beratung, Diagnose oder Behandlung.',privacyTitleLong:'Datenschutz',privacyContentLong:'Alle Ihre Daten werden ausschließlich lokal auf Ihrem Gerät gespeichert.',contactTitleLong:'Kontakt',contactContentLong:'Bei Fragen oder Anregungen zur App können Sie uns kontaktieren.',versionInfo:'Version 1.0 - Stand Februar 2026',or:'oder',transcript:'Transkript',acceptTerms:'Durch Anklicken der Checkboxen stimmen Sie den Bedingungen zu:',ambulantExplain:'Sie gehen am selben Tag nach Hause.',stationaryExplain:'Sie bleiben mindestens eine Nacht in der Klinik.',iDontKnow:'Ich weiß es nicht',nameAndPhone:'Name und Telefon',letsGoSubtitle:'Los geht\'s!'}};
function t(key){return T.de[key]||key;}function getLocale(){return 'de-DE';}
const DEFAULT_STATE={currentScreen:'onboarding',previousScreen:null,onboardingStep:0,language:'de',profile:{opDate:'',opType:'',opMode:'stationary',hospitalName:'',hospitalPhone:'',emergencyContact:'',surgeon:'',disclaimerAccepted:false,privacyAccepted:false,departureTime:'',travelDuration:'',transportAlt:''},tasks:[],documents:[],customDocuments:[],uploadedDocs:[],theme:'light',setupComplete:false,menuOpen:false,photos:[],voiceMemos:[],transcripts:[],painRecords:[],medicationRecords:[],vitalsRecords:[],appointments:[],medications:[],questions:{anaesthesist:[],operateur:[]},chatMessages:[],woundNotes:[],largeFont:false,notifications:true,fastingAlarms:[],woundAlarms:[],documentChecklist:{referral:false,transfer:false,medicationList:false,allergyPass:false,anesthesiaPass:false}};
function getDefaultDocs(){return [{id:'d1',label:'Personalausweis',icon:'🪪'},{id:'d2',label:'Versicherungskarte',icon:'💳'},{id:'d3',label:'Einweisungsschein',icon:'📄'},{id:'d4',label:'Medikamentenliste',icon:'💊'},{id:'d5',label:'Vorbefunde/Röntgen',icon:'🩻'},{id:'d6',label:'Allergiepass',icon:'⚠️'},{id:'d7',label:'Bequeme Kleidung',icon:'👕'},{id:'d8',label:'Hausschuhe',icon:'🥿'},{id:'d9',label:'Handy & Ladegerät',icon:'📱'},{id:'d10',label:'Brille/Kontaktlinsen',icon:'👓'}];}
function getTimeline(){return[{day:-14,tasks:[{id:'t1',title:t('task1Title'),desc:t('task1Desc')},{id:'t2',title:t('task2Title'),desc:t('task2Desc')}]},{day:-7,tasks:[{id:'t3',title:t('task3Title'),desc:t('task3Desc')},{id:'t4',title:t('task4Title'),desc:t('task4Desc')}]},{day:-3,tasks:[{id:'t5',title:t('task5Title'),desc:t('task5Desc')},{id:'t6',title:t('task6Title'),desc:t('task6Desc')}]},{day:-1,tasks:[{id:'t7',title:t('task7Title'),desc:t('task7Desc')},{id:'t8',title:t('task8Title'),desc:t('task8Desc')}]},{day:0,tasks:[{id:'t9',title:t('task9Title'),desc:t('task9Desc')},{id:'t10',title:t('task10Title'),desc:t('task10Desc')}]},{day:1,tasks:[{id:'t11',title:t('task11Title'),desc:t('task11Desc')},{id:'t12',title:t('task12Title'),desc:t('task12Desc')}]},{day:7,tasks:[{id:'t13',title:t('task13Title'),desc:t('task13Desc')}]},{day:12,tasks:[{id:'t14',title:t('task14Title'),desc:t('task14Desc')}]}];}
function getWarnings(){return [{title:'Starke Blutung',desc:'Blut durchnässt Verband schnell',icon:'⚠️'},{title:'Hohes Fieber',desc:'Temperatur über 38,5°C',icon:'⚠️'},{title:'Atemnot',desc:'Schwierigkeiten beim Atmen',icon:'⚠️'},{title:'Starke Schmerzen',desc:'Trotz Medikamenten nicht besser',icon:'⚠️'},{title:'Rötung/Schwellung',desc:'Zunehmend um die Wunde',icon:'⚠️'},{title:'Brustschmerzen',desc:'Druck in der Brust',icon:'⚠️'},{title:'Verwirrtheit',desc:'Plötzliche Orientierungslosigkeit',icon:'⚠️'},{title:'Übelkeit/Erbrechen',desc:'Anhaltendes Erbrechen',icon:'⚠️'}];}
function getOpInfo(){return {ablauf:['Sie kommen nüchtern in die Klinik','Aufnahme durch das Pflegeteam','Gespräch mit dem Anästhesisten','Die OP wird durchgeführt','Aufwachraum zur Überwachung','Verlegung oder Entlassung'],vorbereitung:['Nüchtern erscheinen (nach Anweisung)','Medikamente nur nach Absprache','Kein Alkohol 24h vor OP','Nicht rauchen (mind. 24h)','Alle Unterlagen mitbringen','Begleitperson organisieren'],nachsorge:['Wundpflege nach Anweisung','Schmerzmittel wie verordnet','Körperliche Schonung','Kontrolltermine einhalten','Bei Warnzeichen melden','Krankschreibung einreichen'],fragen:[{q:'Wann darf ich duschen?',a:'Nach 24-48h mit wasserfestem Pflaster.'},{q:'Wann darf ich Auto fahren?',a:'Frühestens 24h nach Narkose, ohne Schmerzmittel.'},{q:'Wann kann ich arbeiten?',a:'Abhängig von OP und Beruf – mit Arzt besprechen.'},{q:'Wie lange muss ich nüchtern sein?',a:'Mindestens 6-8 Stunden vor der OP nichts essen, 2 Stunden nichts trinken (klare Flüssigkeiten).'},{q:'Welche Medikamente muss ich vorher absetzen?',a:'Blutverdünner wie Aspirin/Marcumar oft 5-7 Tage vorher – immer mit Arzt absprechen.'},{q:'Was passiert wenn mir nach der Narkose übel ist?',a:'Übelkeit nach Narkose ist häufig. Medikamente dagegen sind verfügbar. Langsam trinken beginnen.'},{q:'Wie lange dauert die Aufwachphase?',a:'30-60 Minuten im Aufwachraum, vollständige Erholung kann mehrere Stunden dauern.'},{q:'Wann werden die Fäden gezogen?',a:'Je nach OP und Nahtmaterial nach 7-14 Tagen, oft beim Hausarzt.'},{q:'Darf ich nach der OP Sport machen?',a:'Leichte Aktivität meist nach 1-2 Wochen, Sport je nach OP erst nach 4-12 Wochen.'},{q:'Was soll ich bei Fieber tun?',a:'Bei Fieber über 38.5°C nach OP sofort Klinik kontaktieren – kann auf Infektion hinweisen.'},{q:'Wie lange werde ich Schmerzen haben?',a:'Akute Schmerzen 3-7 Tage, danach abklingend. Schmerzmittel nach Anweisung nehmen.'},{q:'Kann ich nach der OP normal essen?',a:'Erst klare Flüssigkeiten, dann leichte Kost. Bei Bauch-OPs spezielle Ernährung beachten.'}]};}
const AI_RESPONSES={greeting:'Hallo! Ich bin Ihr medizinischer Assistent. Ich kann Ihnen allgemeine Informationen zu Ihrer OP-Vorbereitung geben. Wie kann ich helfen?',narkose:'Bei einer Narkose werden Sie in einen schlafähnlichen Zustand versetzt. Der Anästhesist überwacht dabei Ihre Vitalfunktionen. Wichtig: Halten Sie sich an die Nüchternheitsregeln!',schmerzen:'Nach einer OP sind leichte bis mittlere Schmerzen normal. Nehmen Sie die verordneten Schmerzmittel regelmäßig ein. Bei starken, zunehmenden Schmerzen kontaktieren Sie Ihre Klinik.',wunde:'Halten Sie die Wunde sauber und trocken. Verbandswechsel nur nach Anweisung. Bei Rötung, Schwellung oder Eiter sofort zum Arzt!',essen:'Vor der OP: 6-8 Stunden nichts essen, 2 Stunden nichts trinken. Nach der OP: Beginnen Sie mit leichter Kost, wenn Sie sich bereit fühlen.',medikamente:'Besprechen Sie alle Medikamente mit Ihrem Anästhesisten. Blutverdünner müssen oft pausiert werden. Nehmen Sie Dauermedikation nur nach Absprache.',angst:'Angst vor einer OP ist völlig normal. Sprechen Sie mit Ihrem Behandlungsteam darüber. Entspannungstechniken und gute Vorbereitung können helfen.',default:'Das ist eine gute Frage! Für spezifische medizinische Beratung wenden Sie sich bitte an Ihr Behandlungsteam. Ich kann Ihnen allgemeine Informationen zur OP-Vorbereitung geben.'};
let state=loadState();
let mediaRecorder=null,audioChunks=[],recordingTimer=null,recordingSeconds=0,recognition=null;
function escapeHtml(str){if(!str)return'';return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');}
function loadState(){try{const s=localStorage.getItem(APP_KEY);if(s)return{...DEFAULT_STATE,...JSON.parse(s)};}catch(e){}return{...DEFAULT_STATE};}
function saveState(){try{localStorage.setItem(APP_KEY,JSON.stringify(state));}catch(e){showToast('Speicher voll!');}}
function setState(u){state={...state,...u};saveState();render();}
function id(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5);}
function formatDate(d){if(!d)return'';return new Date(d).toLocaleDateString(getLocale(),{weekday:'long',day:'numeric',month:'long',year:'numeric'});}
function formatShort(d){if(!d)return'';return new Date(d).toLocaleDateString(getLocale(),{day:'2-digit',month:'2-digit',year:'2-digit'});}
function formatDT(d){if(!d)return'';return new Date(d).toLocaleDateString(getLocale(),{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'});}
function formatTime(s){const m=Math.floor(s/60),sec=s%60;return`${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;}
function getDaysUntil(){if(!state.profile.opDate)return null;const t=new Date();t.setHours(0,0,0,0);const o=new Date(state.profile.opDate);o.setHours(0,0,0,0);return Math.ceil((o-t)/(1000*60*60*24));}
function getDateFor(off){if(!state.profile.opDate)return null;const d=new Date(state.profile.opDate);d.setDate(d.getDate()+off);return d;}
function showToast(m){document.querySelector('.toast')?.remove();const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),3000);}
function genTasks(){const tasks=[];getTimeline().forEach(p=>{p.tasks.forEach(t=>{const ex=state.tasks.find(x=>x.id===t.id);tasks.push({...t,day:p.day,completed:ex?ex.completed:false,note:ex?ex.note:''});});});return tasks;}
function nav(s){setState({previousScreen:state.currentScreen,currentScreen:s,menuOpen:false,detailOpen:true,sidebarOpen:false});}
function goBack(){setState({currentScreen:state.previousScreen||'dashboard',previousScreen:'dashboard'});}
function toggleMenu(){setState({menuOpen:!state.menuOpen});}
function applyTheme(t){
    document.documentElement.setAttribute('data-theme',t);
    document.body.style.backgroundColor=t==='dark'?'#0f0d1a':'#f0f4ff';
    document.body.style.color=t==='dark'?'#f1f5f9':'#1e1b4b';
}
function toggleTheme(){
    const t=state.theme==='light'?'dark':'light';
    applyTheme(t);
    setState({theme:t});
}
function toggleTask(tid){const tasks=state.tasks.map(t=>t.id===tid?{...t,completed:!t.completed}:t);setState({tasks});showToast('Aktualisiert ✓');}
function updateNote(tid,n){const tasks=state.tasks.map(t=>t.id===tid?{...t,note:n}:t);setState({tasks});}
function toggleDoc(did){const docs=state.documents.includes(did)?state.documents.filter(d=>d!==did):[...state.documents,did];setState({documents:docs});}
function addCustomDoc(label){if(!label.trim())return;setState({customDocuments:[...state.customDocuments,{id:id(),label:label.trim(),icon:'📦'}]});showToast('Hinzugefügt ✓');}
function delCustomDoc(did){setState({customDocuments:state.customDocuments.filter(d=>d.id!==did),documents:state.documents.filter(d=>d!==did)});}
function addAppt(data){setState({appointments:[...state.appointments,{id:id(),...data}]});showToast('Termin gespeichert ✓');}
function delAppt(aid){setState({appointments:state.appointments.filter(a=>a.id!==aid)});showToast('Gelöscht');}
function addMed(data){setState({medications:[...state.medications,{id:id(),...data,asNeeded:data.asNeeded||false,alarms:(data.times||[]).map(t=>({time:t,enabled:true}))}]});showToast('Medikament gespeichert ✓');}
function delMed(mid){setState({medications:state.medications.filter(m=>m.id!==mid)});showToast('Gelöscht');}
function toggleAlarm(mid,i){const meds=state.medications.map(m=>{if(m.id===mid){const a=[...m.alarms];a[i]={...a[i],enabled:!a[i].enabled};return{...m,alarms:a};}return m;});setState({medications:meds});}
async function handlePhoto(e,cat){const files=e.target.files;if(!files.length)return;for(const f of Array.from(files)){if(!f.type.startsWith('image/')){showToast('Nur Bilder');continue;}try{const dataUrl=await new Promise((resolve,reject)=>{const r=new FileReader();r.onload=ev=>resolve(ev.target.result);r.onerror=reject;r.readAsDataURL(f);});const img=await new Promise((resolve,reject)=>{const img=new Image();img.onload=()=>resolve(img);img.onerror=reject;img.src=dataUrl;});const c=document.createElement('canvas');const max=800;let w=img.width,h=img.height;if(w>h&&w>max){h=(h*max)/w;w=max;}else if(h>max){w=(w*max)/h;h=max;}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);const blob=await new Promise(resolve=>c.toBlob(resolve,'image/jpeg',0.7));const mediaId=await putMedia({blob,mime:'image/jpeg',meta:{category:cat}});setState({photos:[...state.photos,{id:id(),mediaId:mediaId,category:cat,date:new Date().toISOString(),note:'',mime:'image/jpeg',size:blob.size}]});showToast('Foto gespeichert 📷');}catch(err){console.error('Photo error:',err);if(err.name==='QuotaExceededError'){showStorageFullModal();}else{showToast('Fehler: '+err.message);}}}e.target.value='';}
async function delPhoto(pid){const p=state.photos.find(x=>x.id===pid);if(p&&p.mediaId){await deleteMedia(p.mediaId);}setState({photos:state.photos.filter(p=>p.id!==pid)});showToast('Gelöscht');}
async function viewPhoto(pid){const p=state.photos.find(x=>x.id===pid);if(!p)return;let imgSrc='';if(p.mediaId){const media=await getMedia(p.mediaId);if(media){imgSrc=getCachedUrl(p.mediaId,media.blob);}else{imgSrc='';}}else if(p.data){imgSrc=p.data;}const v=document.createElement('div');v.className='photo-viewer';v.innerHTML=`<div class="photo-viewer-header"><span>${formatDT(p.date)}</span><button class="photo-viewer-close" onclick="closePhotoViewer(this,'${p.mediaId||''}')">✕</button></div><div class="photo-viewer-content">${imgSrc?`<img src="${imgSrc}">`:'<div style="padding:40px;text-align:center;color:var(--muted);">Bild nicht verfügbar</div>'}</div>`;document.body.appendChild(v);}
function closePhotoViewer(btn,mediaId){btn.closest('.photo-viewer').remove();if(mediaId)revokeFromCache(mediaId);}
async function handleDocUpload(e){const files=e.target.files;if(!files.length)return;for(const f of Array.from(files)){try{const blob=f;const mediaId=await putMedia({blob,mime:f.type,meta:{name:f.name}});const doc={id:id(),mediaId:mediaId,name:f.name,size:f.size,type:f.type,date:new Date().toISOString()};setState({uploadedDocs:[...state.uploadedDocs,doc]});showToast('Dokument hochgeladen 📄');}catch(err){console.error('Doc upload error:',err);if(err.name==='QuotaExceededError'){showStorageFullModal();}else{showToast('Fehler: '+err.message);}}}e.target.value='';}
async function delUploadedDoc(did){const d=state.uploadedDocs.find(x=>x.id===did);if(d&&d.mediaId){await deleteMedia(d.mediaId);}setState({uploadedDocs:state.uploadedDocs.filter(d=>d.id!==did)});showToast('Gelöscht');}
function formatFileSize(bytes){if(bytes<1024)return bytes+' B';if(bytes<1024*1024)return(bytes/1024).toFixed(1)+' KB';return(bytes/(1024*1024)).toFixed(1)+' MB';}
async function startRec(){try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});const mimeType=MediaRecorder.isTypeSupported('audio/webm')?'audio/webm':MediaRecorder.isTypeSupported('audio/mp4')?'audio/mp4':'audio/ogg';mediaRecorder=new MediaRecorder(stream,{mimeType});audioChunks=[];mediaRecorder.ondataavailable=e=>{if(e.data.size>0)audioChunks.push(e.data);};mediaRecorder.onstop=async()=>{if(audioChunks.length===0){showToast('Keine Audiodaten');stream.getTracks().forEach(t=>t.stop());return;}const blob=new Blob(audioChunks,{type:mimeType});try{const mediaId=await putMedia({blob,mime:mimeType,meta:{duration:recordingSeconds}});const memoName=`Memo ${state.voiceMemos.length+1}`;setState({voiceMemos:[...state.voiceMemos,{id:id(),mediaId:mediaId,date:new Date().toISOString(),duration:recordingSeconds,title:memoName,mime:mimeType,size:blob.size}]});showToast('Sprachmemo gespeichert 🎤');}catch(err){console.error('Memo save error:',err);if(err.name==='QuotaExceededError'){showStorageFullModal();}else{showToast('Fehler beim Speichern');}}stream.getTracks().forEach(t=>t.stop());};mediaRecorder.start(100);recordingSeconds=0;recordingTimer=setInterval(()=>{recordingSeconds++;const el=document.getElementById('recTimer');if(el)el.textContent=formatTime(recordingSeconds);},1000);render();}catch(e){console.error('Mic error:',e);showToast('Mikrofon nicht verfügbar: '+e.message);}}
function stopRec(){if(mediaRecorder&&mediaRecorder.state==='recording'){mediaRecorder.stop();clearInterval(recordingTimer);mediaRecorder=null;render();}}
async function playMemo(mid){const m=state.voiceMemos.find(x=>x.id===mid);if(!m){showToast('Memo nicht gefunden');return;}try{let audioSrc='';if(m.mediaId){const media=await getMedia(m.mediaId);if(media){audioSrc=getCachedUrl(m.mediaId,media.blob);}else{showToast('Audio nicht verfügbar');return;}}else if(m.data){audioSrc=m.data;}else{showToast('Audio nicht verfügbar');return;}const audio=new Audio(audioSrc);audio.play().then(()=>showToast('▶️ Wiedergabe gestartet')).catch(e=>{console.error('Play error:',e);showToast('Wiedergabe nicht möglich');});}catch(e){console.error('Audio error:',e);showToast('Audio nicht verfügbar');}}
async function delMemo(mid){const m=state.voiceMemos.find(x=>x.id===mid);if(m&&m.mediaId){await deleteMedia(m.mediaId);}setState({voiceMemos:state.voiceMemos.filter(m=>m.id!==mid)});showToast('Gelöscht');}
async function startSpeech(){
    // Check for HTTPS requirement on mobile
    if(location.protocol!=='https:'&&location.hostname!=='localhost'&&location.hostname!=='127.0.0.1'){
        return showToast('Sprache zu Text benötigt HTTPS');
    }
    // Check browser support
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    if(!SR){
        return showToast('Sprache zu Text nicht verfügbar in diesem Browser. Bitte Chrome oder Safari verwenden.');
    }
    // Request microphone permission first
    try{
        await navigator.mediaDevices.getUserMedia({audio:true});
    }catch(e){
        console.error('Mic permission error:',e);
        return showToast('Mikrofon-Zugriff verweigert. Bitte in den Browser-Einstellungen erlauben.');
    }
    try{
        recognition=new SR();
        recognition.continuous=true;
        recognition.interimResults=true;
        recognition.lang='de-DE';
        recognition.maxAlternatives=1;
        window.speechFinalText='';
        window.speechInterimText='';
        recognition.onstart=()=>{
            console.log('Speech recognition started');
            const el=document.getElementById('liveText');
            if(el)el.textContent='🎤 Aufnahme aktiv - Sprechen Sie jetzt...';
        };
        recognition.onresult=e=>{
            window.speechInterimText='';
            for(let i=e.resultIndex;i<e.results.length;i++){
                if(e.results[i].isFinal){
                    window.speechFinalText+=e.results[i][0].transcript+' ';
                }else{
                    window.speechInterimText+=e.results[i][0].transcript;
                }
            }
            const el=document.getElementById('liveText');
            if(el){
                const finalHtml=window.speechFinalText?`<span style="color:var(--text)">${escapeHtml(window.speechFinalText)}</span>`:'';
                const interimHtml=window.speechInterimText?`<span style="color:var(--muted);font-style:italic">${escapeHtml(window.speechInterimText)}</span>`:'';
                const combinedHtml=finalHtml+interimHtml;
                el.innerHTML=combinedHtml||'🎤 Sprechen Sie jetzt...';
            }
        };
        recognition.onend=()=>{
            console.log('Speech recognition ended');
            const finalText=window.speechFinalText.trim();
            if(finalText){
                showSaveTranscriptModal(finalText);
            }else{
                showToast('Kein Text erkannt. Bitte näher ans Mikrofon sprechen.');
            }
            recognition=null;
            render();
        };
        recognition.onerror=e=>{
            console.error('Speech error:',e.error,e.message);
            let msg='Fehler bei Spracherkennung';
            if(e.error==='not-allowed')msg='Mikrofon-Zugriff verweigert. Bitte in den Browser-Einstellungen erlauben.';
            else if(e.error==='no-speech')msg='Keine Sprache erkannt. Bitte lauter und deutlicher sprechen.';
            else if(e.error==='network')msg='Netzwerkfehler. Bitte Internetverbindung prüfen.';
            else if(e.error==='aborted')msg='Aufnahme abgebrochen';
            else if(e.error==='audio-capture')msg='Kein Mikrofon gefunden';
            else if(e.error==='service-not-allowed')msg='Spracherkennung in diesem Browser nicht erlaubt';
            showToast(msg);
            recognition=null;
            render();
        };
        recognition.onaudiostart=()=>console.log('Audio capture started');
        recognition.onsoundstart=()=>console.log('Sound detected');
        recognition.onspeechstart=()=>console.log('Speech started');
        recognition.start();
        render();
        showToast('🎤 Aufnahme gestartet - Sprechen Sie jetzt!');
    }catch(e){
        console.error('Speech init error:',e);
        showToast('Fehler beim Starten der Spracherkennung. Bitte Browser neu starten.');
        recognition=null;
        render();
    }
}
function stopSpeech(){if(recognition){recognition.stop();}}
function showSaveTranscriptModal(text){showModal('📝 Text speichern',`<div class="form-group"><label class="form-label">Name für den Text</label><input type="text" class="form-input" id="transcriptName" placeholder="z.B. Arztgespräch 15.01."></div><div class="form-group"><label class="form-label">Erkannter Text</label><textarea class="form-textarea" id="transcriptText" rows="5">${text}</textarea></div><button class="btn btn-primary btn-block" onclick="saveTranscriptWithName()">${t('saveBtn')}</button>`);}
function saveTranscriptWithName(){const name=document.getElementById('transcriptName')?.value||'Transkript';const text=document.getElementById('transcriptText')?.value;if(!text?.trim())return showToast('Kein Text vorhanden');setState({transcripts:[...state.transcripts,{id:id(),name:name,text:text.trim(),date:new Date().toISOString()}]});closeModal();showToast('Text gespeichert ✓');}
function editTranscript(tid){const t=state.transcripts.find(x=>x.id===tid);if(!t)return;showModal('✏️ Text bearbeiten',`<div class="form-group"><label class="form-label">Name</label><input type="text" class="form-input" id="editTransName" value="${t.name||''}"></div><div class="form-group"><label class="form-label">Text</label><textarea class="form-textarea" id="editTransText" rows="5">${t.text}</textarea></div><button class="btn btn-primary btn-block" onclick="updateTranscript('${tid}')">${t('saveBtn')}</button>`);}
function updateTranscript(tid){const name=document.getElementById('editTransName')?.value;const text=document.getElementById('editTransText')?.value;if(!text?.trim())return showToast('Text darf nicht leer sein');const transcripts=state.transcripts.map(t=>t.id===tid?{...t,name:name||'Transkript',text:text.trim()}:t);setState({transcripts});closeModal();showToast('Aktualisiert ✓');}
function delTranscript(tid){setState({transcripts:state.transcripts.filter(t=>t.id!==tid)});showToast('Gelöscht');}
function renameMemo(mid){const m=state.voiceMemos.find(x=>x.id===mid);if(!m)return;showModal('✏️ Memo umbenennen',`<div class="form-group"><label class="form-label">Neuer Name</label><input type="text" class="form-input" id="memoNewName" value="${m.title||''}"></div><button class="btn btn-primary btn-block" onclick="saveMemoName('${mid}')">${t('saveBtn')}</button>`);}
function saveMemoName(mid){const name=document.getElementById('memoNewName')?.value;if(!name?.trim())return showToast('Name eingeben');const memos=state.voiceMemos.map(m=>m.id===mid?{...m,title:name.trim()}:m);setState({voiceMemos:memos});closeModal();showToast('Umbenannt ✓');}
function getWoundDiaryData(){const wound=state.photos.filter(p=>p.category==='wound').sort((a,b)=>new Date(a.date)-new Date(b.date));if(wound.length===0)return[];const opDate=state.profile.opDate?new Date(state.profile.opDate):null;const grouped={};wound.forEach(p=>{const pDate=new Date(p.date);pDate.setHours(0,0,0,0);let dayKey;if(opDate){const op=new Date(opDate);op.setHours(0,0,0,0);const diffDays=Math.round((pDate-op)/(1000*60*60*24));dayKey=diffDays>=0?`Tag ${diffDays}`:`Tag ${diffDays}`;if(diffDays===0)dayKey='OP-Tag';else if(diffDays>0)dayKey=`Tag ${diffDays} nach OP`;else dayKey=`${Math.abs(diffDays)} Tag(e) vor OP`;}else{dayKey=pDate.toLocaleDateString(getLocale(),{day:'numeric',month:'long',year:'numeric'});}if(!grouped[dayKey])grouped[dayKey]={date:pDate,photos:[],notes:[]};grouped[dayKey].photos.push(p);});const tasks=state.tasks.filter(t=>t.note);tasks.forEach(t=>{const tDate=getDateFor(t.day);if(!tDate)return;const tDateNorm=new Date(tDate);tDateNorm.setHours(0,0,0,0);let dayKey;if(opDate){const op=new Date(opDate);op.setHours(0,0,0,0);const diffDays=Math.round((tDateNorm-op)/(1000*60*60*24));if(diffDays===0)dayKey='OP-Tag';else if(diffDays>0)dayKey=`Tag ${diffDays} nach OP`;else dayKey=`${Math.abs(diffDays)} Tag(e) vor OP`;}else{dayKey=tDateNorm.toLocaleDateString(getLocale(),{day:'numeric',month:'long',year:'numeric'});}if(grouped[dayKey])grouped[dayKey].notes.push({title:t.title,note:t.note});});return Object.entries(grouped).map(([k,v])=>({label:k,date:v.date,photos:v.photos,notes:v.notes})).sort((a,b)=>a.date-b.date);}
function addWoundNote(dateStr){showModal('📝 Notiz hinzufügen',`<div class="form-group"><label class="form-label">Notiz für ${dateStr}</label><textarea class="form-textarea" id="woundNoteText" rows="3" placeholder="Beobachtungen zur Wundheilung..."></textarea></div><button class="btn btn-primary btn-block" onclick="saveWoundNote('${dateStr}')">${t('saveBtn')}</button>`);}
function saveWoundNote(dateStr){const note=document.getElementById('woundNoteText')?.value;if(!note?.trim())return showToast('Notiz eingeben');const woundNotes=state.woundNotes||[];setState({woundNotes:[...woundNotes,{id:id(),date:dateStr,note:note.trim(),created:new Date().toISOString()}]});closeModal();showToast('Notiz gespeichert ✓');}
function generateDoctorReport(){const d=getDaysUntil();const recentPain=state.painRecords.slice(-7);const avgPain=recentPain.length?Math.round(recentPain.reduce((a,b)=>a+b.value,0)/recentPain.length*10)/10:'-';const lastVitals=state.vitalsRecords.slice(-1)[0];const warnings=[];if(recentPain.some(p=>p.value>=7))warnings.push('Hohe Schmerzwerte (≥7) in den letzten Tagen');if(lastVitals&&lastVitals.systolic>140)warnings.push('Erhöhter Blutdruck');if(lastVitals&&lastVitals.pulse>100)warnings.push('Erhöhte Herzfrequenz');return{opType:state.profile.opType||'Nicht angegeben',opDate:formatDate(state.profile.opDate),daysPostOp:d!==null&&d<0?Math.abs(d):0,avgPain,painTrend:recentPain.length>=2?(recentPain[recentPain.length-1].value-recentPain[0].value)>0?'steigend':'fallend':'nicht beurteilbar',lastVitals,medications:state.medications,recentMedRecords:state.medicationRecords.slice(-10),warnings,woundPhotos:state.photos.filter(p=>p.category==='wound').length};}
async function exportData(format){showToast('Export wird vorbereitet...');const report=generateDoctorReport();const painData=state.painRecords;const vitalsData=state.vitalsRecords;const appointments=state.appointments;const medications=state.medications;const html=generateExportHTML(report,painData,vitalsData,appointments,medications);if(format==='pdf'){const printWin=window.open('','_blank');printWin.document.write(html);printWin.document.close();printWin.focus();setTimeout(()=>printWin.print(),500);}else{const blob=new Blob([html],{type:'text/html'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`Operationsbegleiter_Export_${new Date().toISOString().split('T')[0]}.html`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);showToast('Export heruntergeladen ✓');}}
function generateExportHTML(report,painData,vitalsData,appointments,medications){return`<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Operationsbegleiter - Patientenübersicht</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:0 auto;padding:20px;color:#333}h1{color:#6366f1;border-bottom:2px solid #6366f1;padding-bottom:10px}h2{color:#1e1b4b;margin-top:24px;border-left:4px solid #6366f1;padding-left:10px}.section{background:#f8f9fa;border-radius:8px;padding:16px;margin-bottom:16px}.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}.label{font-weight:bold;color:#64748b;font-size:12px}.value{font-size:16px;margin-top:4px}table{width:100%;border-collapse:collapse;margin-top:10px}th,td{border:1px solid #ddd;padding:8px;text-align:left}th{background-color:#6366f1;color:white}.warning{background-color:#fef3c7;border-left:4px solid #f59e0b;padding:10px;margin:10px 0}.footer{margin-top:30px;padding-top:10px;border-top:1px solid #ddd;font-size:12px;color:#64748b}</style></head><body><h1>🏥 Patientenübersicht</h1><p>Erstellt am: ${escapeHtml(new Date().toLocaleString('de-DE'))}</p><div class="section"><h2>📋 OP-Information</h2><div class="grid"><div><div class="label">OP-Art</div><div class="value">${escapeHtml(report.opType)}</div></div><div><div class="label">OP-Datum</div><div class="value">${escapeHtml(report.opDate)}</div></div><div><div class="label">Tage nach OP</div><div class="value">${escapeHtml(String(report.daysPostOp))}</div></div><div><div class="label">Wundfotos</div><div class="value">${escapeHtml(String(report.woundPhotos))} ${t('photosDocumented')}</div></div></div></div>${report.warnings.length?`<div class="warning"><strong>⚠️ Hinweise:</strong><ul>${report.warnings.map(w=>`<li>${escapeHtml(w)}</li>`).join('')}</ul></div>`:''}<div class="section"><h2>📊 Schmerzverlauf</h2><div class="grid"><div><div class="label">Durchschnitt (letzte 7 Tage)</div><div class="value">${escapeHtml(String(report.avgPain))}/10</div></div><div><div class="label">Tendenz</div><div class="value">${escapeHtml(report.painTrend)}</div></div></div>${painData.length?`<table><tr><th>Datum</th><th>Schmerzwert</th></tr>${painData.slice(-10).map(p=>`<tr><td>${escapeHtml(formatDT(p.date))}</td><td>${escapeHtml(String(p.value))}/10</td></tr>`).join('')}</table>`:''}</div><div class="section"><h2>❤️ Vitalwerte</h2>${report.lastVitals?`<div class="grid"><div><div class="label">Letzter Blutdruck</div><div class="value">${escapeHtml(String(report.lastVitals.systolic))}/${escapeHtml(String(report.lastVitals.diastolic))} mmHg</div></div><div><div class="label">Letzter Puls</div><div class="value">${escapeHtml(String(report.lastVitals.pulse))} bpm</div></div></div>`:'<p>Keine Messungen vorhanden</p>'}${vitalsData.length>1?`<table><tr><th>Datum</th><th>Sys/Dia</th><th>Puls</th></tr>${vitalsData.slice(-10).map(v=>`<tr><td>${escapeHtml(formatDT(v.date))}</td><td>${escapeHtml(String(v.systolic))}/${escapeHtml(String(v.diastolic))}</td><td>${escapeHtml(String(v.pulse))}</td></tr>`).join('')}</table>`:''}</div><div class="section"><h2>💊 Medikation</h2>${medications.length?`<table><tr><th>Medikament</th><th>Dosierung</th><th>Einnahmezeiten</th></tr>${medications.map(m=>`<tr><td>${escapeHtml(m.name)}</td><td>${escapeHtml(m.dose)}</td><td>${escapeHtml(m.alarms.map(a=>a.time).join(', '))}</td></tr>`).join('')}</table>`:'<p>Keine Medikamente eingetragen</p>'}</div><div class="section"><h2>📅 Termine</h2>${appointments.length?`<table><tr><th>Datum</th><th>Termin</th><th>Ort</th></tr>${appointments.map(a=>`<tr><td>${escapeHtml(formatDT(a.datetime))}</td><td>${escapeHtml(a.title)}</td><td>${escapeHtml(a.location||'-')}</td></tr>`).join('')}</table>`:'<p>Keine Termine eingetragen</p>'}</div><div class="footer"><p>Erstellt mit Operationsbegleiter App</p><p>Diese Übersicht ersetzt keine ärztliche Dokumentation.</p></div></body></html>`;}
function savePain(v){setState({painRecords:[...state.painRecords,{id:id(),date:new Date().toISOString(),value:parseInt(v)}]});showToast('Gespeichert ✓');}
function saveVitals(){const sys=parseInt(document.getElementById('sysIn')?.value),dia=parseInt(document.getElementById('diaIn')?.value),pul=parseInt(document.getElementById('pulIn')?.value);if(!sys||!dia||!pul)return showToast('Alle Werte eingeben');setState({vitalsRecords:[...state.vitalsRecords,{id:id(),date:new Date().toISOString(),systolic:sys,diastolic:dia,pulse:pul}]});showToast('Gespeichert ✓');document.getElementById('sysIn').value='';document.getElementById('diaIn').value='';document.getElementById('pulIn').value='';}
function saveMedRec(){const name=document.getElementById('medRecName')?.value,dose=document.getElementById('medRecDose')?.value;if(!name)return showToast('Medikament eingeben');setState({medicationRecords:[...state.medicationRecords,{id:id(),date:new Date().toISOString(),name,dose:dose||''}]});showToast('Dokumentiert ✓');document.getElementById('medRecName').value='';document.getElementById('medRecDose').value='';}
function addQuestion(type,text){if(!text.trim())return;const questions={...state.questions};questions[type]=[...questions[type],{id:id(),text:text.trim(),date:new Date().toISOString()}];setState({questions});showToast('Frage gespeichert ✓');}
function delQuestion(type,qid){const questions={...state.questions};questions[type]=questions[type].filter(q=>q.id!==qid);setState({questions});}
function sendChatMessage(){const input=document.getElementById('chatInput');const msg=input?.value.trim();if(!msg)return;const newMsgs=[...state.chatMessages,{role:'user',content:msg,date:new Date().toISOString()}];setState({chatMessages:newMsgs});input.value='';setTimeout(()=>{const response=getAIResponse(msg);setState({chatMessages:[...state.chatMessages,{role:'assistant',content:response,date:new Date().toISOString()}]});},800);}
function getAIResponse(msg){const lower=msg.toLowerCase();if(lower.includes('narkose')||lower.includes('betäubung'))return AI_RESPONSES.narkose;if(lower.includes('schmerz'))return AI_RESPONSES.schmerzen;if(lower.includes('wunde')||lower.includes('verband'))return AI_RESPONSES.wunde;if(lower.includes('essen')||lower.includes('trinken')||lower.includes('nüchtern'))return AI_RESPONSES.essen;if(lower.includes('medikament')||lower.includes('tablette'))return AI_RESPONSES.medikamente;if(lower.includes('angst')||lower.includes('sorge')||lower.includes('nervös'))return AI_RESPONSES.angst;if(lower.includes('hallo')||lower.includes('hi')||lower.includes('guten'))return AI_RESPONSES.greeting;return AI_RESPONSES.default;}
function painChart(){const r=state.painRecords.slice(-14);if(r.length<2)return`<div class="chart-no-data"><div class="chart-no-data-icon">📊</div><p>Mind. 2 Einträge</p></div>`;const w=280,h=140,p=30,cw=w-p*2,ch=h-p*2;const pts=r.map((x,i)=>({x:p+(i/(r.length-1))*cw,y:p+ch-(x.value/10)*ch}));const path=pts.map((pt,i)=>`${i===0?'M':'L'} ${pt.x} ${pt.y}`).join(' ');return`<svg class="chart-svg" viewBox="0 0 ${w} ${h}">${[0,5,10].map(v=>`<line x1="${p}" y1="${p+ch-(v/10)*ch}" x2="${w-p}" y2="${p+ch-(v/10)*ch}" stroke="var(--border)" stroke-dasharray="3"/><text x="${p-4}" y="${p+ch-(v/10)*ch+3}" fill="var(--muted)" font-size="9" text-anchor="end">${v}</text>`).join('')}<defs><linearGradient id="pg" x1="0%" y1="0%" x2="100%"><stop offset="0%" stop-color="var(--success)"/><stop offset="50%" stop-color="var(--warning)"/><stop offset="100%" stop-color="var(--danger)"/></linearGradient></defs><path d="${path}" fill="none" stroke="url(#pg)" stroke-width="2.5" stroke-linecap="round"/>${pts.map((pt,i)=>{const v=r[i].value,c=v<=3?'var(--success)':v<=6?'var(--warning)':'var(--danger)';return`<circle cx="${pt.x}" cy="${pt.y}" r="4" fill="${c}" stroke="white" stroke-width="1.5"/>`;}).join('')}</svg>`;}
function vitalsChart(){const r=state.vitalsRecords.slice(-10);if(r.length<2)return`<div class="chart-no-data"><div class="chart-no-data-icon">📊</div><p>Mind. 2 Einträge</p></div>`;const w=280,h=140,p=30,cw=w-p*2,ch=h-p*2,minV=50,maxV=180,range=maxV-minV;const mkPts=k=>r.map((x,i)=>({x:p+(i/(r.length-1))*cw,y:p+ch-((x[k]-minV)/range)*ch}));const sP=mkPts('systolic'),dP=mkPts('diastolic'),pP=mkPts('pulse');const mkPath=pts=>pts.map((pt,i)=>`${i===0?'M':'L'} ${pt.x} ${pt.y}`).join(' ');return`<svg class="chart-svg" viewBox="0 0 ${w} ${h}">${[60,100,140,180].map(v=>`<line x1="${p}" y1="${p+ch-((v-minV)/range)*ch}" x2="${w-p}" y2="${p+ch-((v-minV)/range)*ch}" stroke="var(--border)" stroke-dasharray="3"/>`).join('')}<path d="${mkPath(sP)}" fill="none" stroke="var(--danger)" stroke-width="2"/><path d="${mkPath(dP)}" fill="none" stroke="var(--primary)" stroke-width="2"/><path d="${mkPath(pP)}" fill="none" stroke="var(--success)" stroke-width="2"/>${sP.map(pt=>`<circle cx="${pt.x}" cy="${pt.y}" r="3" fill="var(--danger)"/>`).join('')}${dP.map(pt=>`<circle cx="${pt.x}" cy="${pt.y}" r="3" fill="var(--primary)"/>`).join('')}${pP.map(pt=>`<circle cx="${pt.x}" cy="${pt.y}" r="3" fill="var(--success)"/>`).join('')}</svg><div style="display:flex;justify-content:center;gap:10px;font-size:.7rem;margin-top:6px;"><span style="color:var(--danger)">● Sys</span><span style="color:var(--primary)">● Dia</span><span style="color:var(--success)">● Puls</span></div>`;}
function medChart(){const r=state.medicationRecords.slice(-20);if(!r.length)return`<div class="chart-no-data"><div class="chart-no-data-icon">💊</div><p>Noch keine Einträge</p></div>`;const byDay={};r.forEach(x=>{const d=new Date(x.date).toLocaleDateString('de-DE');byDay[d]=(byDay[d]||0)+1;});const days=Object.keys(byDay).slice(-7);const maxC=Math.max(...days.map(d=>byDay[d]),3);const w=280,h=120,p=25,barW=(w-p*2)/days.length-6;return`<svg class="chart-svg" viewBox="0 0 ${w} ${h}">${days.map((day,i)=>{const x=p+i*((w-p*2)/days.length)+3,ht=(byDay[day]/maxC)*(h-p*2),y=h-p-ht;return`<rect x="${x}" y="${y}" width="${barW}" height="${ht}" fill="var(--primary)" rx="3"/><text x="${x+barW/2}" y="${h-6}" fill="var(--muted)" font-size="7" text-anchor="middle">${day.split('.').slice(0,2).join('.')}</text><text x="${x+barW/2}" y="${y-3}" fill="var(--text)" font-size="9" text-anchor="middle" font-weight="bold">${byDay[day]}</text>`;}).join('')}</svg>`;}
function showModal(title,content){const m=document.createElement('div');m.className='modal-overlay';m.id='modal';m.innerHTML=`<div class="modal"><div class="modal-header"><span class="modal-title">${title}</span><button class="modal-close" onclick="closeModal()">✕</button></div>${content}</div>`;document.body.appendChild(m);}
function showSutureGuide(){const content=`<div style="max-height:70vh;overflow-y:auto;padding:0 4px;"><p style="margin-bottom:16px;color:var(--muted);">${t('sutureGuideIntro')}</p><div class="suture-section" style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;border-left:4px solid var(--primary);"><h4 style="color:var(--text);margin-bottom:8px;">🔵 ${t('sutureEinzelknopf')}</h4><p style="font-size:.9rem;color:var(--text);line-height:1.5;">${t('sutureEinzelknopfDesc')}</p></div><div class="suture-section" style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;border-left:4px solid var(--secondary);"><h4 style="color:var(--text);margin-bottom:8px;">🟣 ${t('sutureDonati')}</h4><p style="font-size:.9rem;color:var(--text);line-height:1.5;">${t('sutureDonatiDesc')}</p></div><div class="suture-section" style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;border-left:4px solid var(--success);"><h4 style="color:var(--text);margin-bottom:8px;">🟢 ${t('sutureIntrakutan')}</h4><p style="font-size:.9rem;color:var(--text);line-height:1.5;">${t('sutureIntrakutanDesc')}</p></div><div class="suture-section" style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;border-left:4px solid var(--warning);"><h4 style="color:var(--text);margin-bottom:8px;">🟡 ${t('sutureKlammer')}</h4><p style="font-size:.9rem;color:var(--text);line-height:1.5;">${t('sutureKlammerDesc')}</p></div><div class="suture-section" style="background:rgba(59,130,246,0.1);border-radius:12px;padding:14px;margin-bottom:12px;border:1px dashed var(--primary);"><h4 style="color:var(--text);margin-bottom:8px;">💡 ${t('sutureResorbierbar')}</h4><div style="font-size:.9rem;color:var(--text);line-height:1.5;">${t('sutureResorbierbDesc')}</div></div></div>`;showModal(`✂️ ${t('sutureGuideTitle')}`,content);}
function closeModal(){document.getElementById('modal')?.remove();}
function noteModal(tid){const t=state.tasks.find(x=>x.id===tid);showModal('📝 Notiz',`<textarea class="form-textarea" id="noteIn" rows="3" placeholder="Ihre Notiz...">${t?.note||''}</textarea><button class="btn btn-primary btn-block" style="margin-top:14px" onclick="saveNote('${tid}')">Speichern</button>`);setTimeout(()=>document.getElementById('noteIn')?.focus(),100);}
function saveNote(tid){updateNote(tid,document.getElementById('noteIn')?.value||'');closeModal();showToast('Gespeichert ✓');}
function addDocModal(){showModal('📦 Hinzufügen',`<div class="form-group"><label class="form-label">Bezeichnung</label><input type="text" class="form-input" id="newDocIn" placeholder="z.B. Kompressionsstrümpfe"></div><button class="btn btn-primary btn-block" onclick="submitDoc()">Hinzufügen</button>`);}
function submitDoc(){addCustomDoc(document.getElementById('newDocIn')?.value);closeModal();}
function apptModal(){showModal('📅 Neuer Termin',`<div class="form-group"><label class="form-label">Titel</label><input type="text" class="form-input" id="apptTitle" placeholder="z.B. Nachkontrolle"></div><div class="form-group"><label class="form-label">Datum & Uhrzeit</label><input type="datetime-local" class="form-input" id="apptDT"></div><div class="form-group"><label class="form-label">Ort (optional)</label><input type="text" class="form-input" id="apptLoc" placeholder="Klinik, Raum..."></div><div class="form-group"><label class="form-label">Notizen (optional)</label><textarea class="form-textarea" id="apptNotes" rows="2"></textarea></div><div class="checkbox-group" onclick="this.querySelector('input').click()"><input type="checkbox" id="apptReminder" checked><div class="custom-checkbox"></div><div class="checkbox-label"><div class="checkbox-title">🔔 Erinnerung</div><div class="checkbox-desc">Push-Benachrichtigung</div></div></div><button class="btn btn-primary btn-block" style="margin-top:14px" onclick="submitAppt()">Speichern</button>`);}
function submitAppt(){const title=document.getElementById('apptTitle')?.value,dt=document.getElementById('apptDT')?.value;if(!title||!dt)return showToast('Titel und Datum eingeben');addAppt({title,datetime:dt,location:document.getElementById('apptLoc')?.value||'',notes:document.getElementById('apptNotes')?.value||'',reminder:document.getElementById('apptReminder')?.checked});closeModal();}
function medModal(){showModal('💊 Medikament',`<div class="form-group"><label class="form-label">${t('medicationLabel')}</label><input type="text" class="form-input" id="medName" placeholder="z.B. Ibuprofen"></div><div class="form-group"><label class="form-label">Dosierung</label><input type="text" class="form-input" id="medDose" placeholder="z.B. 400mg"></div><div class="form-group"><label class="form-label">Einnahmezeiten (Komma getrennt)</label><input type="text" class="form-input" id="medTimes" placeholder="08:00, 14:00, 20:00"></div><div class="form-group"><label class="form-label">Hinweise (optional)</label><textarea class="form-textarea" id="medNotes" rows="2" placeholder="z.B. Nach dem Essen"></textarea></div><button class="btn btn-primary btn-block" style="margin-top:14px" onclick="submitMed()">Speichern</button>`);}
function submitMed(){const name=document.getElementById('medName')?.value,dose=document.getElementById('medDose')?.value,times=document.getElementById('medTimes')?.value;if(!name||!times)return showToast('Name und Zeiten eingeben');addMed({name,dose:dose||'',times:times.split(',').map(t=>t.trim()).filter(t=>t),notes:document.getElementById('medNotes')?.value||''});closeModal();}
function questionModal(type){const titles={anaesthesist:'Frage an Anästhesist',operateur:'Frage an Operateur'};showModal(`❓ ${titles[type]}`,`<div class="form-group"><label class="form-label">Ihre Frage</label><textarea class="form-textarea" id="questionIn" rows="3" placeholder="Was möchten Sie wissen?"></textarea></div><button class="btn btn-primary btn-block" onclick="submitQuestion('${type}')">Speichern</button>`);}
function submitQuestion(type){addQuestion(type,document.getElementById('questionIn')?.value);closeModal();}
function dateModal(){showModal('📅 OP-Datum',`<div class="form-group"><label class="form-label">Neues Datum</label><input type="date" class="form-input" id="newDate" value="${state.profile.opDate}" min="${new Date().toISOString().split('T')[0]}"></div><p style="color:var(--muted);font-size:.85rem;margin-bottom:14px;">Timeline wird neu berechnet.</p><button class="btn btn-primary btn-block" onclick="changeDate()">Aktualisieren</button>`);}
function changeDate(){const d=document.getElementById('newDate')?.value;if(!d)return showToast('Datum wählen');setState({profile:{...state.profile,opDate:d}});closeModal();showToast('Aktualisiert ✓');}
function typeModal(){showModal('🏥 OP-Art',`<div class="form-group"><label class="form-label">Neue OP-Art</label><input type="text" class="form-input" id="newType" value="${state.profile.opType}" placeholder="z.B. Kniearthroskopie"></div><button class="btn btn-primary btn-block" style="margin-top:14px" onclick="changeType()">Aktualisieren</button>`);}
function changeType(){setState({profile:{...state.profile,opType:document.getElementById('newType')?.value||''}});closeModal();showToast('Aktualisiert ✓');}
function showStorageFullModal(){showModal('💾 Speicher voll',`<div style="text-align:center;"><div style="font-size:3rem;margin-bottom:16px;">⚠️</div><p style="color:var(--muted);margin-bottom:16px;line-height:1.5;">Der Speicher ist voll. Bitte löschen Sie einige Medien, um Platz zu schaffen.</p><div style="display:flex;flex-direction:column;gap:10px;"><button class="btn btn-secondary btn-block" onclick="closeModal();nav('photos');">📷 Fotos verwalten</button><button class="btn btn-secondary btn-block" onclick="closeModal();deleteMediaOnly();">🗑️ Alle Medien löschen</button><button class="btn btn-secondary btn-block" onclick="closeModal();exportFullBackup();">📤 Backup erstellen</button><button class="btn btn-secondary btn-block" onclick="closeModal()">Schließen</button></div></div>`);}
function resetModal(){showModal('🗑️ Daten löschen',`<div style="display:flex;flex-direction:column;gap:12px;"><p style="color:var(--muted);line-height:1.5;">Wählen Sie, was gelöscht werden soll:</p><button class="btn btn-danger btn-block" onclick="resetApp()">🗑️ Alles löschen</button><button class="btn btn-secondary btn-block" onclick="deleteMediaOnly()">🖼️ Nur Medien löschen<br><small style="font-weight:normal;opacity:.7;">Fotos, Memos, Dokumente</small></button><button class="btn btn-secondary btn-block" onclick="deleteHistoryOnly()">📊 Nur Verlauf löschen<br><small style="font-weight:normal;opacity:.7;">Schmerz, Vitalwerte, Medikamenten-Einnahmen</small></button><button class="btn btn-secondary btn-block" onclick="closeModal()">Abbrechen</button></div>`);}
async function resetApp(){await clearAllMedia();localStorage.removeItem(APP_KEY);state={...DEFAULT_STATE};closeModal();showToast('Alle Daten gelöscht');render();}
async function deleteMediaOnly(){await clearAllMedia();setState({photos:[],voiceMemos:[],uploadedDocs:[],transcripts:[]});closeModal();showToast('Medien gelöscht');}
function deleteHistoryOnly(){setState({painRecords:[],vitalsRecords:[],medicationRecords:[]});closeModal();showToast('Verlauf gelöscht');}
function nextStep(){const s=state.onboardingStep;if(s===0&&(!state.profile.disclaimerAccepted||!state.profile.privacyAccepted))return showToast(t('acceptBothNotices'));if(s===1){const d=document.getElementById('opDate')?.value,opT=document.getElementById('opType')?.value;if(!d)return showToast(t('selectOpDate'));setState({profile:{...state.profile,opDate:d,opType:opT||t('defaultOpType')}});}if(s===2)setState({profile:{...state.profile,hospitalName:document.getElementById('hospitalName')?.value||'',hospitalPhone:document.getElementById('hospitalPhone')?.value||'',emergencyContact:document.getElementById('emergencyContact')?.value||''}});if(s===3)setState({profile:{...state.profile,departureTime:document.getElementById('departureTime')?.value||'',travelDuration:document.getElementById('travelDuration')?.value||'',transportAlt:document.getElementById('transportAlt')?.value||''}});if(s===4){setState({setupComplete:true,currentScreen:'dashboard',tasks:genTasks(),onboardingStep:0,chatMessages:[{role:'assistant',content:AI_RESPONSES.greeting,date:new Date().toISOString()}]});if('Notification' in window)Notification.requestPermission();return showToast(t('welcome')+' 🎉');}setState({onboardingStep:s+1});}
function prevStep(){if(state.onboardingStep>0)setState({onboardingStep:state.onboardingStep-1});}
function render(){
    applyTheme(state.theme);
    initWorkspace();
    const app=document.getElementById('app');
    if(!state.setupComplete){
        app.innerHTML=renderOnboarding();
    } else {
        app.innerHTML=renderShell();
    }
    attachListeners();
    if(state.currentScreen==='wounddiary')setTimeout(loadWoundDiaryThumbnails,50);
    // Focus command input if open
    if(state.commandOpen){
        const ci=document.querySelector('.command-input');
        if(ci)ci.focus();
    }
}
function renderOLD_REPLACED(){
    applyTheme(state.theme);
    const app=document.getElementById('app');
    if(!state.setupComplete){app.innerHTML=renderOnboarding();}
    else{app.innerHTML=renderHeader()+renderScreen()+(state.menuOpen?renderMenu():'')+'<button class="ai-fab" onclick="nav(\'assistant\')" title="KI-Assistent">🤖</button><button class="menu-fab" onclick="toggleMenu()">☰ '+t('menu')+'</button>';}
    attachListeners();
    if(state.currentScreen==='wounddiary')setTimeout(loadWoundDiaryThumbnails,50);
}
function renderHeader(){const back=state.currentScreen!=='dashboard';return`<header class="header">${back?'<button class="back-btn" onclick="goBack()">←</button>':''}<img src="${LOGO_BASE64}" class="logo-img" alt="Logo"><div class="logo">Operationsbegleiter</div><button class="icon-btn" onclick="toggleTheme()">${state.theme==='light'?'🌙':'☀️'}</button></header>`;}
function renderMenu(){return`<div class="menu-overlay" onclick="toggleMenu()"></div><div class="menu-drawer"><div class="menu-header"><span class="menu-title">📋 Funktionen</span><button class="menu-close" onclick="toggleMenu()">✕</button></div><div class="menu-section"><div class="menu-section-title">Hauptfunktionen</div><div class="menu-item" onclick="nav('dashboard')"><div class="menu-item-icon">🏠</div><div><h4>Startseite</h4><p>Übersicht & Countdown</p></div></div><div class="menu-item" onclick="nav('timeline')"><div class="menu-item-icon">📋</div><div><h4>Timeline</h4><p>Aufgaben vor & nach OP</p></div></div><div class="menu-item" onclick="nav('info')"><div class="menu-item-icon">ℹ️</div><div><h4>OP-Infos</h4><p>Ablauf, Vorbereitung, FAQ</p></div></div><div class="menu-item" onclick="nav('warning')"><div class="menu-item-icon">⚠️</div><div><h4>Warnzeichen</h4><p>Notfall & Symptome</p></div></div></div><div class="menu-section"><div class="menu-section-title">Für Arzt & Physio</div><div class="menu-item" onclick="nav('doctormode')"><div class="menu-item-icon">👨‍⚕️</div><div><h4>Arztmodus</h4><p>Kompakte Übersicht</p></div></div><div class="menu-item" onclick="nav('export')"><div class="menu-item-icon">📤</div><div><h4>Export</h4><p>PDF/Bericht erstellen</p></div></div></div><div class="menu-section"><div class="menu-section-title">Planung</div><div class="menu-item" onclick="nav('appointments')"><div class="menu-item-icon">📅</div><div><h4>Termine</h4><p>Nachkontrollen planen</p></div></div><div class="menu-item" onclick="nav('medications')"><div class="menu-item-icon">⏰</div><div><h4>Medikamentenplan</h4><p>Dosierung & Erinnerungen</p></div></div><div class="menu-item" onclick="nav('questions')"><div class="menu-item-icon">❓</div><div><h4>Fragen</h4><p>An Anästhesist & Operateur</p></div></div><div class="menu-item" onclick="nav('packlist')"><div class="menu-item-icon">📦</div><div><h4>Packliste</h4><p>Was Sie mitnehmen sollten</p></div></div></div><div class="menu-section"><div class="menu-section-title">Dokumentation</div><div class="menu-item" onclick="nav('photos')"><div class="menu-item-icon">📷</div><div><h4>Fotos</h4><p>Wundheilung, Aufklärungen</p></div></div><div class="menu-item" onclick="nav('wounddiary')"><div class="menu-item-icon">📔</div><div><h4>Wundtagebuch</h4><p>Chronologische Übersicht</p></div></div><div class="menu-item" onclick="nav('documents')"><div class="menu-item-icon">📁</div><div><h4>Dokumente</h4><p>PDFs und Dateien hochladen</p></div></div><div class="menu-item" onclick="nav('voice')"><div class="menu-item-icon">🎤</div><div><h4>Sprache</h4><p>Memos & Transkription</p></div></div><div class="menu-item" onclick="nav('pain')"><div class="menu-item-icon">📊</div><div><h4>Schmerz-Tracking</h4><p>VAS-Skala & Verlauf</p></div></div><div class="menu-item" onclick="nav('vitals')"><div class="menu-item-icon">❤️</div><div><h4>Vitalwerte</h4><p>Blutdruck & Puls</p></div></div><div class="menu-item" onclick="nav('medrecords')"><div class="menu-item-icon">💊</div><div><h4>Medikamenten-Doku</h4><p>Einnahmen protokollieren</p></div></div></div><div class="menu-section"><div class="menu-item" onclick="nav('assistant')"><div class="menu-item-icon">🤖</div><div><h4>KI-Assistent</h4><p>Medizinische Fragen</p></div></div><div class="menu-item" onclick="nav('settings')"><div class="menu-item-icon">⚙️</div><div><h4>Einstellungen</h4><p>OP-Daten, Design, Daten</p></div></div></div></div>`;}
function renderScreen(){switch(state.currentScreen){case'dashboard':return renderDashboard();case'timeline':return renderTimeline();case'info':return renderInfo();case'warning':return renderWarning();case'photos':return renderPhotos();case'documents':return renderDocuments();case'voice':return renderVoice();case'pain':return renderPain();case'vitals':return renderVitals();case'medrecords':return renderMedRecords();case'appointments':return renderAppts();case'medications':return renderMeds();case'questions':return renderQuestions();case'packlist':return renderPacklist();case'assistant':return renderAssistant();case'settings':return renderSettings();case'wounddiary':return renderWoundDiary();case'doctormode':return renderDoctorMode();case'export':return renderExport();case'impressum':return renderImpressum();default:return renderDashboard();}}
function renderOnboarding(){const steps=[{title:t('welcome'),subtitle:t('subtitle'),content:`<p style="font-size:.8rem;color:var(--muted);margin-bottom:12px;text-align:center;">${t('acceptTerms')}</p><div class="checkbox-group" onclick="this.querySelector('input').click()"><input type="checkbox" id="disclaimer" ${state.profile.disclaimerAccepted?'checked':''}><div class="custom-checkbox"></div><div class="checkbox-label"><div class="checkbox-title">⚕️ ${t('medicalNote')}</div><div class="checkbox-desc">${t('medicalNoteDesc')}</div></div></div><div class="checkbox-group" onclick="this.querySelector('input').click()"><input type="checkbox" id="privacy" ${state.profile.privacyAccepted?'checked':''}><div class="custom-checkbox"></div><div class="checkbox-label"><div class="checkbox-title">🔒 ${t('privacy')}</div><div class="checkbox-desc">${t('privacyDesc')}</div></div></div>`},{title:t('yourOp'),subtitle:t('whenWhat'),content:`<div class="form-group"><label class="form-label">📅 ${t('opDate')}</label><input type="date" class="form-input date-input" id="opDate" value="${state.profile.opDate}" min="${new Date().toISOString().split('T')[0]}"></div><div class="form-group"><label class="form-label">🏥 ${t('opType')}</label><input type="text" class="form-input" id="opType" value="${state.profile.opType}" placeholder="${t('opTypePlaceholder')}"></div><div class="form-group"><label class="form-label">${t('opMode')}</label><p style="font-size:.8rem;color:var(--muted);margin-bottom:12px;line-height:1.4;"><strong>${t('ambulant')}:</strong> ${t('ambulantExplain')}<br><strong>${t('stationary')}:</strong> ${t('stationaryExplain')}</p><div class="op-mode-toggle" style="flex-direction:column;gap:8px;"><button class="op-mode-btn ${state.profile.opMode==='ambulant'?'active':''}" onclick="setOpMode('ambulant')">${t('ambulant')}</button><button class="op-mode-btn ${state.profile.opMode==='stationary'?'active':''}" onclick="setOpMode('stationary')">${t('stationary')}</button><button class="op-mode-btn ${state.profile.opMode==='unknown'?'active':''}" onclick="setOpMode('unknown')">${t('iDontKnow')}</button></div></div>`},{title:t('contacts'),subtitle:t('contactsSubtitle'),content:`<div class="form-group"><label class="form-label">🏥 ${t('clinic')}</label><input type="text" class="form-input" id="hospitalName" value="${state.profile.hospitalName}" placeholder="${t('clinicPlaceholder')}"></div><div class="form-group"><label class="form-label">📞 ${t('phone')}</label><input type="tel" class="form-input" id="hospitalPhone" value="${state.profile.hospitalPhone}" placeholder="030 12345678"></div><div class="form-group"><label class="form-label">👤 ${t('emergencyContact')}</label><input type="text" class="form-input" id="emergencyContact" value="${state.profile.emergencyContact}" placeholder="${t('nameAndPhone')}"></div>`},{title:'🚗 '+t('transport'),subtitle:t('transportSubtitle'),content:`<div class="form-group"><label class="form-label">⏰ ${t('departureTime')}</label><input type="time" class="form-input" id="departureTime" value="${state.profile.departureTime||''}"></div><div class="form-group"><label class="form-label">⏱️ ${t('travelDuration')}</label><input type="number" class="form-input" id="travelDuration" value="${state.profile.travelDuration||''}" placeholder="45" min="1" max="300"></div><div class="form-group"><label class="form-label">🚕 ${t('transportAlt')}</label><input type="text" class="form-input" id="transportAlt" value="${state.profile.transportAlt||''}" placeholder="${t('transportAltPlaceholder')}"></div>`},{title:t('allReady'),subtitle:t('letsGoSubtitle'),content:`<div style="text-align:center;padding:16px;"><div style="font-size:3.5rem;margin-bottom:14px;">🚀</div><p style="color:var(--muted);">${t('timelineCreated')}</p></div>`}];const s=steps[state.onboardingStep];return`<div class="onboarding"><header class="header"><img src="${LOGO_BASE64}" class="logo-img" alt="Logo"><div class="logo">Operationsbegleiter</div><button class="icon-btn" onclick="toggleTheme()">${state.theme==='light'?'🌙':'☀️'}</button></header><div class="onboarding-progress">${steps.map((_,i)=>`<div class="progress-dot ${i<state.onboardingStep?'completed':''} ${i===state.onboardingStep?'active':''}"></div>`).join('')}</div><div class="onboarding-content"><div class="onboarding-hero"><img src="${LOGO_BASE64}" class="onboarding-logo" alt="Logo"><h1 class="onboarding-title">${s.title}</h1><p class="onboarding-subtitle">${s.subtitle}</p></div>${s.content}</div><div class="onboarding-nav">${state.onboardingStep>0?`<button class="btn btn-secondary" onclick="prevStep()">${t('back')}</button>`:''}<button class="btn btn-primary btn-block" onclick="nextStep()">${state.onboardingStep===steps.length-1?t('letsGo'):t('next')}</button></div></div>`;}
function setLanguage(lang){}
function setOpMode(mode){state.profile.opMode=mode;saveState();render();showToast('Gespeichert ✓');}
function renderDashboard(){const d=getDaysUntil();const next=state.tasks.filter(tk=>!tk.completed).sort((a,b)=>a.day-b.day).slice(0,3);const appts=state.appointments.filter(a=>new Date(a.datetime)>new Date()).slice(0,2);let cv='?',cu=t('noDate');if(d!==null){if(d<0){cv=Math.abs(d);cu=t('daysToOp').replace('bis','seit');}else if(d===0){cv='🎯';cu=t('todayOpDay');}else{cv=d;cu=d===1?'Tag bis OP':t('daysToOp');}}const opModeText=state.profile.opMode==='ambulant'?'('+t('ambulant')+')':state.profile.opMode==='stationary'?'('+t('stationary')+')':'';return`<div class="screen"><div class="hero"><div class="hero-label">🏥 ${state.profile.opType||'Ihre OP'} ${opModeText}</div><div class="hero-value">${cv}</div><div class="hero-unit">${cu}</div><div class="hero-date">📅 ${formatDate(state.profile.opDate)}${state.profile.departureTime?' • 🚗 '+state.profile.departureTime+' Uhr':''}</div></div><div class="section-header"><h2 class="section-title">⚡ ${t('quickAccess')}</h2></div><div class="grid"><div class="grid-card" onclick="nav('timeline')"><div class="grid-icon">📋</div><div class="grid-label">${t('timeline')}</div></div><div class="grid-card" onclick="nav('questions')"><div class="grid-icon">❓</div><div class="grid-label">${t('questions')}</div></div><div class="grid-card" onclick="nav('photos')"><div class="grid-icon">📷</div><div class="grid-label">${t('photos')}</div></div><div class="grid-card" onclick="nav('wounddiary')"><div class="grid-icon">📔</div><div class="grid-label">${t('woundDiary')}</div></div><div class="grid-card" onclick="nav('doctormode')"><div class="grid-icon">👨‍⚕️</div><div class="grid-label">${t('doctorMode')}</div></div><div class="grid-card" onclick="nav('voice')"><div class="grid-icon">🎤</div><div class="grid-label">${t('voice')}</div></div></div><div class="section-header"><h2 class="section-title">📌 ${t('nextTasks')}</h2><span class="section-link" onclick="nav('timeline')">${t('all')}</span></div><div class="card">${next.length?next.map(tk=>{const today=tk.day===-d;return`<div class="card-item" onclick="nav('timeline')"><div class="badge ${today?'today':''}">` +`${tk.day===0?'OP':(tk.day>0?'D+'+tk.day:'D'+tk.day)}</div><div class="card-content"><div class="card-title">${tk.title}</div><div class="card-desc">${tk.desc}</div></div></div>`;}).join(''):'<div class="card-item"><div class="card-content" style="text-align:center;padding:16px;"><div style="font-size:1.8rem;margin-bottom:8px;">🎉</div><div class="card-title">Alle erledigt!</div></div></div>'}</div>${appts.length?`<div class="section-header" style="margin-top:20px;"><h2 class="section-title">📅 ${t('appointments')}</h2><span class="section-link" onclick="nav('appointments')">${t('all')}</span></div>${appts.map(a=>{const dt=new Date(a.datetime);return`<div class="appt-card"><div class="appt-date"><div class="appt-day">${dt.getDate()}</div><div class="appt-month">${dt.toLocaleDateString(getLocale(),{month:'short'})}</div></div><div class="appt-info"><div class="appt-title">${a.title}</div><div class="appt-details">${dt.toLocaleTimeString(getLocale(),{hour:'2-digit',minute:'2-digit'})} Uhr${a.location?' • '+a.location:''}</div></div></div>`;}).join('')}`:''}</div>`;}
function addCustomTaskModal(){const d=getDaysUntil()||0;showModal('➕ Eigene Aufgabe hinzufügen',`<div class="form-group"><label class="form-label">Titel</label><input type="text" class="form-input" id="customTaskTitle" placeholder="z.B. Physiotherapie-Übungen"></div><div class="form-group"><label class="form-label">Beschreibung</label><input type="text" class="form-input" id="customTaskDesc" placeholder="z.B. 3x täglich für 15 Min."></div><div class="form-group"><label class="form-label">Tag (relativ zum OP-Tag)</label><select class="form-select" id="customTaskDay"><option value="-7">7 Tage vor OP</option><option value="-3">3 Tage vor OP</option><option value="-2">2 Tage vor OP</option><option value="-1">1 Tag vor OP</option><option value="0">OP-Tag</option><option value="1" selected>1 Tag nach OP</option><option value="2">2 Tage nach OP</option><option value="3">3 Tage nach OP</option><option value="5">5 Tage nach OP</option><option value="7">7 Tage nach OP</option><option value="10">10 Tage nach OP</option><option value="14">14 Tage nach OP</option><option value="21">21 Tage nach OP</option><option value="28">28 Tage nach OP</option></select></div><div style="display:flex;gap:10px;margin-top:16px;"><button class="btn btn-secondary" style="flex:1;" onclick="closeModal()">Abbrechen</button><button class="btn btn-primary" style="flex:1;" onclick="saveCustomTask()">Hinzufügen</button></div>`);}
function saveCustomTask(){const title=document.getElementById('customTaskTitle').value.trim();const desc=document.getElementById('customTaskDesc').value.trim();const day=parseInt(document.getElementById('customTaskDay').value);if(!title){showToast('Bitte einen Titel eingeben');return;}const newTask={id:'custom_'+Date.now(),title:title,desc:desc||'Eigene Aufgabe',day:day,completed:false,custom:true};state.tasks.push(newTask);saveState();closeModal();showToast('Aufgabe hinzugefügt');render();}
function deleteCustomTask(tid){if(!confirm('Aufgabe wirklich löschen?'))return;state.tasks=state.tasks.filter(t=>t.id!==tid);saveState();showToast('Aufgabe gelöscht');render();}
function renderTimeline(){const d=getDaysUntil();const done=state.tasks.filter(tk=>tk.completed).length,total=state.tasks.length,prog=total>0?Math.round((done/total)*100):0;const grouped={};state.tasks.forEach(tk=>{if(!grouped[tk.day])grouped[tk.day]=[];grouped[tk.day].push(tk);});const days=Object.keys(grouped).map(Number).sort((a,b)=>a-b);const dayLabel=day=>{if(day===0)return t('opDayLabel');if(day>0)return`D+${day} (Nach OP)`;return`D${day} (${Math.abs(day)} Tag${Math.abs(day)>1?'e':''} vorher)`;};const getTaskLink=title=>{const lower=title.toLowerCase();if(lower.includes('medikament'))return'medications';if(lower.includes('kleidung')||lower.includes('pack'))return'packlist';if(lower.includes('transport'))return'settings';if(lower.includes('termin'))return'appointments';if(lower.includes('doku')||lower.includes('foto'))return'photos';if(lower.includes('frage'))return'questions';if(lower.includes('faden')||lower.includes('klammer'))return'sutureGuide';return null;};return`<div class="screen"><div class="section-header"><h1 class="section-title">📋 ${t('timeline')}</h1><button class="btn btn-primary btn-sm" onclick="addCustomTaskModal()">➕ Aufgabe</button></div><div class="card" style="padding:14px;margin-bottom:16px;"><div class="progress-container"><div class="progress-label"><span>Fortschritt</span><span>${done}/${total} (${prog}%)</span></div><div class="progress-bar"><div class="progress-fill" style="width:${prog}%"></div></div></div><div class="filter-tabs"><button class="filter-tab active" data-filter="all">Alle</button><button class="filter-tab" data-filter="open">Offen</button><button class="filter-tab" data-filter="done">Erledigt</button></div></div>${d!==null&&d<=1&&d>=0?`<div class="fasting"><div class="fasting-title">🚫 Nüchternheit!</div><div class="fasting-rule"><div class="fasting-icon">🍽️</div><div class="fasting-text"><strong>8h vor OP</strong><span>${t('noEating')}</span></div></div><div class="fasting-rule"><div class="fasting-icon">💧</div><div class="fasting-text"><strong>2h vor OP</strong><span>${t('clearFluidsOnly')}</span></div></div><button class="btn btn-secondary btn-sm" style="margin-top:10px;" onclick="fastingAlarmModal()">⏰ ${t('setAlarm')}</button></div>`:''}<div class="timeline"><div class="timeline-line"></div>${days.map(day=>{const tasks=grouped[day];const date=getDateFor(day);const today=day===-d,op=day===0,allDone=tasks.every(tk=>tk.completed);return`<div class="timeline-phase"><div class="timeline-header"><div class="timeline-dot ${today?'today':''} ${op?'op':''} ${allDone&&!op?'completed':''}"></div><div><div class="phase-label">${dayLabel(day)}${today?' <span style="background:var(--warning);color:#fff;padding:2px 6px;border-radius:8px;font-size:.65rem;margin-left:6px;">HEUTE</span>':''}</div><div class="phase-date">${date?date.toLocaleDateString(getLocale(),{weekday:'short',day:'numeric',month:'short'}):''}</div></div></div>${tasks.map(tk=>{const link=getTaskLink(tk.title);const isSuture=link==='sutureGuide';const isCustom=tk.custom===true;return`<div class="task ${tk.completed?'completed':''}" data-id="${tk.id}"><div class="task-header"><div class="task-check ${tk.completed?'checked':''}" onclick="event.stopPropagation();toggleTask('${tk.id}')">${tk.completed?'✓':''}</div><div class="task-content"><div class="task-title">${tk.title}${isCustom?' <span style="font-size:.65rem;background:var(--secondary);color:#fff;padding:1px 6px;border-radius:6px;">Eigene</span>':''}${link&&!isSuture?'<span style="font-size:.7rem;margin-left:6px;color:var(--primary);">→</span>':''}</div><div class="task-desc">${tk.desc}</div>${isSuture?`<button class="btn btn-secondary btn-sm" style="margin-top:8px;" onclick="event.stopPropagation();showSutureGuide()">📖 Anleitung anzeigen</button>`:''} ${tk.note?`<div class="task-note">📝 ${tk.note}</div>`:''}<div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;"><button class="add-note-btn" onclick="event.stopPropagation();noteModal('${tk.id}')">${tk.note?'✏️ Bearbeiten':'➕ Notiz'}</button>${isCustom?`<button class="add-note-btn" style="color:var(--danger);" onclick="event.stopPropagation();deleteCustomTask('${tk.id}')">🗑️ Löschen</button>`:''}</div></div></div></div>`;}).join('')}</div>`;}).join('')}</div></div>`;}
function renderInfo(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('opInfosTitle')}</h1></div><div class="tabs"><button class="tab active" data-tab="ablauf">Ablauf</button><button class="tab" data-tab="vorbereitung">Vorbereitung</button><button class="tab" data-tab="nachsorge">Nach OP</button><button class="tab" data-tab="fragen">Fragen</button></div><div class="info-content" id="infoContent"><div class="info-section" data-content="ablauf"><h3 style="margin-bottom:12px;color:var(--text)">🔄 Ablauf</h3><ul class="info-list">${getOpInfo().ablauf.map(i=>`<li>${i}</li>`).join('')}</ul></div><div class="info-section hidden" data-content="vorbereitung"><h3 style="margin-bottom:12px;color:var(--text)">✅ Vorbereitung</h3><ul class="info-list">${getOpInfo().vorbereitung.map(i=>`<li>${i}</li>`).join('')}</ul></div><div class="info-section hidden" data-content="nachsorge"><h3 style="margin-bottom:12px;color:var(--text)">🏠 Nachsorge</h3><ul class="info-list">${getOpInfo().nachsorge.map(i=>`<li>${i}</li>`).join('')}</ul></div><div class="info-section hidden" data-content="fragen"><h3 style="margin-bottom:12px;color:var(--text)">❓ Häufige Fragen</h3>${getOpInfo().fragen.map(f=>`<div style="margin-bottom:14px;"><strong style="color:var(--text)">${f.q}</strong><p style="color:var(--muted);margin-top:4px;">${f.a}</p></div>`).join('')}</div></div><div class="disclaimer"><span>ℹ️</span><div><strong>Wichtig:</strong> Folgen Sie den Anweisungen Ihres Behandlungsteams.</div></div></div>`;}
function renderWarning(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('warningSignsTitle')}</h1></div><div class="emergency"><div class="emergency-title">${t('emergencyTitle')}</div><p>${t('lifeThreatening')}</p><a href="tel:112" class="emergency-btn">${t('call112')}</a></div><p style="color:var(--muted);margin-bottom:14px;">${t('contactClinicFor')}</p>${getWarnings().map(w=>`<div class="warning-card"><div class="warning-icon">${w.icon}</div><div><h4>${w.title}</h4><p>${w.desc}</p></div></div>`).join('')}${state.profile.hospitalPhone?`<a href="tel:${state.profile.hospitalPhone}" class="clinic-btn">📞 ${state.profile.hospitalName||'Klinik'} anrufen</a>`:'<div class="storage-info" style="margin-top:16px;"><span>💡</span><p>Kliniktelefon in Einstellungen speichern.</p></div>'}</div>`;}
function renderQuestions(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('questionsTitle')}</h1></div><p style="color:var(--muted);margin-bottom:16px;">${t('noteQuestionsText')}</p><div class="question-card"><div class="question-header anaesthesist"><div class="question-icon">😷</div><div class="question-header-info"><h3>${t('anesthesiologist')}</h3><p>${t('anesthesiaQs')}</p></div></div><div class="question-timing op-tag">⏰ Gespräch: Am OP-Tag oder 1 Tag vorher</div><div class="question-body">${state.questions.anaesthesist.length?state.questions.anaesthesist.map(q=>`<div class="question-item"><span class="question-bullet">•</span><span class="question-text">${q.text}</span><button class="question-del" onclick="delQuestion('anaesthesist','${q.id}')">✕</button></div>`).join(''):'<div class="question-empty">'+t('noQuestionsYet')+'</div>'}<button class="btn btn-secondary btn-block btn-sm" onclick="questionModal('anaesthesist')">${t('addQuestionBtn')}</button></div></div><div class="question-card"><div class="question-header operateur"><div class="question-icon">👨‍⚕️</div><div class="question-header-info"><h3>${t('surgeonTitle')}</h3><p>${t('surgeryQs')}</p></div></div><div class="question-timing vor-op">⏰ Aufklärungsgespräch: Tage/Wochen vor OP</div><div class="question-timing nach-op" style="margin-left:8px;">⏰ Nachgespräch: Nach der OP</div><div class="question-body">${state.questions.operateur.length?state.questions.operateur.map(q=>`<div class="question-item"><span class="question-bullet">•</span><span class="question-text">${q.text}</span><button class="question-del" onclick="delQuestion('operateur','${q.id}')">✕</button></div>`).join(''):'<div class="question-empty">'+t('noQuestionsYet')+'</div>'}<button class="btn btn-secondary btn-block btn-sm" onclick="questionModal('operateur')">${t('addQuestionBtn')}</button></div></div><div class="disclaimer"><span>💡</span><div>Tipp: Notieren Sie Ihre Fragen im Voraus, damit Sie im Gespräch nichts vergessen!</div></div></div>`;}
function renderPhotos(){const q=(state.photoSearch||'').toLowerCase();const allPhotos=state.photos.filter(p=>!q||formatShort(p.date).toLowerCase().includes(q)||(p.note||'').toLowerCase().includes(q)||p.category.toLowerCase().includes(q));const wound=allPhotos.filter(p=>p.category==='wound'),consent=allPhotos.filter(p=>p.category==='consent'),other=allPhotos.filter(p=>p.category==='other');const renderPhotoItem=(p)=>`<div class="photo-item" onclick="viewPhoto('${p.id}')" data-media-id="${p.mediaId||''}" data-photo-id="${p.id}"><img src="" data-photo-placeholder="true" style="background:var(--bg);"><div class="photo-date">${formatShort(p.date)}</div><button class="photo-delete" onclick="event.stopPropagation();delPhoto('${p.id}')">✕</button></div>`;setTimeout(()=>loadPhotoThumbnails(),50);return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('photos')}</h1></div><div style="margin-bottom:16px;"><input type="text" class="form-input" placeholder="🔍 Fotos durchsuchen (Datum, Notiz, Kategorie)..." value="${state.photoSearch||''}" oninput="setState({photoSearch:this.value})"></div><div style="margin-bottom:20px;"><h3 style="margin-bottom:10px;color:var(--text)">${t('woundHealingTitle')} (${wound.length})</h3><div class="upload-area" onclick="document.getElementById('woundUp').click()"><div class="upload-icon">📷</div><div class="upload-text">${t('takePhoto')}</div></div><input type="file" id="woundUp" class="file-input" accept="image/*" capture="environment" multiple onchange="handlePhoto(event,'wound')">${wound.length?`<div class="photo-grid">${wound.map(renderPhotoItem).join('')}</div>`:''}</div><div style="margin-bottom:20px;"><h3 style="margin-bottom:10px;color:var(--text)">${t('opConsents')} (${consent.length})</h3><div class="upload-area" onclick="document.getElementById('consentUp').click()"><div class="upload-icon">📋</div><div class="upload-text">${t('photographDoc')}</div></div><input type="file" id="consentUp" class="file-input" accept="image/*" capture="environment" multiple onchange="handlePhoto(event,'consent')">${consent.length?`<div class="photo-grid">${consent.map(renderPhotoItem).join('')}</div>`:''}</div><div><h3 style="margin-bottom:10px;color:var(--text)">${t('otherPhotos')} (${other.length})</h3><div class="upload-area" onclick="document.getElementById('otherUp').click()"><div class="upload-icon">🖼️</div><div class="upload-text">${t('morePhotos')}</div></div><input type="file" id="otherUp" class="file-input" accept="image/*" capture="environment" multiple onchange="handlePhoto(event,'other')">${other.length?`<div class="photo-grid">${other.map(renderPhotoItem).join('')}</div>`:''}</div></div>`;}
async function loadPhotoThumbnails(){const imgs=document.querySelectorAll('img[data-photo-placeholder="true"]');for(const img of imgs){const container=img.closest('.photo-item');if(!container)continue;const mediaId=container.dataset.mediaId;const photoId=container.dataset.photoId;if(mediaId){try{const media=await getMedia(mediaId);if(media){img.src=getCachedUrl(mediaId,media.blob);img.removeAttribute('data-photo-placeholder');}else{img.alt='Nicht verfügbar';img.style.opacity='0.5';}}catch(e){console.error('Thumbnail load error:',e);}}else{const p=state.photos.find(x=>x.id===photoId);if(p&&p.data){img.src=p.data;img.removeAttribute('data-photo-placeholder');}}}}
async function loadWoundDiaryThumbnails(){if(state.currentScreen!=='wounddiary')return;const imgs=document.querySelectorAll('img[data-wound-placeholder="true"]');for(const img of imgs){const mediaId=img.dataset.mediaId;const photoId=img.dataset.photoId;if(mediaId){try{const media=await getMedia(mediaId);if(media){img.src=getCachedUrl(mediaId,media.blob);img.removeAttribute('data-wound-placeholder');}else{img.alt='Nicht verfügbar';img.style.opacity='0.5';img.removeAttribute('data-wound-placeholder');}}catch(e){console.error('Wound thumbnail error:',e);img.alt='Fehler';img.style.opacity='0.5';}}else{const p=state.photos.find(x=>x.id===photoId);if(p&&p.data){img.src=p.data;img.removeAttribute('data-wound-placeholder');}else{img.alt='Nicht verfügbar';img.style.opacity='0.5';}}}}
function renderDocuments(){const q=(state.docSearch||'').toLowerCase();const filteredDocs=state.uploadedDocs.filter(d=>!q||d.name.toLowerCase().includes(q)||formatShort(d.date).toLowerCase().includes(q));return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('documentsTitle')} (${state.uploadedDocs.length})</h1></div><div style="margin-bottom:16px;"><input type="text" class="form-input" placeholder="🔍 Dokumente durchsuchen..." value="${state.docSearch||''}" oninput="setState({docSearch:this.value})"></div><p style="color:var(--muted);margin-bottom:16px;">${t('uploadDocsText')}</p><div class="upload-area" onclick="document.getElementById('docUp').click()"><div class="upload-icon">📄</div><div class="upload-text">${t('uploadDoc')}<br><small>${t('pdfWordImages')}</small></div></div><input type="file" id="docUp" class="file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" multiple onchange="handleDocUpload(event)">${filteredDocs.length?`<div style="margin-top:16px;">${filteredDocs.map(d=>`<div class="doc-file" onclick="openDocument('${d.id}')" style="cursor:pointer;"><div class="doc-file-icon">${d.type.includes('pdf')?'📕':d.type.includes('word')||d.type.includes('doc')?'📘':'🖼️'}</div><div class="doc-file-info"><div class="doc-file-name">${d.name} <span style="font-size:.7rem;color:var(--primary);">→ Öffnen</span></div><div class="doc-file-meta">${formatFileSize(d.size)} • ${formatShort(d.date)}</div></div><button class="doc-file-del" onclick="event.stopPropagation();delUploadedDoc('${d.id}')">🗑️</button></div>`).join('')}</div>`:(state.uploadedDocs.length?'<p style="color:var(--muted);margin-top:16px;">Keine Treffer für diese Suche</p>':'<div class="storage-info" style="margin-top:16px;"><span>📂</span><p>'+t('noDocsYet')+'</p></div>')}</div>`;}
async function openDocument(did){const d=state.uploadedDocs.find(x=>x.id===did);if(!d)return showToast('Dokument nicht gefunden');try{let blob=null;if(d.mediaId){const media=await getMedia(d.mediaId);if(media){blob=media.blob;}else{showToast('Datei nicht verfügbar');return;}}else if(d.data){blob=dataURLToBlob(d.data);}if(blob){const url=URL.createObjectURL(blob);window.open(url,'_blank');setTimeout(()=>URL.revokeObjectURL(url),60000);}else{showToast('Datei nicht verfügbar');}}catch(e){console.error('Open doc error:',e);showToast('Fehler beim Öffnen');}}
function renderVoice(){const isRec=mediaRecorder&&mediaRecorder.state==='recording',isListen=recognition!==null;const needsHttps=location.protocol!=='https:'&&location.hostname!=='localhost'&&location.hostname!=='127.0.0.1';const SR=window.SpeechRecognition||window.webkitSpeechRecognition;const speechSupported=!!SR;return`<div class="screen"><div class="section-header"><h1 class="section-title">🎤 Sprache</h1></div>${needsHttps?`<div class="https-warning"><div class="https-warning-icon">🔒</div><div class="https-warning-text"><strong>HTTPS erforderlich</strong><br>Die Sprache-zu-Text-Funktion benötigt eine sichere Verbindung (HTTPS). Die App über HTTPS öffnen oder lokal testen.</div></div>`:''}<div style="margin-bottom:20px;"><h3 style="margin-bottom:10px;color:var(--text)">🎙️ Sprache zu Text</h3><p style="color:var(--muted);font-size:.85rem;margin-bottom:12px;">Arzt-Gespräche direkt in Text umwandeln. Funktioniert am besten in <strong>Chrome</strong> oder <strong>Safari</strong>.</p>${!speechSupported?`<div class="https-warning"><div class="https-warning-icon">⚠️</div><div class="https-warning-text">Ihr Browser unterstützt keine Sprache-zu-Text-Funktion. Bitte verwenden Sie <strong>Google Chrome</strong> oder <strong>Safari</strong>.</div></div>`:`<button class="speech-btn ${isListen?'listening':''}" onclick="${isListen?'stopSpeech()':'startSpeech()'}"><span style="font-size:1.5rem;">${isListen?'⏹️':'🎤'}</span>${isListen?'Aufnahme stoppen & speichern':'Aufnahme starten'}</button>`}${isListen?`<div class="speech-status"><div class="speech-pulse"></div><span style="color:var(--danger);font-weight:600;">Aufnahme aktiv - Sprechen Sie jetzt</span></div><div id="liveText" style="margin-top:14px;padding:16px;background-color:var(--card);border:2px solid var(--primary);border-radius:var(--radius);min-height:100px;color:var(--text);font-size:1rem;line-height:1.6;">🎤 <strong>Aufnahme läuft</strong> - Sprechen Sie jetzt deutlich ins Mikrofon...</div><p style="color:var(--muted);font-size:.8rem;margin-top:10px;text-align:center;">💡 Tipp: Sprechen Sie langsam und deutlich. Tippen Sie auf "Stoppen" um den Text zu speichern.</p>`:''}</div>${state.transcripts.length?`<div style="margin-bottom:20px;"><h4 style="margin:0 0 12px;color:var(--text);display:flex;align-items:center;gap:8px;">📝 Gespeicherte Texte <span style="background:var(--primary);color:#fff;font-size:.7rem;padding:2px 8px;border-radius:10px;">${state.transcripts.length}</span></h4><div class="search-box" style="margin-bottom:12px;"><input type="text" class="form-input" placeholder="🔍 Texte durchsuchen..." value="${state.transcriptSearch||''}" oninput="setState({transcriptSearch:this.value})"></div>${state.transcripts.filter(tr=>!state.transcriptSearch||(tr.name||'').toLowerCase().includes((state.transcriptSearch||'').toLowerCase())||tr.text.toLowerCase().includes((state.transcriptSearch||'').toLowerCase())).slice().reverse().map(t=>`<div class="transcript-item"><div class="transcript-header"><div><div class="transcript-name">${escapeHtml(t.name)||'Transkript'}</div><span class="transcript-date">${formatDT(t.date)}</span></div><div style="display:flex;gap:8px;"><button class="transcript-edit" onclick="editTranscript('${t.id}')" style="min-width:44px;min-height:44px;font-size:1.2rem;">✏️</button><button class="transcript-delete" onclick="delTranscript('${t.id}')" style="min-width:44px;min-height:44px;font-size:1.2rem;">🗑️</button></div></div><div class="transcript-text" style="margin-top:8px;padding:12px;background:var(--bg);border-radius:8px;line-height:1.5;">${escapeHtml(t.text)}</div></div>`).join('')}</div>`:''}<div><h3 style="margin-bottom:10px;color:var(--text)">🎤 Sprachmemos</h3><p style="color:var(--muted);font-size:.85rem;margin-bottom:12px;">Audiomemos aufnehmen und abspielen. Aufnahmen werden lokal gespeichert.</p><div class="recording-controls"><button class="record-btn ${isRec?'recording':''}" onclick="${isRec?'stopRec()':'startRec()'}" style="min-width:80px;min-height:80px;">${isRec?'⏹️':'🎤'}</button><div class="recording-status ${isRec?'active':''}">${isRec?'🔴 Aufnahme läuft...':'Tippen zum Aufnehmen'}</div>${isRec?'<div class="recording-timer" id="recTimer">00:00</div>':''}</div>${state.voiceMemos.length?`<h4 style="margin:16px 0 10px;color:var(--text);">🎧 Gespeicherte Memos</h4>${state.voiceMemos.slice().reverse().map(m=>`<div class="memo-item"><button class="play-btn" onclick="playMemo('${m.id}')" style="min-width:48px;min-height:48px;font-size:1.3rem;">▶️</button><div class="memo-info" onclick="renameMemo('${m.id}')" style="cursor:pointer;flex:1;padding:8px;"><div class="memo-title">${escapeHtml(m.title)} <span style="font-size:.7rem;color:var(--muted);">✏️</span></div><div class="memo-meta">${formatDT(m.date)} • ${formatTime(m.duration)}</div></div><button class="memo-delete" onclick="delMemo('${m.id}')" style="min-width:44px;min-height:44px;font-size:1.2rem;">🗑️</button></div>`).join('')}`:''}</div></div>`;}
function renderPain(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('painTitle')}</h1></div><div class="vas-container"><h3 class="vas-title">${t('currentPain')}</h3><p style="color:var(--muted);font-size:.85rem;margin-bottom:12px;">${t('painScale')}</p><div class="vas-scale"><span class="vas-label">${t('noPain')}</span><input type="range" class="vas-slider" id="painSlider" min="0" max="10" value="0" oninput="document.getElementById('painVal').textContent=this.value"><span class="vas-value" id="painVal">0</span></div><div class="vas-emojis"><span>😊</span><span>😐</span><span>😣</span><span>😖</span><span>😫</span></div><button class="btn btn-primary btn-block" style="margin-top:16px;" onclick="savePain(document.getElementById('painSlider').value)">${t('saveBtn')}</button></div><div class="chart-container"><div class="chart-title">${t('courseTitle')}</div><div class="chart-canvas">${painChart()}</div></div>${state.painRecords.length?`<div style="margin-top:16px;"><h4 style="margin-bottom:10px;color:var(--text)">${t('lastEntries')}</h4>${state.painRecords.slice(-5).reverse().map(r=>`<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);"><span style="color:var(--text)">${formatDT(r.date)}</span><span style="font-weight:700;color:${r.value<=3?'var(--success)':r.value<=6?'var(--warning)':'var(--danger)'};">${r.value}/10</span></div>`).join('')}</div>`:''}</div>`;}
function renderVitals(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('vitalsTitle')}</h1></div><div class="vas-container"><h3 class="vas-title">${t('newMeasurement')}</h3><div class="vitals-row"><div class="vitals-group"><label>${t('systolicLabel')}</label><input type="number" id="sysIn" placeholder="120"></div><div class="vitals-group"><label>${t('diastolicLabel')}</label><input type="number" id="diaIn" placeholder="80"></div></div><div class="vitals-row"><div class="vitals-group"><label>${t('pulseBpmLabel')}</label><input type="number" id="pulIn" placeholder="70"></div></div><button class="btn btn-primary btn-block" style="margin-top:12px;" onclick="saveVitals()">${t('saveBtn')}</button></div><div class="chart-container"><div class="chart-title">${t('courseTitle')}</div><div class="chart-canvas">${vitalsChart()}</div></div>${state.vitalsRecords.length?`<div style="margin-top:16px;"><h4 style="margin-bottom:10px;color:var(--text)">${t('measurementsTitle')}</h4>${state.vitalsRecords.slice(-5).reverse().map(r=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);"><span style="font-size:.85rem;color:var(--muted);">${formatDT(r.date)}</span><div style="display:flex;gap:12px;"><span style="color:var(--danger);font-weight:600;">${r.systolic}/${r.diastolic}</span><span style="color:var(--success);font-weight:600;">❤️ ${r.pulse}</span></div></div>`).join('')}</div>`:''}</div>`;}
function renderMedRecords(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('medRecordsTitle')}</h1></div><div class="vas-container"><h3 class="vas-title">${t('documentIntake')}</h3><div class="form-group"><label class="form-label">${t('medicationLabel')}</label><input type="text" class="form-input" id="medRecName" placeholder="z.B. Ibuprofen"></div><div class="form-group"><label class="form-label">${t('doseOptional')}</label><input type="text" class="form-input" id="medRecDose" placeholder="z.B. 400mg"></div><button class="btn btn-primary btn-block" onclick="saveMedRec()">${t('documentBtn')}</button></div><div class="chart-container"><div class="chart-title">${t('intakesPerDay')}</div><div class="chart-canvas">${medChart()}</div></div>${state.medicationRecords.length?`<div style="margin-top:16px;"><h4 style="margin-bottom:10px;color:var(--text)">${t('lastTitle')}</h4>${state.medicationRecords.slice(-10).reverse().map(r=>`<div style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);"><span style="font-size:1.2rem;">💊</span><div style="flex:1;"><div style="font-weight:600;font-size:.9rem;color:var(--text)">${r.name}${r.dose?' ('+r.dose+')':''}</div><div style="font-size:.8rem;color:var(--muted);">${formatDT(r.date)}</div></div></div>`).join('')}</div>`:''}</div>`;}
function renderAppts(){const upcoming=state.appointments.filter(a=>new Date(a.datetime)>=new Date()).sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));const past=state.appointments.filter(a=>new Date(a.datetime)<new Date()).sort((a,b)=>new Date(b.datetime)-new Date(a.datetime));return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('appointmentsTitle')}</h1></div><button class="btn btn-primary btn-block" style="margin-bottom:16px;" onclick="apptModal()">${t('addAppointmentBtn')}</button>${upcoming.length?`<h3 style="margin-bottom:10px;color:var(--text)">${t('upcomingTitle')}</h3>${upcoming.map(a=>{const dt=new Date(a.datetime);return`<div class="appt-card"><div class="appt-date"><div class="appt-day">${dt.getDate()}</div><div class="appt-month">${dt.toLocaleDateString(getLocale(),{month:'short'})}</div></div><div class="appt-info"><div class="appt-title">${a.title}</div><div class="appt-details">${dt.toLocaleTimeString(getLocale(),{hour:'2-digit',minute:'2-digit'})} Uhr${a.location?' • '+a.location:''}${a.reminder?' • 🔔':''}</div>${a.notes?`<div style="font-size:.75rem;color:var(--muted);margin-top:3px;">${a.notes}</div>`:''}</div><button class="appt-delete" onclick="delAppt('${a.id}')">🗑️</button></div>`;}).join('')}`:'<div class="storage-info" style="margin-bottom:16px;"><span>📅</span><p>Keine Termine. Nachkontrollen hinzufügen!</p></div>'}${past.length?`<h3 style="margin:16px 0 10px;color:var(--muted);">${t('pastTitle')}</h3>${past.slice(0,5).map(a=>{const dt=new Date(a.datetime);return`<div class="appt-card" style="opacity:.5;"><div class="appt-date" style="background:var(--muted);"><div class="appt-day">${dt.getDate()}</div><div class="appt-month">${dt.toLocaleDateString(getLocale(),{month:'short'})}</div></div><div class="appt-info"><div class="appt-title">${a.title}</div><div class="appt-details">${dt.toLocaleTimeString(getLocale(),{hour:'2-digit',minute:'2-digit'})} Uhr</div></div></div>`;}).join('')}`:''}</div>`;}
function renderMeds(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('medPlanTitle')}</h1></div><button class="btn btn-primary btn-block" style="margin-bottom:16px;" onclick="medModal()">${t('addMedicationBtn')}</button>${state.medications.length?state.medications.map(m=>`<div class="med-card"><div class="med-header"><div><div class="med-name">💊 ${m.name}</div><div class="med-dose">${m.dose}${m.notes?' • '+m.notes:''}</div></div><button class="appt-delete" onclick="delMed('${m.id}')">🗑️</button></div><div class="med-times">${m.alarms.map((a,i)=>`<div class="med-time" onclick="toggleAlarm('${m.id}',${i})"><div class="alarm-dot ${a.enabled?'':'off'}"></div><span>${a.time}</span></div>`).join('')}</div></div>`).join(''):'<div class="storage-info"><span>💊</span><p>Keine Medikamente. Plan erstellen!</p></div>'}<div class="disclaimer" style="margin-top:16px;"><span>🔔</span><div>Tippen Sie auf eine Uhrzeit um die Erinnerung ein/auszuschalten.</div></div></div>`;}
function renderPacklist(){const allDocs=[...getDefaultDocs(),...state.customDocuments];const isAmbulant=state.profile.opMode==='ambulant';const dc=state.documentChecklist||{};const notNeededText=t('notNeededAmbulant');const ambulantNotNeeded=['d7','d8'];return`<div class="screen"><div class="section-header"><h1 class="section-title">📦 ${t('packingList')}</h1></div><p style="color:var(--muted);margin-bottom:14px;">Was Sie für die OP mitnehmen sollten:${isAmbulant?' <strong>(Ambulante OP)</strong>':''}</p><div class="doc-checklist"><h3 style="margin-bottom:12px;color:var(--text);display:flex;align-items:center;gap:8px;">📋 ${t('documentChecklist')}</h3><div class="doc-checklist-item" onclick="toggleDocCheck('referral')"><div class="doc-checklist-check ${dc.referral?'checked':''}">✓</div><span>☑️ ${t('referral')}</span></div><div class="doc-checklist-item" onclick="toggleDocCheck('transfer')"><div class="doc-checklist-check ${dc.transfer?'checked':''}">✓</div><span>☑️ ${t('transfer')}</span></div><div class="doc-checklist-item" onclick="toggleDocCheck('medicationList')"><div class="doc-checklist-check ${dc.medicationList?'checked':''}">✓</div><span>☑️ ${t('medicationList')}</span></div><div class="doc-checklist-item" onclick="toggleDocCheck('allergyPass')"><div class="doc-checklist-check ${dc.allergyPass?'checked':''}">✓</div><span>☑️ ${t('allergyPass')}</span></div><div class="doc-checklist-item" onclick="toggleDocCheck('anesthesiaPass')"><div class="doc-checklist-check ${dc.anesthesiaPass?'checked':''}">✓</div><span>☑️ ${t('anesthesiaPass')}</span></div></div><div class="fasting" style="margin-top:16px;"><h3 style="margin-bottom:12px;display:flex;align-items:center;gap:8px;">⏰ ${t('fastingAlarm')}</h3><p style="font-size:.85rem;margin-bottom:10px;">${t('noEating')} - ${t('clearFluidsOnly')}</p><button class="btn btn-secondary" onclick="fastingAlarmModal()">🔔 ${t('setAlarm')}</button></div><div class="card" style="margin-top:16px;">${allDocs.map(d=>{const notNeeded=isAmbulant&&ambulantNotNeeded.includes(d.id);return`<div class="doc-item ${state.documents.includes(d.id)?'checked':''} ${notNeeded?'not-needed-ambulant':''}" onclick="toggleDoc('${d.id}')"><div class="doc-check">${state.documents.includes(d.id)?'✓':''}</div><div class="doc-icon">${d.icon}</div><div class="doc-label">${d.label}${notNeeded?' <span style="font-size:.7rem;color:var(--muted);">'+notNeededText+'</span>':''}</div>${!getDefaultDocs().find(x=>x.id===d.id)?`<button class="doc-delete" onclick="event.stopPropagation();delCustomDoc('${d.id}')">🗑️</button>`:''}</div>`;}).join('')}</div><div style="margin-top:16px;padding:14px;background:linear-gradient(135deg,rgba(245,158,11,.1),rgba(239,68,68,.1));border:2px solid var(--warning);border-radius:var(--radius);"><p style="font-size:.9rem;color:var(--text);display:flex;align-items:center;gap:8px;">💍 ${t('jewelryNote')}</p></div><button class="btn btn-secondary btn-block" style="margin-top:12px;" onclick="addDocModal()">${t('addOwnEntry')}</button><button class="btn btn-secondary btn-block" style="margin-top:10px;" onclick="window.print()">${t('printList')}</button></div>`;}
function fastingAlarmModal(){showModal('⏰ '+t('fastingAlarm'),`<p style="color:var(--muted);margin-bottom:16px;">${t('noEating')} - ${t('clearFluidsOnly')}</p><div class="form-group"><label class="form-label">${t('alarmTime')}</label><input type="time" class="form-input" id="fastingAlarmTime" value="22:00"></div><button class="btn btn-primary btn-block" onclick="setFastingAlarm()">🔔 ${t('setAlarm')}</button>`);}
function renderAssistant(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('aiAssistantTitle')}</h1></div><div class="chat-container"><div class="chat-header"><div class="chat-header-icon">🤖</div><div class="chat-header-text"><h3>${t('medAssistant')}</h3><p>${t('opPrepQuestions')}</p></div></div><div class="chat-messages" id="chatMessages">${state.chatMessages.map(m=>`<div class="chat-message ${m.role}"><div class="chat-bubble">${m.content}</div></div>`).join('')}</div><div class="chat-input-area"><input type="text" class="chat-input" id="chatInput" placeholder="Ihre Frage..." onkeypress="if(event.key==='Enter')sendChatMessage()"><button class="chat-send" onclick="sendChatMessage()">➤</button></div><div class="chat-disclaimer">⚠️ Dieser Assistent gibt nur allgemeine Informationen. Bei medizinischen Fragen wenden Sie sich an Ihr Behandlungsteam.</div></div></div>`;}
function renderWoundDiary(){const diaryData=getWoundDiaryData();const woundNotes=state.woundNotes||[];return`<div class="screen"><div class="section-header"><h1 class="section-title">📔 ${t('woundDiary')}</h1></div><p style="color:var(--muted);margin-bottom:16px;">${t('woundDiaryDesc')}</p><div class="hygiene-tips"><h3 style="margin-bottom:12px;color:var(--text);display:flex;align-items:center;gap:8px;">🧴 ${t('woundHygiene')}</h3><div class="hygiene-step"><div class="hygiene-step-num">1</div><span>🖐️ ${t('hygieneStep1')}</span></div><div class="hygiene-step"><div class="hygiene-step-num">2</div><span>🩹 ${t('hygieneStep2')}</span></div><div class="hygiene-step"><div class="hygiene-step-num">3</div><span>📋 ${t('hygieneStep3')}</span></div><div class="hygiene-step"><div class="hygiene-step-num">4</div><span>⛔ ${t('hygieneStep4')}</span></div><div class="hygiene-step"><div class="hygiene-step-num">5</div><span>✨ ${t('hygieneStep5')}</span></div><div class="hygiene-step"><div class="hygiene-step-num">6</div><span>🖐️ ${t('hygieneStep6')}</span></div><p style="margin-top:12px;padding:10px;background:rgba(239,68,68,.1);border-radius:8px;font-size:.85rem;color:var(--danger);">⚠️ ${t('rednessWarning')}</p></div><div class="shower-tips"><h3 style="margin-bottom:12px;color:var(--text);display:flex;align-items:center;gap:8px;">🚿 ${t('showerHints')}</h3><ul style="list-style:none;padding:0;"><li style="padding:6px 0;display:flex;gap:8px;"><span>💧</span>${t('showerHint1')}</li><li style="padding:6px 0;display:flex;gap:8px;"><span>🩹</span>${t('showerHint2')}</li><li style="padding:6px 0;display:flex;gap:8px;"><span>♻️</span>${t('showerHint3')}</li></ul></div><div style="margin-bottom:16px;"><h3 style="margin-bottom:10px;color:var(--text);">⏰ ${t('woundAlarm')}</h3><button class="btn btn-secondary btn-block" onclick="woundAlarmModal()">🔔 ${t('setAlarm')}</button></div>${diaryData.length?`<div class="wound-timeline">${diaryData.map(day=>{const dayNotes=woundNotes.filter(n=>n.date===day.label);return`<div class="wound-day"><div class="wound-day-header"><span class="wound-day-badge">${day.label}</span><span class="wound-day-date">${day.date.toLocaleDateString(getLocale(),{weekday:'short',day:'numeric',month:'short'})}</span></div><div class="wound-day-content">${day.photos.length?`<div class="wound-day-photos">${day.photos.map(p=>`<div class="wound-day-photo" onclick="viewPhoto('${p.id}')"><img data-wound-placeholder="true" data-media-id="${p.mediaId||''}" data-photo-id="${p.id}" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect fill='%23e5e7eb' width='100' height='100'/%3E%3Ctext x='50' y='55' text-anchor='middle' fill='%239ca3af' font-size='12'%3ELädt...%3C/text%3E%3C/svg%3E" alt="Wundfoto" style="width:100%;height:100%;object-fit:cover;border-radius:8px;"></div>`).join('')}</div>`:''}<button class="btn btn-secondary btn-sm" onclick="document.getElementById('woundUpDiary').click()" style="margin-bottom:10px;">📷 Foto hinzufügen</button>${day.notes.length||dayNotes.length?`<div style="margin-top:8px;">${day.notes.map(n=>`<div class="wound-day-note"><strong>${n.title}</strong><br>${n.note}</div>`).join('')}${dayNotes.map(n=>`<div class="wound-day-note" style="margin-top:6px;">📝 ${n.note}</div>`).join('')}</div>`:''}</div></div>`;}).join('')}</div><input type="file" id="woundUpDiary" class="file-input" accept="image/*" capture="environment" onchange="handlePhoto(event,'wound')">`:`<div class="storage-info" style="text-align:center;padding:30px;"><div style="font-size:3rem;margin-bottom:16px;">📷</div><h3 style="color:var(--text);margin-bottom:8px;">${t('noWoundPhotos')}</h3><p style="margin-bottom:16px;">${t('documentWoundHealing')}</p><button class="btn btn-primary" onclick="nav('photos')">${t('takePhotosBtn')}</button></div>`}</div>`;}
function woundAlarmModal(){showModal('⏰ '+t('woundAlarm'),`<div class="form-group"><label class="form-label">${t('alarmTime')}</label><input type="time" class="form-input" id="woundAlarmTime" value="10:00"></div><div class="form-group"><label class="form-label">${t('alarmDays')}</label><div style="display:flex;flex-wrap:wrap;gap:8px;">${['Tag 1','Tag 3','Tag 5','Tag 7','Tag 10','Tag 14'].map(d=>`<label style="display:flex;align-items:center;gap:4px;padding:8px 12px;background:var(--card);border:1px solid var(--border);border-radius:8px;cursor:pointer;"><input type="checkbox" value="${d}" checked><span>${d}</span></label>`).join('')}</div></div><button class="btn btn-primary btn-block" onclick="setWoundAlarm()">🔔 ${t('setAlarm')}</button>`);}
function setWoundAlarm(){const time=document.getElementById('woundAlarmTime')?.value;const days=[...document.querySelectorAll('#modal input[type=checkbox]:checked')].map(c=>c.value);setState({woundAlarms:[...state.woundAlarms||[],{time,days,created:new Date().toISOString()}]});closeModal();showToast('Wecker gestellt ✓');if('Notification' in window&&Notification.permission==='granted'){showToast('Benachrichtigungen aktiviert');}}
function toggleDocCheck(item){const dc={...state.documentChecklist||{},};dc[item]=!dc[item];setState({documentChecklist:dc});}
function setFastingAlarm(){const time=document.getElementById('fastingAlarmTime')?.value;setState({fastingAlarms:[...state.fastingAlarms||[],{time,created:new Date().toISOString()}]});closeModal();showToast('Nüchtern-Wecker gestellt ✓');}
function renderDoctorMode(){const report=generateDoctorReport();const d=getDaysUntil();const bedarfsMed=state.medications.filter(m=>m.asNeeded);return`<div class="screen" id="doctorReport"><div class="section-header"><h1 class="section-title">👨‍⚕️ Kurzbericht</h1></div><p style="color:var(--muted);margin-bottom:12px;">Offline-tauglich für Arztgespräche</p><div style="display:flex;gap:10px;margin-bottom:16px;"><button class="btn btn-primary btn-sm" onclick="printReport()" style="flex:1;">🖨️ Als PDF drucken</button><button class="btn btn-secondary btn-sm" onclick="copyReportText()" style="flex:1;">📋 Als Text kopieren</button></div><div class="doctor-mode-card"><div class="doctor-mode-section"><div class="doctor-mode-title">📋 OP-Details</div><div class="doctor-mode-value"><strong>Art:</strong> ${report.opType}<br><strong>Datum:</strong> ${report.opDate}<br><strong>Tage post-OP:</strong> ${report.daysPostOp>0?report.daysPostOp:'-'}<br><strong>Modus:</strong> ${state.profile.opMode==='ambulant'?'Ambulant':state.profile.opMode==='stationary'?'Stationär':'k.A.'}</div></div></div>${report.warnings.length?`<div class="doctor-mode-card" style="border-color:var(--warning);background:rgba(245,158,11,.05);"><div class="doctor-mode-section" style="margin-bottom:0;"><div class="doctor-mode-title" style="color:var(--warning);">⚠️ Auffälligkeiten/Warnzeichen</div><ul class="doctor-mode-list">${report.warnings.map(w=>`<li style="color:var(--warning);">${w}</li>`).join('')}</ul></div></div>`:''}<div class="doctor-mode-card"><div class="doctor-mode-section"><div class="doctor-mode-title">📊 Schmerztrend (letzte 7 Tage)</div><div class="doctor-mode-value"><strong>Durchschnitt:</strong> ${report.avgPain}/10<br><strong>Tendenz:</strong> ${report.painTrend}</div>${state.painRecords.length?`<div style="margin-top:10px;font-size:.8rem;color:var(--muted);">Letzte Werte: ${state.painRecords.slice(-5).map(p=>p.value).join(' → ')}</div>`:''}</div></div><div class="doctor-mode-card"><div class="doctor-mode-section"><div class="doctor-mode-title">❤️ Letzte Vitalwerte</div>${report.lastVitals?`<div class="doctor-mode-value"><strong>RR:</strong> ${report.lastVitals.systolic}/${report.lastVitals.diastolic} mmHg<br><strong>Puls:</strong> ${report.lastVitals.pulse} bpm<br><small style="color:var(--muted);">${formatDT(report.lastVitals.date)}</small></div>`:'<p style="color:var(--muted);">Keine Messungen</p>'}</div></div><div class="doctor-mode-card"><div class="doctor-mode-section"><div class="doctor-mode-title">💊 Medikamentenplan</div>${report.medications.length?`<ul class="doctor-mode-list">${report.medications.filter(m=>!m.asNeeded).map(m=>`<li><strong>${m.name}</strong> ${m.dose} - ${m.alarms.map(a=>a.time).join(', ')}</li>`).join('')}</ul>`:('<p style="color:var(--muted);">Keine Medikamente</p>')}</div></div>${bedarfsMed.length?`<div class="doctor-mode-card"><div class="doctor-mode-section"><div class="doctor-mode-title">💊 Bedarfsmedikation</div><ul class="doctor-mode-list">${bedarfsMed.map(m=>`<li><strong>${m.name}</strong> ${m.dose} - bei Bedarf</li>`).join('')}</ul></div></div>`:''}<div class="doctor-mode-card"><div class="doctor-mode-section" style="margin-bottom:0;"><div class="doctor-mode-title">📷 Wunddokumentation</div><div class="doctor-mode-value">${report.woundPhotos} Fotos dokumentiert</div>${report.woundPhotos>0?`<button class="btn btn-secondary btn-sm" style="margin-top:10px;" onclick="nav('wounddiary')">Wundtagebuch öffnen</button>`:''}</div></div><button class="btn btn-secondary btn-block" style="margin-top:16px;" onclick="nav('export')">📤 Vollständiger Export</button></div>`;}
function printReport(){window.print();}
function copyReportText(){const report=generateDoctorReport();const bedarfsMed=state.medications.filter(m=>m.asNeeded);let text=`KURZBERICHT - Operationsbegleiter\n${'='.repeat(40)}\n\n`;text+=`OP-DETAILS\n`;text+=`Art: ${report.opType}\n`;text+=`Datum: ${report.opDate}\n`;text+=`Tage post-OP: ${report.daysPostOp>0?report.daysPostOp:'-'}\n`;text+=`Modus: ${state.profile.opMode==='ambulant'?'Ambulant':state.profile.opMode==='stationary'?'Stationär':'k.A.'}\n\n`;if(report.warnings.length){text+=`AUFFÄLLIGKEITEN\n`;report.warnings.forEach(w=>text+=`• ${w}\n`);text+=`\n`;}text+=`SCHMERZTREND (7 Tage)\n`;text+=`Durchschnitt: ${report.avgPain}/10\n`;text+=`Tendenz: ${report.painTrend}\n\n`;text+=`VITALWERTE\n`;if(report.lastVitals){text+=`RR: ${report.lastVitals.systolic}/${report.lastVitals.diastolic} mmHg\n`;text+=`Puls: ${report.lastVitals.pulse} bpm\n`;}else{text+=`Keine Messungen\n`;}text+=`\nMEDIKAMENTENPLAN\n`;if(report.medications.length){report.medications.filter(m=>!m.asNeeded).forEach(m=>text+=`• ${m.name} ${m.dose} - ${m.alarms.map(a=>a.time).join(', ')}\n`);}else{text+=`Keine Medikamente\n`;}if(bedarfsMed.length){text+=`\nBEDARFSMEDIKATION\n`;bedarfsMed.forEach(m=>text+=`• ${m.name} ${m.dose}\n`);}text+=`\nWunddokumentation: ${report.woundPhotos} Fotos\n`;text+=`\n---\nErstellt am: ${new Date().toLocaleString('de-DE')}`;navigator.clipboard.writeText(text).then(()=>showToast('In Zwischenablage kopiert 📋')).catch(()=>showToast('Kopieren fehlgeschlagen'));}
function renderExport(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('exportTitle')}</h1></div><p style="color:var(--muted);margin-bottom:16px;">${t('exportExplain')}</p><div class="export-card" onclick="exportData('pdf')"><div class="export-icon">📄</div><div class="export-title">${t('pdfPrint')}</div><div class="export-desc">${t('pdfPrintDesc')}</div></div><div class="export-card" onclick="exportData('html')"><div class="export-icon">💾</div><div class="export-title">HTML-Datei speichern</div><div class="export-desc">${t('saveHtmlDesc')}</div></div><div class="disclaimer" style="margin-top:20px;"><span>ℹ️</span><div><strong>${t('exportContent')}:</strong><ul style="margin-top:8px;padding-left:16px;"><li>${t('opInfoDate')}</li><li>${t('painCourseChart')}</li><li>${t('vitalsValues')}</li><li>${t('medicationList2')}</li><li>${t('appointmentsList')}</li><li>${t('woundPhotoNote')}</li></ul></div></div></div>`;}
function renderSettings(){return`<div class="screen"><div class="section-header"><h1 class="section-title">⚙️ ${t('settings')}</h1></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">📱 Handywechsel / Backup</h3><div class="settings-card"><div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;"><p style="font-size:.85rem;color:var(--muted);line-height:1.4;">Alle Daten sichern und auf ein neues Gerät übertragen</p><button class="btn btn-primary btn-block" onclick="exportFullBackup()">📤 Vollständiges Backup erstellen</button><button class="btn btn-secondary btn-block" onclick="importDataModal()">📥 Backup wiederherstellen</button></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">👥 OP-Profile</h3><div class="settings-card"><div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;"><p style="font-size:.85rem;color:var(--muted);line-height:1.4;">Mehrere Operationen separat verwalten</p>${renderProfilesList()}<button class="btn btn-secondary btn-block" onclick="newProfileModal()">➕ Neues OP-Profil anlegen</button></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">${t('opDataSection')}</h3><div class="settings-card"><div class="settings-item"><div class="settings-label"><div class="settings-icon">📅</div><div class="settings-text"><h4>${t('opDate')}</h4><p>${formatDate(state.profile.opDate)||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="dateModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">🏥</div><div class="settings-text"><h4>${t('opType')}</h4><p>${state.profile.opType||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="typeModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">🏨</div><div class="settings-text"><h4>${t('opMode')}</h4><p>${state.profile.opMode==='ambulant'?t('ambulant'):state.profile.opMode==='stationary'?t('stationary'):'Unbekannt'}</p></div></div><button class="btn btn-secondary btn-sm" onclick="opModeModal()">${t('changeBtn')}</button></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">🚗 ${t('transport')}</h3><div class="settings-card"><div class="settings-item"><div class="settings-label"><div class="settings-icon">⏰</div><div class="settings-text"><h4>${t('departureTime')}</h4><p>${state.profile.departureTime||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="departureModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">⏱️</div><div class="settings-text"><h4>${t('travelDuration')}</h4><p>${state.profile.travelDuration?state.profile.travelDuration+' Min.':'Nicht gesetzt'}</p></div></div><button class="btn btn-secondary btn-sm" onclick="durationModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">🚕</div><div class="settings-text"><h4>${t('transportAlt')}</h4><p>${state.profile.transportAlt||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="transportAltModal()">${t('changeBtn')}</button></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">${t('clinicContactsSection')}</h3><div class="settings-card"><div class="settings-item"><div class="settings-label"><div class="settings-icon">🏥</div><div class="settings-text"><h4>${t('clinicNameLabel')}</h4><p>${state.profile.hospitalName||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="clinicNameModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">📞</div><div class="settings-text"><h4>${t('clinicPhoneLabel')}</h4><p>${state.profile.hospitalPhone||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="clinicPhoneModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">👤</div><div class="settings-text"><h4>${t('emergencyContact')}</h4><p>${state.profile.emergencyContact||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="emergencyContactModal()">${t('changeBtn')}</button></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">��‍⚕️</div><div class="settings-text"><h4>${t('surgeonNameLabel')}</h4><p>${state.profile.surgeon||t('notSet')}</p></div></div><button class="btn btn-secondary btn-sm" onclick="surgeonModal()">${t('changeBtn')}</button></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">🎨 Darstellung</h3><div class="settings-card"><div class="settings-item"><div class="settings-label"><div class="settings-icon">${state.theme==='dark'?'🌙':'☀️'}</div><div class="settings-text"><h4>${t('darkMode')}</h4><p>${t('lessEyeStrain')}</p></div></div><label class="toggle"><input type="checkbox" ${state.theme==='dark'?'checked':''} onchange="toggleTheme()"><span class="toggle-slider"></span></label></div><div class="settings-item"><div class="settings-label"><div class="settings-icon">🔤</div><div class="settings-text"><h4>${t('largeFont')}</h4><p>${t('betterReadability')}</p></div></div><label class="toggle"><input type="checkbox" ${state.largeFont?'checked':''} onchange="toggleLargeFont()"><span class="toggle-slider"></span></label></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">${t('notifications')}</h3><div class="settings-card"><div class="settings-item"><div class="settings-label"><div class="settings-icon">🔔</div><div class="settings-text"><h4>${t('notifications')}</h4><p>${t('forTasksMeds')}</p></div></div><label class="toggle"><input type="checkbox" ${state.notifications!==false?'checked':''} onchange="toggleNotifications()"><span class="toggle-slider"></span></label></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">🗑️ Daten verwalten</h3><div class="settings-card"><div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;"><p style="font-size:.85rem;color:var(--muted);">📷 ${state.photos.length} Fotos • 🎤 ${state.voiceMemos.length} Memos • 📄 ${state.uploadedDocs.length} Dokumente</p><button class="btn btn-danger btn-block" onclick="resetModal()">🗑️ Daten löschen...</button></div></div><h3 style="font-size:.8rem;color:var(--muted);text-transform:uppercase;margin:16px 0 10px;">${t('legal')}</h3><div class="settings-card"><div class="settings-item" onclick="nav('impressum')" style="cursor:pointer;"><div class="settings-label"><div class="settings-icon">ℹ️</div><div class="settings-text"><h4>${t('impressum')}</h4><p>${t('legalInfoText')}</p></div></div><span style="color:var(--muted);">›</span></div></div><div class="storage-info" style="margin-top:16px;"><span>🔒</span><p>${t('dataStoredLocally')}</p></div></div>`;}
function languageModal(){}
function opModeModal(){showModal(t('opMode'),`<p style="color:var(--muted);margin-bottom:12px;line-height:1.4;"><strong>${t('ambulant')}:</strong> ${t('ambulantExplain')}<br><strong>${t('stationary')}:</strong> ${t('stationaryExplain')}</p><div class="op-mode-toggle" style="flex-direction:column;gap:8px;"><button class="op-mode-btn ${state.profile.opMode==='ambulant'?'active':''}" onclick="setOpMode('ambulant');closeModal();">${t('ambulant')}</button><button class="op-mode-btn ${state.profile.opMode==='stationary'?'active':''}" onclick="setOpMode('stationary');closeModal();">${t('stationary')}</button><button class="op-mode-btn ${state.profile.opMode==='unknown'?'active':''}" onclick="setOpMode('unknown');closeModal();">${t('iDontKnow')}</button></div>`);}
function departureModal(){showModal('⏰ '+t('departureTime'),`<div class="form-group"><label class="form-label">${t('departureTime')}</label><input type="time" class="form-input" id="newDeparture" value="${state.profile.departureTime||''}"></div><button class="btn btn-primary btn-block" onclick="saveDeparture()">${t('saveBtn')}</button>`);}
function saveDeparture(){const val=document.getElementById('newDeparture')?.value;setState({profile:{...state.profile,departureTime:val}});closeModal();showToast('Gespeichert ✓');}
function durationModal(){showModal('⏱️ '+t('travelDuration'),`<div class="form-group"><label class="form-label">${t('travelDuration')}</label><input type="number" class="form-input" id="newDuration" value="${state.profile.travelDuration||''}" min="1" max="300"></div><button class="btn btn-primary btn-block" onclick="saveDuration()">${t('saveBtn')}</button>`);}
function saveDuration(){const val=document.getElementById('newDuration')?.value;setState({profile:{...state.profile,travelDuration:val}});closeModal();showToast('Gespeichert ✓');}
function transportAltModal(){showModal('🚕 '+t('transportAlt'),`<div class="form-group"><label class="form-label">${t('transportAlt')}</label><input type="text" class="form-input" id="newTransportAlt" value="${state.profile.transportAlt||''}" placeholder="${t('transportAltPlaceholder')}"></div><button class="btn btn-primary btn-block" onclick="saveTransportAlt()">${t('saveBtn')}</button>`);}
function saveTransportAlt(){const val=document.getElementById('newTransportAlt')?.value;setState({profile:{...state.profile,transportAlt:val}});closeModal();showToast('Gespeichert ✓');}
function clinicNameModal(){showModal('🏥 Klinikname',`<div class="form-group"><label class="form-label">Name der Klinik</label><input type="text" class="form-input" id="clinicNameInput" value="${state.profile.hospitalName||''}" placeholder="z.B. Charité Berlin"></div><button class="btn btn-primary btn-block" onclick="saveClinicName()">${t('saveBtn')}</button>`);}
function saveClinicName(){const name=document.getElementById('clinicNameInput')?.value;setState({profile:{...state.profile,hospitalName:name}});closeModal();showToast('Klinikname gespeichert ✓');}
function clinicPhoneModal(){showModal('📞 Klinik-Telefon',`<div class="form-group"><label class="form-label">Telefonnummer</label><input type="tel" class="form-input" id="clinicPhoneInput" value="${state.profile.hospitalPhone||''}" placeholder="z.B. 030 123456"></div><button class="btn btn-primary btn-block" onclick="saveClinicPhone()">${t('saveBtn')}</button>`);}
function saveClinicPhone(){const phone=document.getElementById('clinicPhoneInput')?.value;setState({profile:{...state.profile,hospitalPhone:phone}});closeModal();showToast('Telefon gespeichert ✓');}
function emergencyContactModal(){showModal('👤 Notfallkontakt',`<div class="form-group"><label class="form-label">Name und Telefon</label><input type="text" class="form-input" id="emergencyContactInput" value="${state.profile.emergencyContact||''}" placeholder="z.B. Erika Muster, 0170 1234567"></div><button class="btn btn-primary btn-block" onclick="saveEmergencyContact()">${t('saveBtn')}</button>`);}
function saveEmergencyContact(){const contact=document.getElementById('emergencyContactInput')?.value;setState({profile:{...state.profile,emergencyContact:contact}});closeModal();showToast('Notfallkontakt gespeichert ✓');}
function surgeonModal(){showModal('👨‍⚕️ Operateur',`<div class="form-group"><label class="form-label">Name des Operateurs</label><input type="text" class="form-input" id="surgeonInput" value="${state.profile.surgeon||''}" placeholder="z.B. Dr. Schmidt"></div><button class="btn btn-primary btn-block" onclick="saveSurgeon()">${t('saveBtn')}</button>`);}
function saveSurgeon(){const surgeon=document.getElementById('surgeonInput')?.value;setState({profile:{...state.profile,surgeon:surgeon}});closeModal();showToast('Operateur gespeichert ✓');}
function toggleLargeFont(){setState({largeFont:!state.largeFont});document.documentElement.style.fontSize=state.largeFont?'18px':'16px';showToast(state.largeFont?'Große Schrift aktiviert':'Normale Schrift');}
function toggleNotifications(){const newValue=state.notifications===false;setState({notifications:newValue});showToast(newValue?'Erinnerungen aktiviert':'Erinnerungen deaktiviert');}
function getProfiles(){const stored=localStorage.getItem('op_profiles');return stored?JSON.parse(stored):[];}
function saveProfiles(profiles){localStorage.setItem('op_profiles',JSON.stringify(profiles));}
function renderProfilesList(){const profiles=getProfiles();const currentId=state.profileId||'default';if(profiles.length===0)return'<p style="font-size:.85rem;color:var(--muted);margin-bottom:10px;">Aktuell: Standardprofil</p>';return`<div style="margin-bottom:10px;">${profiles.map(p=>`<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;margin-bottom:8px;${p.id===currentId?'border:2px solid var(--primary);':''}"><span style="flex:1;font-weight:${p.id===currentId?'600':'400'};">${p.name} ${p.id===currentId?'✓':''}</span>${p.id!==currentId?`<button class="btn btn-sm btn-secondary" onclick="switchProfile('${p.id}')">Laden</button>`:''}<button class="btn btn-sm btn-danger" onclick="deleteProfile('${p.id}')" style="padding:6px 10px;">🗑️</button></div>`).join('')}</div>`;}
function newProfileModal(){showModal('➕ Neues OP-Profil',`<p style="color:var(--muted);margin-bottom:16px;">Erstellen Sie ein neues Profil für eine weitere Operation. Ihr aktuelles Profil wird gespeichert.</p><div class="form-group"><label class="form-label">Profilname</label><input type="text" class="form-input" id="newProfileName" placeholder="z.B. Knie-OP 2026"></div><button class="btn btn-primary btn-block" onclick="createNewProfile()">Profil erstellen</button>`);}
function createNewProfile(){const name=document.getElementById('newProfileName')?.value?.trim();if(!name)return showToast('Bitte Namen eingeben');const profiles=getProfiles();const currentId=state.profileId||'default';const existingIdx=profiles.findIndex(p=>p.id===currentId);if(existingIdx>=0){profiles[existingIdx].data=JSON.stringify(state);}else{profiles.push({id:currentId,name:state.profile.opType||'Standardprofil',data:JSON.stringify(state)});}const newId='profile_'+Date.now();const newState={...DEFAULT_STATE,profileId:newId,setupComplete:false};profiles.push({id:newId,name:name,data:JSON.stringify(newState)});saveProfiles(profiles);state=newState;localStorage.setItem(APP_KEY,JSON.stringify(state));closeModal();showToast('Neues Profil erstellt');render();}
function switchProfile(profileId){const profiles=getProfiles();const currentId=state.profileId||'default';const currentIdx=profiles.findIndex(p=>p.id===currentId);if(currentIdx>=0){profiles[currentIdx].data=JSON.stringify(state);}else{profiles.push({id:currentId,name:state.profile.opType||'Standardprofil',data:JSON.stringify(state)});}const targetProfile=profiles.find(p=>p.id===profileId);if(!targetProfile)return showToast('Profil nicht gefunden');saveProfiles(profiles);const newState=JSON.parse(targetProfile.data);newState.profileId=profileId;state=newState;localStorage.setItem(APP_KEY,JSON.stringify(state));showToast('Profil gewechselt zu: '+targetProfile.name);render();}
function deleteProfile(profileId){const profiles=getProfiles().filter(p=>p.id!==profileId);saveProfiles(profiles);showToast('Profil gelöscht');render();}
function exportAllData(){exportFullBackup();}
function exportFullBackup(){const photosWithoutBlob=state.photos.map(p=>({id:p.id,mediaId:p.mediaId,category:p.category,date:p.date,note:p.note||'',mime:p.mime,size:p.size}));const docsWithoutBlob=state.uploadedDocs.map(d=>({id:d.id,mediaId:d.mediaId,name:d.name,size:d.size,type:d.type,date:d.date}));const memosWithoutBlob=state.voiceMemos.map(m=>({id:m.id,mediaId:m.mediaId,date:m.date,duration:m.duration,title:m.title,mime:m.mime,size:m.size}));const data={version:2,exportDate:new Date().toISOString(),note:'Backup enthält keine Medien (Fotos, Dokumente, Sprachmemos). Diese bleiben lokal auf dem Gerät.',profile:state.profile,photos:photosWithoutBlob,voiceMemos:memosWithoutBlob,uploadedDocs:docsWithoutBlob,transcripts:state.transcripts,painRecords:state.painRecords,vitalsRecords:state.vitalsRecords,medicationRecords:state.medicationRecords,appointments:state.appointments,medications:state.medications,questions:state.questions,tasks:state.tasks,documents:state.documents,customDocuments:state.customDocuments,woundNotes:state.woundNotes||[],chatMessages:state.chatMessages||[]};const blob=new Blob([JSON.stringify(data)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`operationsbegleiter-backup-${new Date().toISOString().split('T')[0]}.json`;a.click();URL.revokeObjectURL(url);showToast('Backup erstellt (ohne Medien) 📤');}
function importDataModal(){showModal('📥 Daten importieren',`<p style="color:var(--muted);margin-bottom:16px;line-height:1.5;">Wählen Sie eine Backup-Datei (.json), um Ihre Daten wiederherzustellen. <strong>Achtung:</strong> Vorhandene Daten werden überschrieben!</p><div class="upload-area" onclick="document.getElementById('importFile').click()"><div class="upload-icon">📂</div><div class="upload-text">Backup-Datei auswählen</div></div><input type="file" id="importFile" class="file-input" accept=".json" onchange="handleImport(event)">`);}
function handleImport(e){const file=e.target.files[0];if(!file)return;const r=new FileReader();r.onload=ev=>{try{const data=JSON.parse(ev.target.result);if(!data.profile&&!data.version){showToast('Ungültige Backup-Datei');return;}if(data.version===2){showToast('Backup importiert (ohne Medien)');}const newState={...state,...data,setupComplete:true,currentScreen:'dashboard'};delete newState.version;delete newState.exportDate;delete newState.note;localStorage.setItem(APP_KEY,JSON.stringify(newState));state=newState;closeModal();showToast('Daten erfolgreich importiert! 🎉');render();}catch(err){showToast('Fehler beim Import: '+err.message);}};r.readAsText(file);}
function renderImpressum(){return`<div class="screen"><div class="section-header"><h1 class="section-title">${t('impressumTitle')}</h1></div><div class="info-content" style="margin-bottom:16px;"><h3 style="margin-bottom:12px;color:var(--text);">${t('aboutAppTitle')}</h3><p style="color:var(--muted);line-height:1.6;margin-bottom:12px;">${t('aboutAppDesc')}</p><h3 style="margin:20px 0 12px;color:var(--text);">${t('medicalNoteTitle')}</h3><p style="color:var(--muted);line-height:1.6;margin-bottom:12px;">${t('medicalNoteContent')}</p><h3 style="margin:20px 0 12px;color:var(--text);">${t('privacyTitleLong')}</h3><p style="color:var(--muted);line-height:1.6;margin-bottom:12px;">${t('privacyContentLong')}</p><h3 style="margin:20px 0 12px;color:var(--text);">${t('contactTitleLong')}</h3><p style="color:var(--muted);line-height:1.6;">${t('contactContentLong')}</p></div><div class="storage-info"><span>💡</span><p>${t('versionInfo')}</p></div></div>`;}
function attachListeners(){document.querySelectorAll('#disclaimer,#privacy').forEach(el=>{el?.addEventListener('change',e=>{const p={...state.profile};if(e.target.id==='disclaimer')p.disclaimerAccepted=e.target.checked;if(e.target.id==='privacy')p.privacyAccepted=e.target.checked;setState({profile:p});});});document.querySelectorAll('.tab').forEach(t=>{t.addEventListener('click',e=>{const tab=e.target.dataset.tab;document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));e.target.classList.add('active');document.querySelectorAll('.info-section').forEach(s=>s.classList.add('hidden'));document.querySelector(`[data-content="${tab}"]`)?.classList.remove('hidden');});});document.querySelectorAll('.filter-tab').forEach(t=>{t.addEventListener('click',e=>{const f=e.target.dataset.filter;document.querySelectorAll('.filter-tab').forEach(x=>x.classList.remove('active'));e.target.classList.add('active');document.querySelectorAll('.task').forEach(task=>{const done=task.classList.contains('completed');if(f==='all')task.style.display='';else if(f==='open')task.style.display=done?'none':'';else task.style.display=done?'':'none';});});});const chatMsgs=document.getElementById('chatMessages');if(chatMsgs)chatMsgs.scrollTop=chatMsgs.scrollHeight;}
document.addEventListener('DOMContentLoaded',async()=>{if(state.largeFont)document.documentElement.style.fontSize='18px';try{await openDB();await migrateMediaToIndexedDB();}catch(e){console.error('IndexedDB init error:',e);}if(state.setupComplete&&state.tasks.length>0){const currentIds=state.tasks.map(t=>t.id);let newTasks=false;getTimeline().forEach(p=>{p.tasks.forEach(t=>{if(!currentIds.includes(t.id)){state.tasks.push({...t,day:p.day,completed:false,note:''});newTasks=true;}});});if(newTasks)saveState();}render();});
function showAdFreeModal(){showModal('Werbefrei nutzen','<p style="text-align:center;color:var(--muted);">Diese App ist und bleibt werbefrei und kostenlos. ❤️</p>');}
function acceptTranslationWarning(){closeModal();}
function addMedTime(medId){const m=state.medications.find(x=>x.id===medId);if(!m)return;const newTime={time:'08:00',alarm:false};m.alarms.push(newTime);setState({medications:state.medications});showToast('Einnahmezeit hinzugefügt');}
function showStorageFullModal(){showModal('Speicher voll','<p style="text-align:center;color:var(--muted);">Der Speicher ist voll. Bitte löschen Sie nicht benötigte Fotos oder Dokumente.</p>');}
function showSutureGuide(){showModal('Fadenentfernung','<div class="info-content"><h4 style="margin-bottom:12px;">📖 Anleitung zur Fadenentfernung</h4><p style="color:var(--muted);line-height:1.6;">Die Fadenentfernung erfolgt üblicherweise 7-14 Tage nach der OP durch Ihr Behandlungsteam. Entfernen Sie die Fäden nicht selbst!</p><h4 style="margin-top:16px;margin-bottom:8px;">Wann zum Arzt?</h4><ul class="info-list"><li>Wenn Fäden sich von selbst lösen</li><li>Bei Rötung/Schwellung um die Naht</li><li>Bei Austritt von Flüssigkeit</li></ul></div>');}
function addCustomTaskModal(){showModal('Eigene Aufgabe','<div class="form-group"><label class="form-label">Titel</label><input type="text" class="form-input" id="customTaskTitle" placeholder="Aufgabentitel"></div><div class="form-group"><label class="form-label">Beschreibung</label><textarea class="form-textarea" id="customTaskDesc" placeholder="Optional"></textarea></div><div class="form-group"><label class="form-label">Tag (relativ zur OP)</label><input type="number" class="form-input" id="customTaskDay" value="-1" min="-30" max="90"></div><button class="btn btn-primary btn-block" onclick="saveCustomTask()">Speichern</button>');}
function saveCustomTask(){const title=document.getElementById('customTaskTitle')?.value;const desc=document.getElementById('customTaskDesc')?.value||'';const day=parseInt(document.getElementById('customTaskDay')?.value||'-1');if(!title){showToast('Bitte Titel eingeben');return;}const task={id:id(),title:title,desc:desc,day:day,completed:false,custom:true};setState({tasks:[...state.tasks,task]});closeModal();showToast('Aufgabe hinzugefügt');}
function deleteCustomTask(taskId){if(confirm('Aufgabe löschen?')){setState({tasks:state.tasks.filter(t=>t.id!==taskId)});showToast('Aufgabe gelöscht');}}
window.toggleTheme=toggleTheme;window.toggleTask=toggleTask;window.toggleDoc=toggleDoc;window.nav=nav;window.goBack=goBack;window.toggleMenu=toggleMenu;window.nextStep=nextStep;window.prevStep=prevStep;window.noteModal=noteModal;window.saveNote=saveNote;window.addDocModal=addDocModal;window.submitDoc=submitDoc;window.delCustomDoc=delCustomDoc;window.apptModal=apptModal;window.submitAppt=submitAppt;window.delAppt=delAppt;window.medModal=medModal;window.submitMed=submitMed;window.delMed=delMed;window.toggleAlarm=toggleAlarm;window.dateModal=dateModal;window.changeDate=changeDate;window.typeModal=typeModal;window.changeType=changeType;window.resetModal=resetModal;window.resetApp=resetApp;window.closeModal=closeModal;window.handlePhoto=handlePhoto;window.delPhoto=delPhoto;window.viewPhoto=viewPhoto;window.handleDocUpload=handleDocUpload;window.delUploadedDoc=delUploadedDoc;window.startRec=startRec;window.stopRec=stopRec;window.playMemo=playMemo;window.delMemo=delMemo;window.startSpeech=startSpeech;window.stopSpeech=stopSpeech;window.delTranscript=delTranscript;window.savePain=savePain;window.saveVitals=saveVitals;window.saveMedRec=saveMedRec;window.questionModal=questionModal;window.submitQuestion=submitQuestion;window.addQuestion=addQuestion;window.delQuestion=delQuestion;window.sendChatMessage=sendChatMessage;window.renameMemo=renameMemo;window.saveMemoName=saveMemoName;window.editTranscript=editTranscript;window.updateTranscript=updateTranscript;window.saveTranscriptWithName=saveTranscriptWithName;window.exportData=exportData;window.addWoundNote=addWoundNote;window.saveWoundNote=saveWoundNote;window.clinicNameModal=clinicNameModal;window.saveClinicName=saveClinicName;window.clinicPhoneModal=clinicPhoneModal;window.saveClinicPhone=saveClinicPhone;window.emergencyContactModal=emergencyContactModal;window.saveEmergencyContact=saveEmergencyContact;window.surgeonModal=surgeonModal;window.saveSurgeon=saveSurgeon;window.toggleLargeFont=toggleLargeFont;window.toggleNotifications=toggleNotifications;window.exportAllData=exportAllData;window.setLanguage=setLanguage;window.setOpMode=setOpMode;window.showAdFreeModal=showAdFreeModal;window.languageModal=languageModal;window.opModeModal=opModeModal;window.departureModal=departureModal;window.saveDeparture=saveDeparture;window.durationModal=durationModal;window.saveDuration=saveDuration;window.transportAltModal=transportAltModal;window.saveTransportAlt=saveTransportAlt;window.toggleDocCheck=toggleDocCheck;window.setFastingAlarm=setFastingAlarm;window.setWoundAlarm=setWoundAlarm;window.woundAlarmModal=woundAlarmModal;window.fastingAlarmModal=fastingAlarmModal;window.acceptTranslationWarning=acceptTranslationWarning;window.exportFullBackup=exportFullBackup;window.importDataModal=importDataModal;window.handleImport=handleImport;window.deleteMediaOnly=deleteMediaOnly;window.deleteHistoryOnly=deleteHistoryOnly;window.newProfileModal=newProfileModal;window.createNewProfile=createNewProfile;window.switchProfile=switchProfile;window.deleteProfile=deleteProfile;window.printReport=printReport;window.copyReportText=copyReportText;window.addMedTime=addMedTime;window.openDocument=openDocument;window.closePhotoViewer=closePhotoViewer;window.loadPhotoThumbnails=loadPhotoThumbnails;window.loadWoundDiaryThumbnails=loadWoundDiaryThumbnails;window.showStorageFullModal=showStorageFullModal;window.showSutureGuide=showSutureGuide;window.addCustomTaskModal=addCustomTaskModal;window.saveCustomTask=saveCustomTask;window.deleteCustomTask=deleteCustomTask;window.setWorkspace=setWorkspace;window.selectItem=selectItem;window.closeDetail=closeDetail;window.toggleSidebar=toggleSidebar;window.toggleCommand=toggleCommand;window.setCommandQuery=setCommandQuery;window.execCommand=execCommand;window.initWorkspace=initWorkspace;
</script>
</script>
</body>
</html>
